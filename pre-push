#!/bin/bash
# -*-indent-tabs-mode:t;c-basic-offset:4;tab-width:4;autowrap:nil;-*-
#sudo apt install clang++ clang-tidy cmake g++ libblas-dev libfftw3-dev libboost-test-dev libboost-timer-dev make

 (mkdir -p .build.g++.asan      && cd .build.g++.asan      && CXX=g++ CXXFLAGS="-fsanitize=address,pointer-compare,pointer-subtract,leak -fno-sanitize-recover=all" cmake .. -DCMAKE_BUILD_TYPE=Debug                                                                                                                                                                    && (make -j $(($(nproc) - 2)) || make VERBOSE=1) &&                                               ctest         -j 12 --output-on-failure) || exit 666
 (mkdir -p .build.circle_169    && cd .build.circle_169    && CXX=/home/correaa/circle_169/circle                                                                   cmake .. -DCMAKE_BUILD_TYPE=Release -DENABLE_CIRCLE=1 -DBoost_USE_STATIC_LIBS=OFF -DBOOST_LIBRARYDIR=/usr/lib/x86_64-linux-gnu/                                                                      && (make -j $(($(nproc) - 2)) || make VERBOSE=1) &&                                               ctest         -j 12 --output-on-failure) || exit 666
 (mkdir -p .build.circle_170    && cd .build.circle_170    && CXX=/home/correaa/circle_170/circle                                                                   cmake .. -DCMAKE_BUILD_TYPE=Release -DENABLE_CIRCLE=1 -DBoost_USE_STATIC_LIBS=OFF -DBOOST_LIBRARYDIR=/usr/lib/x86_64-linux-gnu/                                                                      && (make -j $(($(nproc) - 2)) || make VERBOSE=1) &&                                               ctest         -j 12 --output-on-failure) || exit 666
 (mkdir -p .build.clang++.debug && cd .build.clang++.debug && CXX=clang++                                                                                           cmake .. -DCMAKE_BUILD_TYPE=Debug   -DCMAKE_CXX_CLANG_TIDY="clang-tidy"                                                                                                                              && (make -j $(($(nproc) - 2)) || make VERBOSE=1) &&                                               ctest         -j 12 --output-on-failure) || exit 666
 (mkdir -p .build.cppcheck      && cd .build.cppcheck      && CXX=g++                                                                                               cmake .. -DCMAKE_BUILD_TYPE=Debug   -DCMAKE_CXX_CPPCHECK="cppcheck;--enable=all;--suppress=missingIncludeSystem;--inline-suppr;--std=c++17;--check-config;--error-exitcode=1"                        && (make -j $(($(nproc) - 2)) || make VERBOSE=1) &&                                               ctest         -j 12 --output-on-failure) || exit 666
 (mkdir -p .build.nvcc          && cd .build.nvcc          && CUDACXX=nvcc CMAKE_CUDA_HOST_COMPILER=g++                                                             cmake .. -DCMAKE_BUILD_TYPE=Release -DCMAKE_CUDA_FLAGS="-ccbin=g++-9" -DENABLE_CUDA=1 -DCMAKE_CUDA_ARCHITECTURES=61                                                                                  && (make -j $(($(nproc) - 2)) || make VERBOSE=1) &&                                               ctest -T Test -j 12 --output-on-failure) || exit 666
 (mkdir -p .build.icpc          && cd .build.icpc          && CXX=/home/correaa/intel/oneapi/compiler/latest/linux/bin/intel64/icpc                                 cmake .. -DCMAKE_BUILD_TYPE=Release                                                                                                                                                                  && (make -j $(($(nproc) - 2)) || make VERBOSE=1) &&                                               ctest -T Test -j 12 --output-on-failure) || exit 666
 (mkdir -p .build.icpx          && cd .build.icpx          && CXX=/home/correaa/intel/oneapi/compiler/latest/linux/bin/icpx                                         cmake .. -DCMAKE_BUILD_TYPE=Release                                                                                                                                                                  && (make -j $(($(nproc) - 2)) || make VERBOSE=1) &&                                               ctest -T Test -j 12 --output-on-failure) || exit 666
 (mkdir -p .build.g++-9         && cd .build.g++-9         && CXX=g++-9                                                                                             cmake ..                                                                                                                                                                                             && (make -j $(($(nproc) - 2)) || make VERBOSE=1) &&                                               ctest         -j 12 --output-on-failure) || exit
 (mkdir -p .build.g++-10        && cd .build.g++-10        && CXX=g++-10                                                                                            cmake ..                                                                                                                                                                                                                              && (make -j $(($(nproc) - 2)) || make VERBOSE=1) &&                                               ctest         -j 12 --output-on-failure) || exit
 (mkdir -p .build               && cd .build               &&                                                                                                       cmake .. -DCMAKE_BUILD_TYPE=Release                                                                                                                                                                                        && make -j $(($(nproc) - 2)) VERBOSE=1 &&                                               ctest         -j 12 --output-on-failure) || exit 666
 (mkdir -p .build.clang++.asan  && cd .build.clang++.asan  && CXX=clang++ CXXFLAGS="-fsanitize=undefined -fsanitize=address"                                        cmake .. -DCMAKE_BUILD_TYPE=Debug                                                                                                                                                                                                                         && make -j $(($(nproc) - 2)) VERBOSE=1 && ASAN_OPTIONS="halt_on_error=1 detect_leaks=1" ctest         -j 12 --output-on-failure) || exit 666
 (mkdir -p .build.memchk        && cd .build.memchk        &&                                                                                                       cmake ..                                                                                                                                                                                                                                                  && make -j 12 && ctest --overwrite MemoryCheckCommandOptions="-q --tool=memcheck --leak-check=yes --num-callers=51 --trace-children=yes --leak-check=full --track-origins=yes --gen-suppressions=all" -T memcheck -j 12 --output-on-failure) || exit
 (mkdir -p .build.clang++std20  && cd .build.clang++std20  && CXX=clang++                                                                                           cmake .. -DCMAKE_BUILD_TYPE=Debug -DCMAKE_CXX_STANDARD=20                                                                                                                                                                              && (make -j $(($(nproc) - 2)) || make VERBOSE=1) && ctest         -j 12 --output-on-failure) || exit 666
 (mkdir -p .build.clang++-11    && cd .build.clang++-11    && CXX=clang++-11                                                                                        cmake .. -DCMAKE_BUILD_TYPE=Debug                                                                                                                                                                              && (make -j $(($(nproc) - 2)) || make VERBOSE=1) && ctest         -j 12 --output-on-failure) || exit 666
 (mkdir -p .build.clang++-12    && cd .build.clang++-12    && CXX=clang++-12                                                                                        cmake .. -DCMAKE_BUILD_TYPE=Debug                                                                                                                                                                              && (make -j $(($(nproc) - 2)) || make VERBOSE=1) && ctest         -j 12 --output-on-failure) || exit 666
 (mkdir -p .build.clang++-13    && cd .build.clang++-13    && CXX=clang++-13                                                                                        cmake .. -DCMAKE_BUILD_TYPE=Debug                                                                                                                                                                              && (make -j $(($(nproc) - 2)) || make VERBOSE=1) && ctest         -j 12 --output-on-failure) || exit 666
 (mkdir -p .build.debug         && cd .build.debug         &&                                                                                                       cmake .. -DCMAKE_BUILD_TYPE=Debug                                                                                                                                                                                                      && (make -j $(($(nproc) - 2)) || make VERBOSE=1) &&                                               ctest         -j 12 --output-on-failure) || exit 666
 (mkdir -p .build.g++.udef      && cd .build.g++.udef      && CXX=g++ CXXFLAGS="-fsanitize=undefined,shift,integer-divide-by-zero,unreachable,null,return,signed-integer-overflow -fno-sanitize-recover=all" cmake .. -DCMAKE_BUILD_TYPE=Release                                                                                                                               && (make -j $(($(nproc) - 2)) || make VERBOSE=1) &&                                               ctest         -j 12 --output-on-failure) || exit 666
 (mkdir -p .build.g++.thread    && cd .build.g++.thread    && CXX=g++ CXXFLAGS="-fsanitize=thread            -fno-sanitize-recover=all"                             cmake .. -DCMAKE_BUILD_TYPE=Debug                                                                                                                                                                                                      && (make -j $(($(nproc) - 2)) || make VERBOSE=1) &&                                               ctest         -j 12 --output-on-failure) || exit 666
 (mkdir -p .build.cpplint       && cd .build.cpplint       &&                                                                                                       cmake .. -DCMAKE_CXX_CPPLINT="cpplint;--filter=-whitespace/tab,-whitespace/parens,-whitespace/operators,-whitespace/braces,-readability/alt_tokens,-build/include_order,-whitespace/line_length,-whitespace/semicolon,-legal/copyright,-whitespace/comments,-readability/nolint" && (make $(($(nproc) - 2)) || make VERBOSE=1 ) && ctest -j 12 --output-on-failure) || exit 666
exit

#(mkdir -p .build.clang++.msan && cd .build.clang++.msan && CXX=clang++ CXXFLAGS="-fsanitize=memory -fsanitize-memory-track-origins=2 -fno-omit-frame-pointer -g -O0 " MSAN_OPTIONS=symbolize=1 cmake .. -DCMAKE_BUILD_TYPE=Debug && make -j 12 && MSAN_OPTIONS=symbolize=1 MSAN_SYMBOLIZER_PATH=/usr/bin/llvm-symbolizer ctest -j 1 --output-on-failure) || exit
 (mkdir -p .build.clang++.iwyu && cd .build.clang++.iwyu && CXX=clang++                     cmake .. -DCMAKE_CXX_INCLUDE_WHAT_YOU_USE="iwyu" && make -j 10 && ctest -j 12 --output-on-failure) || exit
 (find . -name '*.hpp' -exec cppcheck --enable=all --inline-suppr --suppress=unmatchedSuppression:{} --suppress=syntaxError --suppress=missingInclude --suppress=missingIncludeSystem --suppress=preprocessorErrorDirective --suppress=syntaxError --suppress=unusedFunction --suppress=arithOperationsOnVoidPointer --suppress=sizeofDereferencedVoidPointer -D__align__ -DCUDARTAPI --language=c++ --std=c++17 --error-exitcode=666 --suppress=unmatchedSuppression {} \;) || exit
