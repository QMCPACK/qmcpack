.. _github_actions:

======  =======  ===  ===  =======
Github  Actions  CI   on   QMCPACK
======  =======  ===  ===  =======

QMCPACK uses GitHub Actions as part of the suite of continuous integration (CI) checks before a pull request can be merged in the main `develop` branch. Github Actions is an event driven automation tool that allows us to automatically execute commands in response to QMCPACK repo related actions. For example, merging a branch into master might then trigger our test scripts to run.

This guide covers the purpose and usual interactions a QMCPACK contributor would have with GitHub Actions CI.  For more information on Github Actions please refer to the official `Github Actions Docs <https://docs.github.com/en/actions/guides>`_ and our scripts located `here <https://github.com/QMCPACK/qmcpack/tree/develop/tests/test_automation/github-actions/ci>`_.

Currently we are using GitHub Actions to automatically handle a few different jobs. These jobs are either run on the Github provided build VM's or are pushed to our supplied hardware.  Usually the jobs are only run on our hardware when they require GPU's to run.

Note: This is not necessarily the intended typical way for users to build QMCPACK, please refer to our getting started and other build documentation for that.

Summary of Test Jobs
--------------------

The following is a summary of the jobs run in the CI process required for a PR:

+---------------------------------------------------+----------+---------------+----------+----------+
| Job Name with                                     | Runner   | Tests         | Time     | Trigger  |
| Build Info                                        | Host     | ctest -L      | min      | event    |
+---------------------------------------------------+----------+---------------+----------+----------+
| GCC9-MPI-Gcov-(Real*, Complex*)                   | GitHub   | deterministic | (60, 60) | PR/merge |
+---------------------------------------------------+----------+---------------+----------+----------+
| GCC9-NoMPI-Debug-Real                             | GitHub   | deterministic | 17       | PR/merge |
+---------------------------------------------------+----------+---------------+----------+----------+
| GCC9-NoMPI-NoOMP-(Real, Complex)                  | GitHub   | deterministic | (31, 32) | PR/merge |
+---------------------------------------------------+----------+---------------+----------+----------+
| GCC9-NoMPI-Sandbox-Real                           | GitHub   | deterministic | (5)      | PR/merge |
+---------------------------------------------------+----------+---------------+----------+----------+
| GCC11-NoMPI-Werror-(Real, Complex)                | GitHub   | deterministic | (60, 60) | PR/merge |
+---------------------------------------------------+----------+---------------+----------+----------+
| Clang10-NoMPI-ASan-(Real, Complex)                | GitHub   | deterministic | (60, 60) | PR/merge |
+---------------------------------------------------+----------+---------------+----------+----------+
| Clang10-NoMPI-UBSan-Real                          | GitHub   | deterministic | 60       | PR/merge |
+---------------------------------------------------+----------+---------------+----------+----------+
| Clang12-NoMPI-Offload-Real                        | GitHub   | unit          | 35       | PR/merge |
+---------------------------------------------------+----------+---------------+----------+----------+
| macOS-GCC11-NoMPI-Real                            | GitHub   | deterministic | 27       | PR/merge |
+---------------------------------------------------+----------+---------------+----------+----------+
| GCC8-NoMPI-Legacy-CUDA-(Real, Complex)-Mixed      | sulfur   | deterministic | (2, 2)   | manual   |
+---------------------------------------------------+----------+---------------+----------+----------+
| GCC8-NoMPI-Legacy-CUDA-(Real, Complex)            | sulfur   | deterministic | (2 ,2)   | manual   |
+---------------------------------------------------+----------+---------------+----------+----------+
| GCC8-NoMPI-MKL-(Real, Complex)-Mixed              | sulfur   | deterministic | (2, 2)   | manual   |
+---------------------------------------------------+----------+---------------+----------+----------+
| GCC8-NoMPI-MKL-(Real, Complex)                    | sulfur   | deterministic | (2, 2)   | manual   |
+---------------------------------------------------+----------+---------------+----------+----------+
| GCC8-MPI-CUDA-AFQMC-(Real, Complex)-Mixed         | nitrogen | deterministic | (6, 6)   | manual   |
+---------------------------------------------------+----------+---------------+----------+----------+
| GCC8-MPI-CUDA-AFQMC-(Real, Complex)               | nitrogen | deterministic | (6, 6)   | manual   |
+---------------------------------------------------+----------+---------------+----------+----------+
| Clang14Dev-MPI-CUDA-AFQMC-Offload-Real-Mixed      | sulfur   | deterministic | 6        | manual   |
+---------------------------------------------------+----------+---------------+----------+----------+
| Clang14Dev-MPI-CUDA-AFQMC-Offload-Real            | sulfur   | deterministic | 6        | manual   |
+---------------------------------------------------+----------+---------------+----------+----------+
| Intel19-MPI-CUDA-AFQMC-(Real, Complex)-Mixed      | sulfur   | deterministic | (6, 6)   | manual   |
+---------------------------------------------------+----------+---------------+----------+----------+
| Intel19-MPI-CUDA-AFQMC-(Real, Complex)            | sulfur   | deterministic | (6, 6)   | manual   |
+---------------------------------------------------+----------+---------------+----------+----------+
| ROCm-Clang13-NoMPI-CUDA2HIP-(Real, Complex)-Mixed | nitrogen | deterministic | (10, 10) | manual   |
+---------------------------------------------------+----------+---------------+----------+----------+
| ROCm-Clang13-NoMPI-CUDA2HIP-(Real, Complex)       | nitrogen | deterministic | (12, 12) | manual   |
+---------------------------------------------------+----------+---------------+----------+----------+

Jobs running on GitHub hosted runners are triggered automatically. Permission from an admin is required to run jobs on self-hosted runners (e.g. sulfur) for security reasons. In addition, jobs running on GitHub hosted runners run automatically in parallel and the time each job takes may vary depending on system utilization. For information on the underlying hardware see the GitHub Actions `docs on the topic <https://docs.github.com/en/actions/using-github-hosted-runners/about-github-hosted-runners>`_.  

All Linux jobs Github Runner hosts currently use the `williamfgc/qmcpack-ci:ubuntu20-openmpi <https://hub.docker.com/r/williamfgc/qmcpack-ci>`_ docker image, if you would like to reproduce theses tests exactly using docker, please refer to `Running QMCPACK on Docker Containers <https://qmcpack.readthedocs.io/en/develop/running_docker.html>`_ section in the QMCPACK documentation. The macOS job runs directly on the `macos-latest GitHub Actions VM runner <https://docs.github.com/en/actions/using-github-hosted-runners/about-github-hosted-runners#supported-runners-and-hardware-resources>`_


.. note::

    Jobs with the *-coverage pattern upload a Coverage report to `Codecov <https://app.codecov.io/gh/QMCPACK/qmcpack>`_. There might be some delay between jobs sending independent results triggering a false positive coverage check, just wait until all jobs are done.  



linux (GCC9-MPI-Gcov-Real)
""""""""""""""""""""""""""
+---------------+------------------------------------------------------------------------------------------------------------------------------------------------+
| Compiler      | GCC                                                                                                                                            |
+---------------+------------------------------------------------------------------------------------------------------------------------------------------------+
| Build Command | `cmake -GNinja -DCMAKE_C_COMPILER=mpicc -DCMAKE_CXX_COMPILER=mpicxx \-DCMAKE_BUILD_TYPE=RelWithDebInfo -DENABLE_GCOV=TRUE \-DQMC_COMPLEX=0 ..` |
+---------------+------------------------------------------------------------------------------------------------------------------------------------------------+
| Test Command  | `export OMPI_MCA_rmaps_base_oversubscribe=1 && export OMPI_MCA_hwloc_base_binding_policy=none && ctest --output-on-failure -L deterministic`   |
+---------------+------------------------------------------------------------------------------------------------------------------------------------------------+
| Objective     | Test Coverage (Real)                                                                                                                           |
+---------------+------------------------------------------------------------------------------------------------------------------------------------------------+
| Duration      | ~45 Minutes                                                                                                                                    |
+---------------+------------------------------------------------------------------------------------------------------------------------------------------------+

linux (GCC9-MPI-Gcov-Complex)
"""""""""""""""""""""""""""""
+---------------+------------------------------------------------------------------------------------------------------------------------------------------------+
| Compiler      | GCC                                                                                                                                            |
+---------------+------------------------------------------------------------------------------------------------------------------------------------------------+
| Build Command | `cmake -GNinja -DCMAKE_C_COMPILER=mpicc -DCMAKE_CXX_COMPILER=mpicxx \-DCMAKE_BUILD_TYPE=RelWithDebInfo -DENABLE_GCOV=TRUE \-DQMC_COMPLEX=1 ..` |
+---------------+------------------------------------------------------------------------------------------------------------------------------------------------+
| Test Command  | `export OMPI_MCA_rmaps_base_oversubscribe=1 && export OMPI_MCA_hwloc_base_binding_policy=none && ctest --output-on-failure -L deterministic`   |
+---------------+------------------------------------------------------------------------------------------------------------------------------------------------+
| Objective     | Test Coverage (Complex)                                                                                                                        |
+---------------+------------------------------------------------------------------------------------------------------------------------------------------------+
| Duration      | ~50 Minutes                                                                                                                                    |
+---------------+------------------------------------------------------------------------------------------------------------------------------------------------+

linux (GCC9-NoMPI-NoOMP-Real)
"""""""""""""""""""""""""""""
+---------------+----------------------------------------------------------------------------------------------------------------------------------------------+
| Compiler      | GCC                                                                                                                                          |
+---------------+----------------------------------------------------------------------------------------------------------------------------------------------+
| Build Command | `cmake -GNinja -DCMAKE_C_COMPILER=gcc -DCMAKE_CXX_COMPILER=g++ -DQMC_MPI=0 -DQMC_OMP=0 -DQMC_COMPLEX=0 -DCMAKE_BUILD_TYPE=RelWithDebInfo ..` |
+---------------+----------------------------------------------------------------------------------------------------------------------------------------------+
| Test Command  | `ctest --output-on-failure -L deterministic -j 2`                                                                                            |
+---------------+----------------------------------------------------------------------------------------------------------------------------------------------+
| Objective     | Test Coverage (Real)                                                                                                                         |
+---------------+----------------------------------------------------------------------------------------------------------------------------------------------+
| Duration      | ~31 Minutes                                                                                                                                  |
+---------------+----------------------------------------------------------------------------------------------------------------------------------------------+

linux (GCC9-NoMPI-NoOMP-Complex)
""""""""""""""""""""""""""""""""
+---------------+----------------------------------------------------------------------------------------------------------------------------------------------+
| Compiler      | GCC                                                                                                                                          |
+---------------+----------------------------------------------------------------------------------------------------------------------------------------------+
| Build Command | `cmake -GNinja -DCMAKE_C_COMPILER=gcc -DCMAKE_CXX_COMPILER=g++ -DQMC_MPI=0 -DQMC_OMP=0 -DQMC_COMPLEX=1 -DCMAKE_BUILD_TYPE=RelWithDebInfo ..` |
+---------------+----------------------------------------------------------------------------------------------------------------------------------------------+
| Test Command  | `ctest --output-on-failure -L deterministic -j 2`                                                                                            |
+---------------+----------------------------------------------------------------------------------------------------------------------------------------------+
| Objective     | Test Coverage (Complex)                                                                                                                      |
+---------------+----------------------------------------------------------------------------------------------------------------------------------------------+
| Duration      | ~32 Minutes                                                                                                                                  |
+---------------+----------------------------------------------------------------------------------------------------------------------------------------------+

linux (GCC9-NoMPI-Sandbox-Real)
"""""""""""""""""""""""""""""""
+---------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------+
| Compiler      | GCC                                                                                                                                                          |
+---------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------+
| Build Command | `cmake -GNinja -DCMAKE_C_COMPILER=gcc -DCMAKE_CXX_COMPILER=g++ -DQMC_MPI=0 -DQMC_BUILD_SANDBOX_ONLY=ON -DQMC_COMPLEX=0 -DCMAKE_BUILD_TYPE=RelWithDebInfo ..` |
+---------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------+
| Test Command  | `ctest --output-on-failure -L deterministic -j 2`                                                                                                            |
+---------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------+
| Objective     | Test Coverage (Real)                                                                                                                                         |
+---------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------+
| Duration      | ~5 Minutes                                                                                                                                                   |
+---------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------+


linux (GCC11-NoMPI-Werror-Real)
"""""""""""""""""""""""""""""""
+---------------+------------------------------------------------------------------------------------------------------------------------------+
| Compiler      | gcc 11.2                                                                                                                     |
+---------------+------------------------------------------------------------------------------------------------------------------------------+
| Build Command | `cmake -GNinja -DCMAKE_C_COMPILER=gcc -DCMAKE_CXX_COMPILER=g++ -DCMAKE_CXX_FLAGS=-Werror \ -DQMC_MPI=0 \ -DQMC_COMPLEX=0 ..` |
+---------------+------------------------------------------------------------------------------------------------------------------------------+
| Test Command  | ctest --output-on-failure -L deterministic`                                                                                  |
+---------------+------------------------------------------------------------------------------------------------------------------------------+
| Objective     | Test with gcc-11 and -Werror flag (Real)                                                                                     |
+---------------+------------------------------------------------------------------------------------------------------------------------------+
| Duration      | ~55 Minutes                                                                                                                  |
+---------------+------------------------------------------------------------------------------------------------------------------------------+

linux (GCC9-NoMPI-Debug-Real)
""""""""""""""""""""""""""
+---------------+--------------------------------------------------------------------------------------------------------------+
| Compiler      | GCC                                                                                                          |
+---------------+--------------------------------------------------------------------------------------------------------------+
| Build Command | `cmake -GNinja \-DCMAKE_C_COMPILER=gcc \-DCMAKE_CXX_COMPILER=g++ \-DQMC_MPI=0 \-DCMAKE_BUILD_TYPE=Debug \..` |
+---------------+--------------------------------------------------------------------------------------------------------------+
| Test Command  | ctest --output-on-failure -L deterministic`                                                                  |
+---------------+--------------------------------------------------------------------------------------------------------------+
| Objective     | Test Coverage (Real) with Debug Flags                                                                        |
+---------------+--------------------------------------------------------------------------------------------------------------+
| Duration      | ~17 Minutes                                                                                                  |
+---------------+--------------------------------------------------------------------------------------------------------------+

linux (GCC11-NoMPI-Werror-Complex)
""""""""""""""""""""""""""""""""""
+---------------+------------------------------------------------------------------------------------------------------------------------------+
| Compiler      | gcc 11.2                                                                                                                     |
+---------------+------------------------------------------------------------------------------------------------------------------------------+
| Build Command | `cmake -GNinja -DCMAKE_C_COMPILER=gcc -DCMAKE_CXX_COMPILER=g++ -DCMAKE_CXX_FLAGS=-Werror \ -DQMC_MPI=0 \ -DQMC_COMPLEX=1 ..` |
+---------------+------------------------------------------------------------------------------------------------------------------------------+
| Test Command  | ctest --output-on-failure -L deterministic`                                                                                  |
+---------------+------------------------------------------------------------------------------------------------------------------------------+
| Objective     | Test with gcc-11 and -Werror flag (Complex)                                                                                  |
+---------------+------------------------------------------------------------------------------------------------------------------------------+
| Duration      | ~55 Minutes                                                                                                                  |
+---------------+------------------------------------------------------------------------------------------------------------------------------+


linux (Clang10-NoMPI-ASan-Real)
"""""""""""""""""""""""""""""""
+---------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------+
| Compiler      | Clang                                                                                                                                                          |
+---------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------+
| Build Command | `cmake -GNinja -DCMAKE_C_COMPILER=clang -DCMAKE_CXX_COMPILER=clang++ -DCMAKE_BUILD_TYPE=RelWithDebInfo -DENABLE_SANITIZER=asan -DQMC_MPI=0 -DQMC_COMPLEX=0 ..` |
+---------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------+
| Test Command  | ctest --output-on-failure -L unit -LE noasan`                                                                                                                  |
+---------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------+
| Objective     | Address Sanitizer (Real)                                                                                                                                       |
+---------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------+
| Duration      | ~25 Minutes                                                                                                                                                    |
+---------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------+

linux (Clang10-NoMPI-ASan-Complex)
""""""""""""""""""""""""""""""""""
+---------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------+
| Compiler      | Clang                                                                                                                                                          |
+---------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------+
| Build Command | `cmake -GNinja -DCMAKE_C_COMPILER=clang -DCMAKE_CXX_COMPILER=clang++ -DCMAKE_BUILD_TYPE=RelWithDebInfo -DENABLE_SANITIZER=asan -DQMC_MPI=0 -DQMC_COMPLEX=1 ..` |
+---------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------+
| Test Command  | ctest --output-on-failure -L unit -LE noasan`                                                                                                                  |
+---------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------+
| Objective     | Address Sanitizer (Complex)                                                                                                                                    |
+---------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------+
| Duration      | ~30 Minutes                                                                                                                                                    |
+---------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------+


linux (Clang10-NoMPI-UBSan-Real)
""""""""""""""""""""""""""""""""
+---------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| Compiler      | Clang                                                                                                                                                                                                 |
+---------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| Build Command | `export OMPI_CC=clang && export OMPI_CXX=clang++ && cmake -GNinja -DCMAKE_C_COMPILER=mpicc -DCMAKE_CXX_COMPILER=mpicxx -DCMAKE_BUILD_TYPE=RelWithDebInfo -DENABLE_SANITIZER=ubsan -DQMC_COMPLEX=0 ..` |
+---------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| Test Command  | `export OMPI_MCA_rmaps_base_oversubscribe=1 && export OMPI_MCA_hwloc_base_binding_policy=none && ctest --output-on-failure -L deterministic`                                                          |
+---------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| Objective     | Undefined Behavior Sanitizer (Real)                                                                                                                                                                   |
+---------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| Duration      | ~55 Minutes                                                                                                                                                                                           |
+---------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+

linux (Clang12-NoMPI-Offload-Real)
""""""""""""""""""""""""""""""""""
+---------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| Compiler      | Clang                                                                                                                                                                      |
+---------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| Build Command | `cmake -GNinja -DCMAKE_C_COMPILER=clang-12 -DCMAKE_CXX_COMPILER=clang++-12 -DENABLE_OFFLOAD=ON -DOFFLOAD_TARGET=x86_64-pc-linux-gnu -DUSE_OBJECT_TARGET=ON -DQMC_MPI=0 ..` |
+---------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| Test Command  | `export LD_LIBRARY_PATH=/usr/lib/llvm-12/lib/:${LD_LIBRARY_PATH} && ctest --output-on-failure -L unit`                                                                     |
+---------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| Duration      | ~35 Minutes                                                                                                                                                                |
+---------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------+

macOS (macOS-GCC11-NoMPI-Real)
""""""""""""""""""""""""""""""
+---------------+------------------------------------------------------------------------------------------------------+
| Compiler      | gcc-11                                                                                               |
+---------------+------------------------------------------------------------------------------------------------------+
| Build Command | `cmake -GNinja -DCMAKE_C_COMPILER=gcc-11 -DCMAKE_CXX_COMPILER=g++-11 -DQMC_MPI=0 -DQMC_COMPLEX=0 ..` |
+---------------+------------------------------------------------------------------------------------------------------+
| Test Command  | `ctest --output-on-failure -L deterministic`                                                         |
+---------------+------------------------------------------------------------------------------------------------------+
| Objective     | Build for macOS CI using Accelerate framework and gcc-11 for openmp                                  |
+---------------+------------------------------------------------------------------------------------------------------+
| Duration      | ~27 Minutes                                                                                          |
+---------------+------------------------------------------------------------------------------------------------------+


Self-Hosted Runners
-------------------

gpu-cuda (GCC8-NoMPI-Legacy-CUDA-Real-Mixed)
""""""""""""""""""""""""""""""""""""""""""""
+---------------+---------------------------------------------------------------------------------------------------------------------------------------+
| Compiler      | gcc-8                                                                                                                                 |
+---------------+---------------------------------------------------------------------------------------------------------------------------------------+
| Build Command | `cmake -GNinja -DQMC_CUDA=1 -DQMC_MPI=0 -DQMC_COMPLEX=0 -DQMC_MIXED_PRECISION=1 ..`                                                   |
+---------------+---------------------------------------------------------------------------------------------------------------------------------------+
| Test Command  | `export LD_LIBRARY_PATH=/usr/local/cuda/lib/:/usr/local/cuda/lib64/:${LD_LIBRARY_PATH} && ctest --output-on-failure -L deterministic` |
+---------------+---------------------------------------------------------------------------------------------------------------------------------------+
| Objective     | Build for Nvidia (Real) with mixed single/double floating point precision                                                             |
+---------------+---------------------------------------------------------------------------------------------------------------------------------------+
| Duration      | ~2 Minutes                                                                                                                            |
+---------------+---------------------------------------------------------------------------------------------------------------------------------------+


gpu-cuda (GCC8-NoMPI-Legacy-CUDA-Complex-Mixed)
"""""""""""""""""""""""""""""""""""""""""""""""
+---------------+---------------------------------------------------------------------------------------------------------------------------------------+
| Compiler      | GCC                                                                                                                                   |
+---------------+---------------------------------------------------------------------------------------------------------------------------------------+
| Build Command | `cmake -GNinja -DQMC_CUDA=1 -DQMC_MPI=0 -DQMC_COMPLEX=1 -DQMC_MIXED_PRECISION=1 ..`                                                   |
+---------------+---------------------------------------------------------------------------------------------------------------------------------------+
| Test Command  | `export LD_LIBRARY_PATH=/usr/local/cuda/lib/:/usr/local/cuda/lib64/:${LD_LIBRARY_PATH} && ctest --output-on-failure -L deterministic` |
+---------------+---------------------------------------------------------------------------------------------------------------------------------------+
| Objective     | Build for Nvidia (Complex) with mixed single/double floating point precision                                                          |
+---------------+---------------------------------------------------------------------------------------------------------------------------------------+
| Duration      | ~2 Minutes                                                                                                                            |
+---------------+---------------------------------------------------------------------------------------------------------------------------------------+

gpu-cuda (GCC8-NoMPI-Legacy-CUDA-Real)
""""""""""""""""""""""""""""""""""""""
+---------------+---------------------------------------------------------------------------------------------------------------------------------------+
| Compiler      | GCC                                                                                                                                   |
+---------------+---------------------------------------------------------------------------------------------------------------------------------------+
| Build Command | `cmake -GNinja -DQMC_CUDA=1 -DQMC_MPI=0 -DQMC_COMPLEX=0 -DQMC_MIXED_PRECISION=0 ..`                                                   |
+---------------+---------------------------------------------------------------------------------------------------------------------------------------+
| Test Command  | `export LD_LIBRARY_PATH=/usr/local/cuda/lib/:/usr/local/cuda/lib64/:${LD_LIBRARY_PATH} && ctest --output-on-failure -L deterministic` |
+---------------+---------------------------------------------------------------------------------------------------------------------------------------+
| Objective     | Build for Nvidia (Real) with full double floating point precision                                                                     |
+---------------+---------------------------------------------------------------------------------------------------------------------------------------+
| Duration      | ~2 Minutes                                                                                                                            |
+---------------+---------------------------------------------------------------------------------------------------------------------------------------+


gpu-cuda (GCC8-NoMPI-Legacy-CUDA-Complex)
"""""""""""""""""""""""""""""""""""""""""
+---------------+---------------------------------------------------------------------------------------------------------------------------------------+
| Compiler      | GCC                                                                                                                                   |
+---------------+---------------------------------------------------------------------------------------------------------------------------------------+
| Build Command | `cmake -GNinja -DQMC_CUDA=1 -DQMC_MPI=0 -DQMC_COMPLEX=1 -DQMC_MIXED_PRECISION=0 ..`                                                   |
+---------------+---------------------------------------------------------------------------------------------------------------------------------------+
| Test Command  | `export LD_LIBRARY_PATH=/usr/local/cuda/lib/:/usr/local/cuda/lib64/:${LD_LIBRARY_PATH} && ctest --output-on-failure -L deterministic` |
+---------------+---------------------------------------------------------------------------------------------------------------------------------------+
| Objective     | Build for Nvidia (Complex) with full double floating point precision                                                                  |
+---------------+---------------------------------------------------------------------------------------------------------------------------------------+
| Duration      | ~2 Minutes                                                                                                                            |
+---------------+---------------------------------------------------------------------------------------------------------------------------------------+


cpu-intel64 (GCC8-NoMPI-MKL-Real-Mixed)
"""""""""""""""""""""""""""""""""""""""
+---------------+------------------------------------------------------------------------------------------------------------------------+
| NOTE          | For Intel builds, the environment script that ships with the Intel compiler needs to be sourced (e.g. compilervars.sh) |
|               | ex. source /opt/intel2020/bin/compilervars.sh -arch intel64 -platform linux                                            |
+---------------+------------------------------------------------------------------------------------------------------------------------+
| Compiler      | gcc-8                                                                                                                  |
+---------------+------------------------------------------------------------------------------------------------------------------------+
| Build Command | `cmake -GNinja -DBLA_VENDOR=Intel10_64lp -DQMC_MPI=0 -DQMC_COMPLEX=0 -DQMC_MIXED_PRECISION=1 ..`                       |
+---------------+------------------------------------------------------------------------------------------------------------------------+
| Test Command  | `source /opt/intel2020/mkl/bin/mklvars.sh intel64 && ctest --output-on-failure -L deterministic`                       |
+---------------+------------------------------------------------------------------------------------------------------------------------+
| Objective     | Build for Intel MKL (Real) with mixed single/double floating point precision                                           |
+---------------+------------------------------------------------------------------------------------------------------------------------+
| Duration      | ~2 Minutes                                                                                                             |
+---------------+------------------------------------------------------------------------------------------------------------------------+


cpu-intel64 (GCC8-NoMPI-MKL-Complex-Mixed)
""""""""""""""""""""""""""""""""""""""""""
+---------------+------------------------------------------------------------------------------------------------------------------------+
| NOTE          | For Intel builds, the environment script that ships with the Intel compiler needs to be sourced (e.g. compilervars.sh) |
|               | ex. source /opt/intel2020/bin/compilervars.sh -arch intel64 -platform linux                                            |
+---------------+------------------------------------------------------------------------------------------------------------------------+
| Compiler      | GCC                                                                                                                    |
+---------------+------------------------------------------------------------------------------------------------------------------------+
| Build Command | `cmake -GNinja -DBLA_VENDOR=Intel10_64lp -DQMC_MPI=0 -DQMC_COMPLEX=1 -DQMC_MIXED_PRECISION=1 ..`                       |
+---------------+------------------------------------------------------------------------------------------------------------------------+
| Test Command  | `source /opt/intel2020/mkl/bin/mklvars.sh intel64 && ctest --output-on-failure -L deterministic`                       |
+---------------+------------------------------------------------------------------------------------------------------------------------+
| Objective     | Build for Intel MKL (Complex) with mixed single/double floating point precision                                        |
+---------------+------------------------------------------------------------------------------------------------------------------------+
| Duration      | ~2 Minutes                                                                                                             |
+---------------+------------------------------------------------------------------------------------------------------------------------+


cpu-intel64 (GCC8-NoMPI-MKL-Real)
"""""""""""""""""""""""""""""""""
+---------------+------------------------------------------------------------------------------------------------------------------------+
| NOTE          | For Intel builds, the environment script that ships with the Intel compiler needs to be sourced (e.g. compilervars.sh) |
|               | ex. source /opt/intel2020/bin/compilervars.sh -arch intel64 -platform linux                                            |
+---------------+------------------------------------------------------------------------------------------------------------------------+
| Compiler      | GCC                                                                                                                    |
+---------------+------------------------------------------------------------------------------------------------------------------------+
| Build Command | `cmake -GNinja -DBLA_VENDOR=Intel10_64lp -DQMC_MPI=0 -DQMC_COMPLEX=0 -DQMC_MIXED_PRECISION=0 ..`                       |
+---------------+------------------------------------------------------------------------------------------------------------------------+
| Test Command  | `source /opt/intel2020/mkl/bin/mklvars.sh intel64 && ctest --output-on-failure -L deterministic`                       |
+---------------+------------------------------------------------------------------------------------------------------------------------+
| Objective     | Build for Intel MKL (Real) with full double floating point precision                                                   |
+---------------+------------------------------------------------------------------------------------------------------------------------+
| Duration      | ~2 Minutes                                                                                                             |
+---------------+------------------------------------------------------------------------------------------------------------------------+


cpu-intel64 (GCC8-NoMPI-MKL-Complex)
""""""""""""""""""""""""""""""""""""
+---------------+------------------------------------------------------------------------------------------------------------------------+
| NOTE          | For Intel builds, the environment script that ships with the Intel compiler needs to be sourced (e.g. compilervars.sh) |
|               | ex. source /opt/intel2020/bin/compilervars.sh -arch intel64 -platform linux                                            |
+---------------+------------------------------------------------------------------------------------------------------------------------+
| Compiler      | GCC                                                                                                                    |
+---------------+------------------------------------------------------------------------------------------------------------------------+
| Build Command | `cmake -GNinja -DBLA_VENDOR=Intel10_64lp -DQMC_MPI=0 -DQMC_COMPLEX=1 -DQMC_MIXED_PRECISION=0 ..`                       |
+---------------+------------------------------------------------------------------------------------------------------------------------+
| Test Command  | `source /opt/intel2020/mkl/bin/mklvars.sh intel64 && ctest --output-on-failure -L deterministic`                       |
+---------------+------------------------------------------------------------------------------------------------------------------------+
| Objective     | Build for Intel MKL (Complex) with full double floating point precision                                                |
+---------------+------------------------------------------------------------------------------------------------------------------------+
| Duration      | ~2 Minutes                                                                                                             |
+---------------+------------------------------------------------------------------------------------------------------------------------+


gpu-cuda (GCC8-MPI-CUDA-AFQMC-Real-Mixed)
"""""""""""""""""""""""""""""""""""""""""
+---------------+------------------------------------------------------------------------------------------------------------------------+
| Compiler      | GCC                                                                                                                    |
+---------------+------------------------------------------------------------------------------------------------------------------------+
| Build Command | `cmake -GNinja -DCMAKE_C_COMPILER=mpicc \                                                                              |
|               | -DCMAKE_CXX_COMPILER=mpicxx \                                                                                          |
|               | -DMPIEXEC_EXECUTABLE=mpirun \                                                                                          |
|               | -DBUILD_AFQMC=ON \                                                                                                     |
|               | -DENABLE_CUDA=ON \                                                                                                     |
|               | -DCMAKE_PREFIX_PATH="/opt/OpenBLAS/0.3.18" \                                                                           |
|               | -DCMAKE_BUILD_TYPE=RelWithDebInfo \                                                                                    |
|               | -DQMC_COMPLEX=0 \                                                                                                      |
|               | -DQMC_MIXED_PRECISION=1 \                                                                                              |
|               | ..`                                                                                                                    |
+---------------+------------------------------------------------------------------------------------------------------------------------+
| Test Command  | `export LD_LIBRARY_PATH=/usr/local/cuda/lib/:/usr/local/cuda/lib64/:${LD_LIBRARY_PATH} \                               |
|               | && export OMPI_MCA_btl=self && ctest --output-on-failure -L deterministic`                                             |
+---------------+------------------------------------------------------------------------------------------------------------------------+
| Objective     | Build for Nvidia (Real) with mixed single/double floating point precision, Auxiliary-Field Quantum Monte Carlo enabled |
+---------------+------------------------------------------------------------------------------------------------------------------------+
| Duration      | ~6 Minutes                                                                                                             |
+---------------+------------------------------------------------------------------------------------------------------------------------+


gpu-cuda (GCC8-MPI-CUDA-AFQMC-Complex-Mixed)
""""""""""""""""""""""""""""""""""""""""""""
+---------------+------------------------------------------------------------------------------------------------------------------------+
| Compiler      | GCC                                                                                                                    |
+---------------+------------------------------------------------------------------------------------------------------------------------+
| Build Command | `cmake -GNinja -DCMAKE_C_COMPILER=mpicc \                                                                              |
|               | -DCMAKE_CXX_COMPILER=mpicxx \                                                                                          |
|               | -DMPIEXEC_EXECUTABLE=mpirun \                                                                                          |
|               | -DBUILD_AFQMC=ON \                                                                                                     |
|               | -DENABLE_CUDA=ON \                                                                                                     |
|               | -DCMAKE_PREFIX_PATH="/opt/OpenBLAS/0.3.18" \                                                                           |
|               | -DCMAKE_BUILD_TYPE=RelWithDebInfo \                                                                                    |
|               | -DQMC_COMPLEX=1 \                                                                                                      |
|               | -DQMC_MIXED_PRECISION=1 \                                                                                              |
|               | ..`                                                                                                                    |
+---------------+------------------------------------------------------------------------------------------------------------------------+
| Test Command  | `export LD_LIBRARY_PATH=/usr/local/cuda/lib/:/usr/local/cuda/lib64/:${LD_LIBRARY_PATH} \                               |
|               | && export OMPI_MCA_btl=self && ctest --output-on-failure -L deterministic`                                             |
+---------------+------------------------------------------------------------------------------------------------------------------------+
| Objective     | Build for Nvidia (Real) with mixed single/double floating point precision, Auxiliary-Field Quantum Monte Carlo enabled |
+---------------+------------------------------------------------------------------------------------------------------------------------+
| Duration      | ~6 Minutes                                                                                                             |
+---------------+------------------------------------------------------------------------------------------------------------------------+


gpu-cuda (GCC8-MPI-CUDA-AFQMC-Real)
"""""""""""""""""""""""""""""""""""
+---------------+------------------------------------------------------------------------------------------------------------------------+
| Compiler      | GCC                                                                                                                    |
+---------------+------------------------------------------------------------------------------------------------------------------------+
| Build Command | `cmake -GNinja -DCMAKE_C_COMPILER=mpicc \                                                                              |
|               | -DCMAKE_CXX_COMPILER=mpicxx \                                                                                          |
|               | -DMPIEXEC_EXECUTABLE=mpirun \                                                                                          |
|               | -DBUILD_AFQMC=ON \                                                                                                     |
|               | -DENABLE_CUDA=ON \                                                                                                     |
|               | -DCMAKE_PREFIX_PATH="/opt/OpenBLAS/0.3.18" \                                                                           |
|               | -DCMAKE_BUILD_TYPE=RelWithDebInfo \                                                                                    |
|               | -DQMC_COMPLEX=0 \                                                                                                      |
|               | -DQMC_MIXED_PRECISION=0 \                                                                                              |
|               | ..`                                                                                                                    |
+---------------+------------------------------------------------------------------------------------------------------------------------+
| Test Command  | `export LD_LIBRARY_PATH=/usr/local/cuda/lib/:/usr/local/cuda/lib64/:${LD_LIBRARY_PATH} \                               |
|               | && export OMPI_MCA_btl=self && ctest --output-on-failure -L deterministic`                                             |
+---------------+------------------------------------------------------------------------------------------------------------------------+
| Objective     | Build for Nvidia (Real) with mixed single/double floating point precision, Auxiliary-Field Quantum Monte Carlo enabled |
+---------------+------------------------------------------------------------------------------------------------------------------------+
| Duration      | ~6 Minutes                                                                                                             |
+---------------+------------------------------------------------------------------------------------------------------------------------+


gpu-cuda (GCC8-MPI-CUDA-AFQMC-Complex)
""""""""""""""""""""""""""""""""""""""
+---------------+------------------------------------------------------------------------------------------------------------------------+
| Compiler      | GCC                                                                                                                    |
+---------------+------------------------------------------------------------------------------------------------------------------------+
| Build Command | `cmake -GNinja -DCMAKE_C_COMPILER=mpicc \                                                                              |
|               | -DCMAKE_CXX_COMPILER=mpicxx \                                                                                          |
|               | -DMPIEXEC_EXECUTABLE=mpirun \                                                                                          |
|               | -DBUILD_AFQMC=ON \                                                                                                     |
|               | -DENABLE_CUDA=ON \                                                                                                     |
|               | -DCMAKE_PREFIX_PATH="/opt/OpenBLAS/0.3.18" \                                                                           |
|               | -DCMAKE_BUILD_TYPE=RelWithDebInfo \                                                                                    |
|               | -DQMC_COMPLEX=1 \                                                                                                      |
|               | -DQMC_MIXED_PRECISION=0 \                                                                                              |
|               | ..`                                                                                                                    |
+---------------+------------------------------------------------------------------------------------------------------------------------+
| Test Command  | `export LD_LIBRARY_PATH=/usr/local/cuda/lib/:/usr/local/cuda/lib64/:${LD_LIBRARY_PATH} \                               |
|               | && export OMPI_MCA_btl=self && ctest --output-on-failure -L deterministic`                                             |
+---------------+------------------------------------------------------------------------------------------------------------------------+
| Objective     | Build for Nvidia (Real) with mixed single/double floating point precision, Auxiliary-Field Quantum Monte Carlo enabled |
+---------------+------------------------------------------------------------------------------------------------------------------------+
| Duration      | ~6 Minutes                                                                                                             |
+---------------+------------------------------------------------------------------------------------------------------------------------+


gpu-cuda (Clang14Dev-MPI-CUDA-AFQMC-Offload-Real-Mixed)
"""""""""""""""""""""""""""""""""""""""""""""""""""""""
+---------------+------------------------------------------------------------------------------------------------------------------------------------------+
| Compiler      | Clang 14                                                                                                                                 |
+---------------+------------------------------------------------------------------------------------------------------------------------------------------+
| Build Command | `export OMPI_CC=clang-14 && \                                                                                                            |
|               | export OMPI_CXX=clang++-14 && \                                                                                                          |
|               | cmake -GNinja -DCMAKE_C_COMPILER=mpicc \                                                                                                 |
|               | -DCMAKE_CXX_COMPILER=mpicxx \                                                                                                            |
|               | -DMPIEXEC_EXECUTABLE=mpirun \                                                                                                            |
|               | -DBUILD_AFQMC=ON \                                                                                                                       |
|               | -DENABLE_CUDA=ON \                                                                                                                       |
|               | -DENABLE_OFFLOAD=ON \                                                                                                                    |
|               | -DUSE_OBJECT_TARGET=ON \                                                                                                                 |
|               | -DCMAKE_PREFIX_PATH="/opt/OpenBLAS/0.3.18" \                                                                                             |
|               | -DCMAKE_BUILD_TYPE=RelWithDebInfo \                                                                                                      |
|               | -DQMC_COMPLEX=0 \                                                                                                                        |
|               | -DQMC_MIXED_PRECISION=1 \                                                                                                                |
|               | ..`                                                                                                                                      |
+---------------+------------------------------------------------------------------------------------------------------------------------------------------+
| Test Command  | `export LD_LIBRARY_PATH=/usr/local/cuda/lib/:/usr/local/cuda/lib64/:${LD_LIBRARY_PATH} \                                                 |
|               | && export OMPI_MCA_btl=self && export LD_LIBRARY_PATH=/usr/lib/llvm-12/lib/:${LD_LIBRARY_PATH} \                                         |
|               | && export LIBOMP_USE_HIDDEN_HELPER_TASK=0 \                                                                                              |
|               | && export LD_LIBRARY_PATH=/opt/llvm/01d59c0de822/lib:/usr/lib64/openmpi/lib/:${LD_LIBRARY_PATH} \                                        |
|               | && ctest --output-on-failure -L deterministic`                                                                                           |
+---------------+------------------------------------------------------------------------------------------------------------------------------------------+
| Objective     | Build for Nvidia (Real) with mixed single/double floating point precision, Auxiliary-Field Quantum Monte Carlo enabled , offload enabled |
+---------------+------------------------------------------------------------------------------------------------------------------------------------------+
| Duration      | ~6 Minutes                                                                                                                               |
+---------------+------------------------------------------------------------------------------------------------------------------------------------------+


gpu-cuda (Clang14Dev-MPI-CUDA-AFQMC-Offload-Real)
"""""""""""""""""""""""""""""""""""""""""""""""""
+---------------+-------------------------------------------------------------------------------------------------------------------------------------+
| Compiler      | Clang 14                                                                                                                            |
+---------------+-------------------------------------------------------------------------------------------------------------------------------------+
| Build Command | `export OMPI_CC=clang-14 && \                                                                                                       |
|               | export OMPI_CXX=clang++-14 && \                                                                                                     |
|               | cmake -GNinja -DCMAKE_C_COMPILER=mpicc \                                                                                            |
|               | -DCMAKE_CXX_COMPILER=mpicxx \                                                                                                       |
|               | -DMPIEXEC_EXECUTABLE=mpirun \                                                                                                       |
|               | -DBUILD_AFQMC=ON \                                                                                                                  |
|               | -DENABLE_CUDA=ON \                                                                                                                  |
|               | -DENABLE_OFFLOAD=ON \                                                                                                               |
|               | -DUSE_OBJECT_TARGET=ON \                                                                                                            |
|               | -DCMAKE_PREFIX_PATH="/opt/OpenBLAS/0.3.18" \                                                                                        |
|               | -DCMAKE_BUILD_TYPE=RelWithDebInfo \                                                                                                 |
|               | -DQMC_COMPLEX=0 \                                                                                                                   |
|               | -DQMC_MIXED_PRECISION=0 \                                                                                                           |
|               | ..`                                                                                                                                 |
+---------------+-------------------------------------------------------------------------------------------------------------------------------------+
| Test Command  | `export LD_LIBRARY_PATH=/usr/local/cuda/lib/:/usr/local/cuda/lib64/:${LD_LIBRARY_PATH} \                                            |
|               | && export OMPI_MCA_btl=self && export LD_LIBRARY_PATH=/usr/lib/llvm-12/lib/:${LD_LIBRARY_PATH} \                                    |
|               | && export LIBOMP_USE_HIDDEN_HELPER_TASK=0 \                                                                                         |
|               | && export LD_LIBRARY_PATH=/opt/llvm/01d59c0de822/lib:/usr/lib64/openmpi/lib/:${LD_LIBRARY_PATH} \                                   |
|               | && ctest --output-on-failure -L deterministic`                                                                                      |
+---------------+-------------------------------------------------------------------------------------------------------------------------------------+
| Objective     | Build for Nvidia (Complex) with full double floating point precision, Auxiliary-Field Quantum Monte Carlo enabled , offload enabled |
+---------------+-------------------------------------------------------------------------------------------------------------------------------------+
| Duration      | ~6 Minutes                                                                                                                          |
+---------------+-------------------------------------------------------------------------------------------------------------------------------------+


gpu-cuda (Intel19-MPI-CUDA-AFQMC-Real-Mixed)
""""""""""""""""""""""""""""""""""""""""""""
+---------------+------------------------------------------------------------------------------------------------------------------------+
| NOTE          | For Intel builds, the environment script that ships with the Intel compiler needs to be sourced (e.g. compilervars.sh) |
|               | ex. source /opt/intel2020/bin/compilervars.sh -arch intel64 -platform linux                                            |
+---------------+------------------------------------------------------------------------------------------------------------------------+
| Compiler      | Intel                                                                                                                  |
+---------------+------------------------------------------------------------------------------------------------------------------------+
| Build Command | `export OMPI_CC=icc && \                                                                                               |
|               | export OMPI_CXX=icpc && \                                                                                              |
|               | cmake -GNinja -DCMAKE_C_COMPILER=/usr/lib64/openmpi/bin/mpicc \                                                        |
|               | -DCMAKE_CXX_COMPILER=/usr/lib64/openmpi/bin/mpicxx \                                                                   |
|               | -DMPIEXEC_EXECUTABLE=/usr/lib64/openmpi/bin/mpirun \                                                                   |
|               | -DBUILD_AFQMC=ON \                                                                                                     |
|               | -DENABLE_CUDA=ON \                                                                                                     |
|               | -DCMAKE_PREFIX_PATH=/opt/OpenBLAS/0.3.18 \                                                                             |
|               | -DQMC_COMPLEX=0 \                                                                                                      |
|               | -DQMC_MIXED_PRECISION=1 \                                                                                              |
|               | -DCMAKE_BUILD_TYPE=RelWithDebInfo ..`                                                                                  |
+---------------+------------------------------------------------------------------------------------------------------------------------+
| Test Command  | `export LD_LIBRARY_PATH=/usr/local/cuda/lib/:/usr/local/cuda/lib64/:${LD_LIBRARY_PATH} \                               |
|               | && export OMPI_MCA_btl=self && export LD_LIBRARY_PATH=/usr/lib/llvm-12/lib/:${LD_LIBRARY_PATH} \                       |
|               | && export LIBOMP_USE_HIDDEN_HELPER_TASK=0 \                                                                            |
|               | && export LD_LIBRARY_PATH=/opt/llvm/01d59c0de822/lib:/usr/lib64/openmpi/lib/:${LD_LIBRARY_PATH} \                      |
|               | && ctest --output-on-failure -L deterministic -j 16`                                                                   |
+---------------+------------------------------------------------------------------------------------------------------------------------+
| Objective     | Build for Nvidia (Real) with mixed single/double floating point precision, Auxiliary-Field Quantum Monte Carlo enabled |
+---------------+------------------------------------------------------------------------------------------------------------------------+
| Duration      | ~6 Minutes                                                                                                             |
+---------------+------------------------------------------------------------------------------------------------------------------------+


gpu-cuda (Intel19-MPI-CUDA-AFQMC-Complex-Mixed)
"""""""""""""""""""""""""""""""""""""""""""""""
+---------------+------------------------------------------------------------------------------------------------------------------------+
| NOTE          | For Intel builds, the environment script that ships with the Intel compiler needs to be sourced (e.g. compilervars.sh) |
|               | ex. source /opt/intel2020/bin/compilervars.sh -arch intel64 -platform linux                                            |
+---------------+---------------------------------------------------------------------------------------------------------------------------+
| Compiler      | Intel                                                                                                                     |
+---------------+---------------------------------------------------------------------------------------------------------------------------+
| Build Command | `export OMPI_CC=icc && \                                                                                                  |
|               | export OMPI_CXX=icpc && \                                                                                                 |
|               | cmake -GNinja -DCMAKE_C_COMPILER=/usr/lib64/openmpi/bin/mpicc \                                                           |
|               | -DCMAKE_CXX_COMPILER=/usr/lib64/openmpi/bin/mpicxx \                                                                      |
|               | -DMPIEXEC_EXECUTABLE=/usr/lib64/openmpi/bin/mpirun \                                                                      |
|               | -DBUILD_AFQMC=ON \                                                                                                        |
|               | -DENABLE_CUDA=ON \                                                                                                        |
|               | -DCMAKE_PREFIX_PATH=/opt/OpenBLAS/0.3.18 \                                                                                |
|               | -DQMC_COMPLEX=1 \                                                                                                         |
|               | -DQMC_MIXED_PRECISION=1 \                                                                                                 |
|               | -DCMAKE_BUILD_TYPE=RelWithDebInfo ..`                                                                                     |
+---------------+---------------------------------------------------------------------------------------------------------------------------+
| Test Command  | `export LD_LIBRARY_PATH=/usr/local/cuda/lib/:/usr/local/cuda/lib64/:${LD_LIBRARY_PATH} \                                  |
|               | && export OMPI_MCA_btl=self && export LD_LIBRARY_PATH=/usr/lib/llvm-12/lib/:${LD_LIBRARY_PATH} \                          |
|               | && export LIBOMP_USE_HIDDEN_HELPER_TASK=0 \                                                                               |
|               | && export LD_LIBRARY_PATH=/opt/llvm/01d59c0de822/lib:/usr/lib64/openmpi/lib/:${LD_LIBRARY_PATH} \                         |
|               | && ctest --output-on-failure -L deterministic -j 16`                                                                      |
+---------------+---------------------------------------------------------------------------------------------------------------------------+
| Objective     | Build for Nvidia (Complex) with mixed single/double floating point precision, Auxiliary-Field Quantum Monte Carlo enabled |
+---------------+---------------------------------------------------------------------------------------------------------------------------+
| Duration      | ~6 Minutes                                                                                                                |
+---------------+---------------------------------------------------------------------------------------------------------------------------+


gpu-cuda (Intel19-MPI-CUDA-AFQMC-Real)
""""""""""""""""""""""""""""""""""""""
+---------------+------------------------------------------------------------------------------------------------------------------------+
| NOTE          | For Intel builds, the environment script that ships with the Intel compiler needs to be sourced (e.g. compilervars.sh) |
|               | ex. source /opt/intel2020/bin/compilervars.sh -arch intel64 -platform linux                                            |
+---------------+------------------------------------------------------------------------------------------------------------------------+
| Compiler      | Intel                                                                                                                  |
+---------------+------------------------------------------------------------------------------------------------------------------------+
| Build Command | `export OMPI_CC=icc && \                                                                                               |
|               | export OMPI_CXX=icpc && \                                                                                              |
|               | cmake -GNinja -DCMAKE_C_COMPILER=/usr/lib64/openmpi/bin/mpicc \                                                        |
|               | -DCMAKE_CXX_COMPILER=/usr/lib64/openmpi/bin/mpicxx \                                                                   |
|               | -DMPIEXEC_EXECUTABLE=/usr/lib64/openmpi/bin/mpirun \                                                                   |
|               | -DBUILD_AFQMC=ON \                                                                                                     |
|               | -DENABLE_CUDA=ON \                                                                                                     |
|               | -DCMAKE_PREFIX_PATH=/opt/OpenBLAS/0.3.18 \                                                                             |
|               | -DQMC_COMPLEX=0 \                                                                                                      |
|               | -DQMC_MIXED_PRECISION=0 \                                                                                              |
|               | -DCMAKE_BUILD_TYPE=RelWithDebInfo ..`                                                                                  |
+---------------+------------------------------------------------------------------------------------------------------------------------+
| Test Command  | `export LD_LIBRARY_PATH=/usr/local/cuda/lib/:/usr/local/cuda/lib64/:${LD_LIBRARY_PATH} \                               |
|               | && export OMPI_MCA_btl=self && export LD_LIBRARY_PATH=/usr/lib/llvm-12/lib/:${LD_LIBRARY_PATH} \                       |
|               | && export LIBOMP_USE_HIDDEN_HELPER_TASK=0 \                                                                            |
|               | && export LD_LIBRARY_PATH=/opt/llvm/01d59c0de822/lib:/usr/lib64/openmpi/lib/:${LD_LIBRARY_PATH} \                      |
|               | && ctest --output-on-failure -L deterministic -j 16`                                                                   |
+---------------+------------------------------------------------------------------------------------------------------------------------+
| Objective     | Build for Nvidia (Real) with full double floating point precision, Auxiliary-Field Quantum Monte Carlo enabled         |
+---------------+------------------------------------------------------------------------------------------------------------------------+
| Duration      | ~6 Minutes                                                                                                             |
+---------------+------------------------------------------------------------------------------------------------------------------------+


gpu-cuda (Intel19-MPI-CUDA-AFQMC-Complex)
"""""""""""""""""""""""""""""""""""""""""
+---------------+------------------------------------------------------------------------------------------------------------------------+
| NOTE          | For Intel builds, the environment script that ships with the Intel compiler needs to be sourced (e.g. compilervars.sh) |
|               | ex. source /opt/intel2020/bin/compilervars.sh -arch intel64 -platform linux                                            |
+---------------+------------------------------------------------------------------------------------------------------------------------+
| Compiler      | Intel                                                                                                                  |
+---------------+------------------------------------------------------------------------------------------------------------------------+
| Build Command | `export OMPI_CC=icc && \                                                                                               |
|               | export OMPI_CXX=icpc && \                                                                                              |
|               | cmake -GNinja -DCMAKE_C_COMPILER=/usr/lib64/openmpi/bin/mpicc \                                                        |
|               | -DCMAKE_CXX_COMPILER=/usr/lib64/openmpi/bin/mpicxx \                                                                   |
|               | -DMPIEXEC_EXECUTABLE=/usr/lib64/openmpi/bin/mpirun \                                                                   |
|               | -DBUILD_AFQMC=ON \                                                                                                     |
|               | -DENABLE_CUDA=ON \                                                                                                     |
|               | -DCMAKE_PREFIX_PATH=/opt/OpenBLAS/0.3.18 \                                                                             |
|               | -DQMC_COMPLEX=1 \                                                                                                      |
|               | -DQMC_MIXED_PRECISION=0 \                                                                                              |
|               | -DCMAKE_BUILD_TYPE=RelWithDebInfo ..`                                                                                  |
+---------------+------------------------------------------------------------------------------------------------------------------------+
| Test Command  | `export LD_LIBRARY_PATH=/usr/local/cuda/lib/:/usr/local/cuda/lib64/:${LD_LIBRARY_PATH} \                               |
|               | && export OMPI_MCA_btl=self && export LD_LIBRARY_PATH=/usr/lib/llvm-12/lib/:${LD_LIBRARY_PATH} \                       |
|               | && export LIBOMP_USE_HIDDEN_HELPER_TASK=0 \                                                                            |
|               | && export LD_LIBRARY_PATH=/opt/llvm/01d59c0de822/lib:/usr/lib64/openmpi/lib/:${LD_LIBRARY_PATH} \                      |
|               | && ctest --output-on-failure -L deterministic -j 16`                                                                   |
+---------------+------------------------------------------------------------------------------------------------------------------------+
| Objective     | Build for Nvidia (Complex) with full double floating point precision, Auxiliary-Field Quantum Monte Carlo enabled      |
+---------------+------------------------------------------------------------------------------------------------------------------------+
| Duration      | ~6 Minutes                                                                                                             |
+---------------+------------------------------------------------------------------------------------------------------------------------+


gpu-hip (ROCm-Clang13-NoMPI-CUDA2HIP-Real-Mixed)
"""""""""""""""""""""""""""""""""""""""""""""""""
+---------------+---------------------------------------------------------------------------------------------------+
| Compiler      | Clang13                                                                                           |
+---------------+---------------------------------------------------------------------------------------------------+
| Build Command | `export CUDACXX=/usr/local/cuda/bin/nvcc \                                                        |
|               | && cmake -GNinja -DCMAKE_C_COMPILER=/opt/rocm/llvm/bin/clang \                                    |
|               | -DCMAKE_CXX_COMPILER=/opt/rocm/llvm/bin/clang++ \                                                 |
|               | -DQMC_MPI=0 \                                                                                     |
|               | -DENABLE_CUDA=ON \                                                                                |
|               | -DQMC_CUDA2HIP=ON \                                                                               |
|               | -DCMAKE_PREFIX_PATH=/opt/OpenBLAS/0.3.18 \                                                        |
|               | -DQMC_COMPLEX=0 \                                                                                 |
|               | -DQMC_MIXED_PRECISION=1 \                                                                         |
|               | -DCMAKE_BUILD_TYPE=RelWithDebInfo ..`                                                             |
+---------------+---------------------------------------------------------------------------------------------------+
| Test Command  | `export LD_LIBRARY_PATH=/usr/local/cuda/lib/:/usr/local/cuda/lib64/:${LD_LIBRARY_PATH} \          |
|               | && export OMPI_MCA_btl=self && export LD_LIBRARY_PATH=/usr/lib/llvm-12/lib/:${LD_LIBRARY_PATH} \  |
|               | && export LIBOMP_USE_HIDDEN_HELPER_TASK=0 \                                                       |
|               | && export LD_LIBRARY_PATH=/opt/llvm/01d59c0de822/lib:/usr/lib64/openmpi/lib/:${LD_LIBRARY_PATH} \ |
|               | && ctest --output-on-failure -L deterministic -j 16`                                              |
+---------------+---------------------------------------------------------------------------------------------------+
| Objective     | Build for AMD (Real) with mixed single/double floating point precision                            |
+---------------+---------------------------------------------------------------------------------------------------+
| Duration      | ~10 Minutes                                                                                       |
+---------------+---------------------------------------------------------------------------------------------------+


gpu-hip (ROCm-Clang13-NoMPI-CUDA2HIP-Real)
"""""""""""""""""""""""""""""""""""""""""""""""""
+---------------+---------------------------------------------------------------------------------------------------+
| Compiler      | Clang13                                                                                           |
+---------------+---------------------------------------------------------------------------------------------------+
| Build Command | `export CUDACXX=/usr/local/cuda/bin/nvcc \                                                        |
|               | && cmake -GNinja -DCMAKE_C_COMPILER=/opt/rocm/llvm/bin/clang \                                    |
|               | -DCMAKE_CXX_COMPILER=/opt/rocm/llvm/bin/clang++ \                                                 |
|               | -DQMC_MPI=0 \                                                                                     |
|               | -DENABLE_CUDA=ON \                                                                                |
|               | -DQMC_CUDA2HIP=ON \                                                                               |
|               | -DCMAKE_PREFIX_PATH=/opt/OpenBLAS/0.3.18 \                                                        |
|               | -DQMC_COMPLEX=0 \                                                                                 |
|               | -DQMC_MIXED_PRECISION=0 \                                                                         |
|               | -DCMAKE_BUILD_TYPE=RelWithDebInfo ..`                                                             |
+---------------+---------------------------------------------------------------------------------------------------+
| Test Command  | `export LD_LIBRARY_PATH=/usr/local/cuda/lib/:/usr/local/cuda/lib64/:${LD_LIBRARY_PATH} \          |
|               | && export OMPI_MCA_btl=self && export LD_LIBRARY_PATH=/usr/lib/llvm-12/lib/:${LD_LIBRARY_PATH} \  |
|               | && export LIBOMP_USE_HIDDEN_HELPER_TASK=0 \                                                       |
|               | && export LD_LIBRARY_PATH=/opt/llvm/01d59c0de822/lib:/usr/lib64/openmpi/lib/:${LD_LIBRARY_PATH} \ |
|               | && ctest --output-on-failure -L deterministic -j 16`                                              |
+---------------+---------------------------------------------------------------------------------------------------+
| Objective     | Build for AMD (Real) with full double floating point precision                                    |
+---------------+---------------------------------------------------------------------------------------------------+
| Duration      | ~12 Minutes                                                                                       |
+---------------+---------------------------------------------------------------------------------------------------+


gpu-hip (ROCm-Clang13-NoMPI-CUDA2HIP-Complex-Mixed)
"""""""""""""""""""""""""""""""""""""""""""""""""
+---------------+---------------------------------------------------------------------------------------------------+
| Compiler      | Clang13                                                                                           |
+---------------+---------------------------------------------------------------------------------------------------+
| Build Command | `export CUDACXX=/usr/local/cuda/bin/nvcc \                                                        |
|               | && cmake -GNinja -DCMAKE_C_COMPILER=/opt/rocm/llvm/bin/clang \                                    |
|               | -DCMAKE_CXX_COMPILER=/opt/rocm/llvm/bin/clang++ \                                                 |
|               | -DQMC_MPI=0 \                                                                                     |
|               | -DENABLE_CUDA=ON \                                                                                |
|               | -DQMC_CUDA2HIP=ON \                                                                               |
|               | -DCMAKE_PREFIX_PATH=/opt/OpenBLAS/0.3.18 \                                                        |
|               | -DQMC_COMPLEX=1 \                                                                                 |
|               | -DQMC_MIXED_PRECISION=1 \                                                                         |
|               | -DCMAKE_BUILD_TYPE=RelWithDebInfo ..`                                                             |
+---------------+---------------------------------------------------------------------------------------------------+
| Test Command  | `export LD_LIBRARY_PATH=/usr/local/cuda/lib/:/usr/local/cuda/lib64/:${LD_LIBRARY_PATH} \          |
|               | && export OMPI_MCA_btl=self && export LD_LIBRARY_PATH=/usr/lib/llvm-12/lib/:${LD_LIBRARY_PATH} \  |
|               | && export LIBOMP_USE_HIDDEN_HELPER_TASK=0 \                                                       |
|               | && export LD_LIBRARY_PATH=/opt/llvm/01d59c0de822/lib:/usr/lib64/openmpi/lib/:${LD_LIBRARY_PATH} \ |
|               | && ctest --output-on-failure -L deterministic -j 16`                                              |
+---------------+---------------------------------------------------------------------------------------------------+
| Objective     | Build for AMD (Complex) with mixed single/double floating point precision                         |
+---------------+---------------------------------------------------------------------------------------------------+
| Duration      | ~10 Minutes                                                                                       |
+---------------+---------------------------------------------------------------------------------------------------+


gpu-hip (ROCm-Clang13-NoMPI-CUDA2HIP-Complex)
"""""""""""""""""""""""""""""""""""""""""""""""""
+---------------+---------------------------------------------------------------------------------------------------+
| Compiler      | Clang13                                                                                           |
+---------------+---------------------------------------------------------------------------------------------------+
| Build Command | `export CUDACXX=/usr/local/cuda/bin/nvcc \                                                        |
|               | && cmake -GNinja -DCMAKE_C_COMPILER=/opt/rocm/llvm/bin/clang \                                    |
|               | -DCMAKE_CXX_COMPILER=/opt/rocm/llvm/bin/clang++ \                                                 |
|               | -DQMC_MPI=0 \                                                                                     |
|               | -DENABLE_CUDA=ON \                                                                                |
|               | -DQMC_CUDA2HIP=ON \                                                                               |
|               | -DCMAKE_PREFIX_PATH=/opt/OpenBLAS/0.3.18 \                                                        |
|               | -DQMC_COMPLEX=1 \                                                                                 |
|               | -DQMC_MIXED_PRECISION=0 \                                                                         |
|               | -DCMAKE_BUILD_TYPE=RelWithDebInfo ..`                                                             |
+---------------+---------------------------------------------------------------------------------------------------+
| Test Command  | `export LD_LIBRARY_PATH=/usr/local/cuda/lib/:/usr/local/cuda/lib64/:${LD_LIBRARY_PATH} \          |
|               | && export OMPI_MCA_btl=self && export LD_LIBRARY_PATH=/usr/lib/llvm-12/lib/:${LD_LIBRARY_PATH} \  |
|               | && export LIBOMP_USE_HIDDEN_HELPER_TASK=0 \                                                       |
|               | && export LD_LIBRARY_PATH=/opt/llvm/01d59c0de822/lib:/usr/lib64/openmpi/lib/:${LD_LIBRARY_PATH} \ |
|               | && ctest --output-on-failure -L deterministic -j 16`                                              |
+---------------+---------------------------------------------------------------------------------------------------+
| Objective     | Build for AMD (Complex) with full double floating point precision                                 |
+---------------+---------------------------------------------------------------------------------------------------+
| Duration      | ~12 Minutes                                                                                       |
+---------------+---------------------------------------------------------------------------------------------------+


Workflow Steps
==============

We define these jobs in the yaml files located in the .github/workflows directory.  Each of the jobs currently runs through the yaml files utilizing steps defined in a `test/test_automation/github-actions/ci/run_step.sh <https://github.com/QMCPACK/qmcpack/tree/develop/tests/test_automation/github-actions/ci/run_step.sh>`_ file.

This script applies workflow branching (if-else) based on the job name(for instance the job needs to contain the keyword 'coverage' in order to trigger the Coverage step) and other boolean checks.

The currently defined steps are:

Checkout Action
---------------
Triggers `actions/checkout@v1` which is a predefined Github Action for checking out the repo.

Configure
---------
Based on certain keywords in the job name, it will add job-specific flags.

Build
-----
After configuration it issues a build command.

Test
----
Runs tests appropriate to job name.(complex vs real, asan, etc.)

Coverage
--------
Generate code coverage reports once all tests have reported.

Upload Coverage
---------------
Upload the generated code coverage to `CodeCov <https://codecov.io/gh/QMCPACK/qmcpack/tree/develop/src>`_ where the badges on our repo will then be updated. Only done by jobs with name `*-coverage`.
