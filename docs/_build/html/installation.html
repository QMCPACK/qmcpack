

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Obtaining, installing, and validating QMCPACK &mdash; QMC Manual 0.0.1 documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
        <script src="_static/language_data.js"></script>
        <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Specifying the Simulation Cell" href="simulationcell.html" />
    <link rel="prev" title="Features of QMCPACK" href="features.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html" class="icon icon-home"> QMC Manual
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="introduction.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="features.html">Features of QMCPACK</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Obtaining, installing, and validating QMCPACK</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#installation-steps">Installation steps</a></li>
<li class="toctree-l2"><a class="reference internal" href="#obtaining-the-latest-release-version">Obtaining the latest release version</a></li>
<li class="toctree-l2"><a class="reference internal" href="#obtaining-the-latest-development-version">Obtaining the latest development version</a></li>
<li class="toctree-l2"><a class="reference internal" href="#prerequisites">Prerequisites</a></li>
<li class="toctree-l2"><a class="reference internal" href="#c-14-standard-library">C++ 14 standard library</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#intel-compiler">Intel compiler</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#building-with-cmake">Building with CMake</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#quick-build-instructions-try-first">Quick build instructions (try first)</a></li>
<li class="toctree-l3"><a class="reference internal" href="#environment-variables">Environment variables</a></li>
<li class="toctree-l3"><a class="reference internal" href="#configuration-options">Configuration Options</a></li>
<li class="toctree-l3"><a class="reference internal" href="#installation-from-cmake">Installation from CMake</a></li>
<li class="toctree-l3"><a class="reference internal" href="#role-of-qmc-data">Role of QMC_DATA</a></li>
<li class="toctree-l3"><a class="reference internal" href="#configure-and-build-using-cmake-and-make">Configure and build using CMake and make</a></li>
<li class="toctree-l3"><a class="reference internal" href="#example-configure-and-build">Example configure and build</a></li>
<li class="toctree-l3"><a class="reference internal" href="#build-scripts">Build scripts</a></li>
<li class="toctree-l3"><a class="reference internal" href="#using-vendor-optimized-numerical-libraries-e-g-intel-mkl">Using vendor-optimized numerical libraries (e.g., Intel MKL)</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#using-intel-mkl-with-non-intel-compilers">Using Intel MKL with non-Intel compilers</a></li>
<li class="toctree-l4"><a class="reference internal" href="#serial-or-multithreaded-library">Serial or multithreaded library</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#cross-compiling">Cross compiling</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#installation-instructions-for-common-workstations-and-supercomputers">Installation instructions for common workstations and supercomputers</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#installing-on-ubuntu-linux-or-other-apt-get-based-distributions">Installing on Ubuntu Linux or other apt-get–based distributions</a></li>
<li class="toctree-l3"><a class="reference internal" href="#installing-on-centos-linux-or-other-yum-based-distributions">Installing on CentOS Linux or other yum-based distributions</a></li>
<li class="toctree-l3"><a class="reference internal" href="#installing-on-mac-os-x-using-macports">Installing on Mac OS X using Macports</a></li>
<li class="toctree-l3"><a class="reference internal" href="#installing-on-mac-os-x-using-homebrew-brew">Installing on Mac OS X using Homebrew (brew)</a></li>
<li class="toctree-l3"><a class="reference internal" href="#installing-on-alcf-theta-cray-xc40">Installing on ALCF Theta, Cray XC40</a></li>
<li class="toctree-l3"><a class="reference internal" href="#installing-on-ornl-olcf-summit">Installing on ORNL OLCF Summit</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#building-qmcpack">Building QMCPACK</a></li>
<li class="toctree-l4"><a class="reference internal" href="#building-quantum-espresso">Building Quantum Espresso</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#installing-on-nersc-cori-haswell-partition-cray-xc40">Installing on NERSC Cori, Haswell Partition, Cray XC40</a></li>
<li class="toctree-l3"><a class="reference internal" href="#installing-on-nersc-cori-xeon-phi-knl-partition-cray-xc40">Installing on NERSC Cori, Xeon Phi KNL partition, Cray XC40</a></li>
<li class="toctree-l3"><a class="reference internal" href="#installing-on-systems-with-armv8-based-processors">Installing on systems with ARMv8-based processors</a></li>
<li class="toctree-l3"><a class="reference internal" href="#installing-on-windows">Installing on Windows</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#installing-via-spack">Installing via Spack</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#known-limitations">Known limitations</a></li>
<li class="toctree-l3"><a class="reference internal" href="#setting-up-the-spack-environment">Setting up the Spack environment</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id6">Building QMCPACK</a></li>
<li class="toctree-l3"><a class="reference internal" href="#loading-qmcpack-into-your-environment">Loading QMCPACK into your environment</a></li>
<li class="toctree-l3"><a class="reference internal" href="#dependencies-that-need-to-be-compiled-with-gcc">Dependencies that need to be compiled with GCC</a></li>
<li class="toctree-l3"><a class="reference internal" href="#installing-qmcpack-with-spack-on-linux">Installing QMCPACK with Spack on Linux</a></li>
<li class="toctree-l3"><a class="reference internal" href="#installing-qmcpack-with-spack-on-mac-os-x">Installing QMCPACK with Spack on Mac OS X</a></li>
<li class="toctree-l3"><a class="reference internal" href="#installing-qmcpack-with-spack-on-cray-supercomputers">Installing QMCPACK with Spack on Cray Supercomputers</a></li>
<li class="toctree-l3"><a class="reference internal" href="#installing-quantum-espresso-with-spack">Installing Quantum-Espresso with Spack</a></li>
<li class="toctree-l3"><a class="reference internal" href="#reporting-bugs">Reporting Bugs</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#testing-and-validation-of-qmcpack">Testing and validation of QMCPACK</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#deterministic-and-unit-tests">Deterministic and unit tests</a></li>
<li class="toctree-l3"><a class="reference internal" href="#integration-tests-with-quantum-espresso">Integration tests with Quantum Espresso</a></li>
<li class="toctree-l3"><a class="reference internal" href="#performance-tests">Performance tests</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#nio-performance-tests">NiO performance tests</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#troubleshooting-tests">Troubleshooting tests</a></li>
<li class="toctree-l3"><a class="reference internal" href="#slow-testing-with-openmpi">Slow testing with OpenMPI</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#automated-testing-of-qmcpack">Automated testing of QMCPACK</a></li>
<li class="toctree-l2"><a class="reference internal" href="#building-ppconvert-a-pseudopotential-format-converter">Building ppconvert, a pseudopotential format converter</a></li>
<li class="toctree-l2"><a class="reference internal" href="#installing-and-patching-quantum-espresso">Installing and patching Quantum ESPRESSO</a></li>
<li class="toctree-l2"><a class="reference internal" href="#how-to-build-the-fastest-executable-version-of-qmcpack">How to build the fastest executable version of QMCPACK</a></li>
<li class="toctree-l2"><a class="reference internal" href="#troubleshooting-the-installation">Troubleshooting the installation</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="simulationcell.html">Specifying the Simulation Cell</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">QMC Manual</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html">Docs</a> &raquo;</li>
        
      <li>Obtaining, installing, and validating QMCPACK</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="_sources/installation.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="obtaining-installing-and-validating-qmcpack">
<span id="obtaininginstalling"></span><h1>Obtaining, installing, and validating QMCPACK<a class="headerlink" href="#obtaining-installing-and-validating-qmcpack" title="Permalink to this headline">¶</a></h1>
<p>This chapter describes how to obtain, build, and validate QMCPACK. This
process is designed to be as simple as possible and should be no harder
than building a modern plane-wave density functional theory code such as
Quantum ESPRESSO, QBox, or VASP. Parallel builds enable a complete
compilation in under 2 minutes on a fast multicore system. If you are
unfamiliar with building codes we suggest working with your system
administrator to install QMCPACK.</p>
<div class="section" id="installation-steps">
<h2>Installation steps<a class="headerlink" href="#installation-steps" title="Permalink to this headline">¶</a></h2>
<p>To install QMCPACK, follow the steps below. Full details of each step
are given in the referenced sections.</p>
<ol class="arabic simple">
<li><p>Download the source code from <a class="reference internal" href="#obrelease"><span class="std std-ref">Obtaining the latest release version</span></a>
or <a class="reference internal" href="#obdevelopment"><span class="std std-ref">Obtaining the latest development version</span></a>.</p></li>
<li><p>Verify that you have the required compilers, libraries, and tools
installed (<a class="reference internal" href="#prerequisites"><span class="std std-ref">Prerequisites</span></a>).</p></li>
<li><p>If you will use Quantum ESPRESSO, download and patch it. The patch
adds the pw2qmcpack utility
(<a class="reference internal" href="#buildqe"><span class="std std-ref">Installing and patching Quantum ESPRESSO</span></a>).</p></li>
<li><p>Run the cmake configure step and build with make
(<a class="reference internal" href="#cmake"><span class="std std-ref">Building with CMake</span></a> and <a class="reference internal" href="#cmakequick"><span class="std std-ref">Quick build instructions (try first)</span></a>). Examples for
common systems are given in
<span class="xref std std-ref">installexamples</span>.</p></li>
<li><p>Run the tests to verify QMCPACK
(<a class="reference internal" href="#testing"><span class="std std-ref">Testing and validation of QMCPACK</span></a>).</p></li>
<li><p>Build the ppconvert utility in QMCPACK
(<a class="reference internal" href="#buildppconvert"><span class="std std-ref">Building ppconvert, a pseudopotential format converter</span></a>).</p></li>
</ol>
<p>Hints for high performance are in
<a class="reference internal" href="#buildperformance"><span class="std std-ref">How to build the fastest executable version of QMCPACK</span></a>.
Troubleshooting suggestions are in
<a class="reference internal" href="#troubleshoot"><span class="std std-ref">Troubleshooting the installation</span></a>.</p>
<p>Note that there are two different QMCPACK executables that can be
produced: the general one, which is the default, and the “complex”
version, which supports periodic calculations at arbitrary twist angles
and k-points. This second version is enabled via a cmake configuration
parameter (see <a class="reference internal" href="#cmakeoptions"><span class="std std-ref">Configuration Options</span></a>).
The general version supports only wavefunctions that can be made real.
If you run a calculation that needs the complex version, QMCPACK will
stop and inform you.</p>
</div>
<div class="section" id="obtaining-the-latest-release-version">
<span id="obrelease"></span><h2>Obtaining the latest release version<a class="headerlink" href="#obtaining-the-latest-release-version" title="Permalink to this headline">¶</a></h2>
<p>Major releases of QMCPACK are distributed from <a class="reference external" href="http://www.qmcpack.org">http://www.qmcpack.org</a>.
Because these versions undergo the most testing, we encourage using them
for all production calculations unless there are specific reasons not to
do so.</p>
<p>Releases are usually compressed tar files that indicate the version
number, date, and often the source code revision control number
corresponding to the release. To obtain the latest release:</p>
<ul class="simple">
<li><p>Download the latest QMCPACK distribution from <a class="reference external" href="http://www.qmcpack.org">http://www.qmcpack.org</a>.</p></li>
<li><p>Untar the archive (e.g., <code class="docutils literal notranslate"><span class="pre">tar</span> <span class="pre">xvf</span> <span class="pre">qmcpack_v1.3.tar.gz</span></code>).</p></li>
</ul>
<p>Releases can also be obtained from the ‘master’ branch of the QMCPACK
git repository, similar to obtaining the development version
(<a class="reference internal" href="#obdevelopment"><span class="std std-ref">Obtaining the latest development version</span></a>).</p>
</div>
<div class="section" id="obtaining-the-latest-development-version">
<span id="obdevelopment"></span><h2>Obtaining the latest development version<a class="headerlink" href="#obtaining-the-latest-development-version" title="Permalink to this headline">¶</a></h2>
<p>The most recent development version of QMCPACK can be obtained
anonymously via</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">git</span> <span class="n">clone</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">github</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">QMCPACK</span><span class="o">/</span><span class="n">qmcpack</span><span class="o">.</span><span class="n">git</span>
</pre></div>
</div>
<p>Once checked out, updates can be made via the standard <code class="docutils literal notranslate"><span class="pre">git</span> <span class="pre">pull</span></code>.</p>
<p>The ‘develop’ branch of the git repository contains the day-to-day
development source with the latest updates, bug fixes, etc. This version
might be useful for updates to the build system to support new machines,
for support of the latest versions of Quantum ESPRESSO, or for updates
to the documentation. Note that the development version might not be
fully consistent with the online documentation. We attempt to keep the
development version fully working. However, please be sure to run tests
and compare with previous release versions before using for any serious
calculations. We try to keep bugs out, but occasionally they crawl in!
Reports of any breakages are appreciated.</p>
</div>
<div class="section" id="prerequisites">
<span id="id1"></span><h2>Prerequisites<a class="headerlink" href="#prerequisites" title="Permalink to this headline">¶</a></h2>
<p>The following items are required to build QMCPACK. For workstations,
these are available via the standard package manager. On shared
supercomputers this software is usually installed by default and is
often accessed via a modules environment—check your system
documentation.</p>
<p><strong>Use of the latest versions of all compilers and libraries is strongly
encouraged</strong> but not absolutely essential. Generally, newer versions are
faster; see <a class="reference internal" href="#buildperformance"><span class="std std-ref">How to build the fastest executable version of QMCPACK</span></a>
for performance suggestions.</p>
<ul class="simple">
<li><p>C/C++ compilers such as GNU, Clang, Intel, and IBM XL. C++ compilers
are required to support the C++ 14 standard. Use of recent (“current
year version”) compilers is strongly encouraged.</p></li>
<li><p>An MPI library such as OpenMPI (<a class="reference external" href="http://open-mpi.org">http://open-mpi.org</a>) or a
vendor-optimized MPI.</p></li>
<li><p>BLAS/LAPACK, numerical, and linear algebra libraries. Use
platform-optimized libraries where available, such as Intel MKL.
ATLAS or other optimized open source libraries can also be used
(<a class="reference external" href="http://math-atlas.sourceforge.net">http://math-atlas.sourceforge.net</a>).</p></li>
<li><p>CMake, build utility (<a class="reference external" href="http://www.cmake.org">http://www.cmake.org</a>).</p></li>
<li><p>Libxml2, XML parser (<a class="reference external" href="http://xmlsoft.org">http://xmlsoft.org</a>).</p></li>
<li><p>HDF5, portable I/O library (<a class="reference external" href="http://www.hdfgroup.org/HDF5/">http://www.hdfgroup.org/HDF5/</a>). Good
performance at large scale requires parallel version <span class="math notranslate nohighlight">\(&gt;=\)</span> 1.10.</p></li>
<li><p>BOOST, peer-reviewed portable C++ source libraries
(<a class="reference external" href="http://www.boost.org">http://www.boost.org</a>). Minimum version is 1.61.0.</p></li>
<li><p>FFTW, FFT library (<a class="reference external" href="http://www.fftw.org/">http://www.fftw.org/</a>).</p></li>
</ul>
<p>To build the GPU accelerated version of QMCPACK, an installation of
NVIDIA CUDA development tools is required. Ensure that this is
compatible with the C and C++ compiler versions you plan to use.
Supported versions are included in the NVIDIA release notes.</p>
<p>Many of the utilities provided with QMCPACK use Python (v2). The numpy
and matplotlib libraries are required for full functionality.</p>
<p>Note that the standalone einspline library used by previous versions of
QMCPACK is no longer required. A more optimized version is included
inside. The standalone version should <em>not</em> be on any standard search
paths because conflicts between the old and new include files can
result.</p>
</div>
<div class="section" id="c-14-standard-library">
<h2>C++ 14 standard library<a class="headerlink" href="#c-14-standard-library" title="Permalink to this headline">¶</a></h2>
<p>The C++ standard consists of language features—which are implemented in
the compiler—and library features—which are implemented in the standard
library. GCC includes its own standard library and headers, but many
compilers do not and instead reuse those from an existing GCC install.
Depending on setup and installation, some of these compilers might not
default to using a GCC with C++ 14 headers (e.g., GCC 4.8 is common as a
base system compiler, but its standard library only supports C++ 11).</p>
<p>The symptom of having header files that do not support the C++ 14
standard is usually compile errors involving standard include header
files. Look for the GCC library version, which should be present in the
path to the include file in the error message, and ensure that it is 5.0
or greater. To avoid these errors occurring at compile time, QMCPACK
tests for a C++ 14 standard library during configuration and will halt
with an error if one is not found.</p>
<p>At sites that use modules, running is often sufficient to load a newer
GCC and resolve the issue.</p>
<div class="section" id="intel-compiler">
<h3>Intel compiler<a class="headerlink" href="#intel-compiler" title="Permalink to this headline">¶</a></h3>
<p>The Intel compiler version must be 18 or newer. The version 17 compiler
cannot compile some of the C++ 14 constructs in the code.</p>
<p>If a newer GCC is needed, the <code class="docutils literal notranslate"><span class="pre">-cxxlib</span></code> option can be used to point to a different
GCC installation. (Alternately, the <code class="docutils literal notranslate"><span class="pre">-gcc-name</span></code> or <code class="docutils literal notranslate"><span class="pre">-gxx-name</span></code> options can be used.) Be sure to
pass this flag to the C compiler in addition to the C++ compiler. This
is necessary because CMake extracts some library paths from the C
compiler, and those paths usually also contain to the C++ library. The
symptom of this problem is C++ 14 standard library functions not found
at link time.</p>
</div>
</div>
<div class="section" id="building-with-cmake">
<span id="cmake"></span><h2>Building with CMake<a class="headerlink" href="#building-with-cmake" title="Permalink to this headline">¶</a></h2>
<p>The build system for QMCPACK is based on CMake. It will autoconfigure
based on the detected compilers and libraries. The most recent version
of CMake has the best detection for the greatest variety of systems. The
minimum required version of CMake is 3.6, which is the oldest version to
support correct application of C++ 14 flags for the Intel compiler. Most
computer installations have a sufficiently recent CMake, though it might
not be the default.</p>
<p>If no appropriate version CMake is available, building it from source is
straightforward. Download a version from <a class="reference external" href="https://cmake.org/download/">https://cmake.org/download/</a> and
unpack the files. Run <code class="docutils literal notranslate"><span class="pre">./bootstrap</span></code> from the CMake directory, and then run <code class="docutils literal notranslate"><span class="pre">make</span></code> when that
finishes. The resulting CMake executable will be in the directory. The
executable can be run directly from that location.</p>
<p>Previously, QMCPACK made extensive use of toolchains, but the build
system has since been updated to eliminate the use of toolchain files
for most cases. The build system is verified to work with GNU, Intel,
and IBM XLC compilers. Specific compile options can be specified either
through specific environment or CMake variables. When the libraries are
installed in standard locations (e.g., /usr, /usr/local), there is no
need to set environment or CMake variables for the packages.</p>
<div class="section" id="quick-build-instructions-try-first">
<span id="cmakequick"></span><h3>Quick build instructions (try first)<a class="headerlink" href="#quick-build-instructions-try-first" title="Permalink to this headline">¶</a></h3>
<p>If you are feeling lucky and are on a standard UNIX-like system such as
a Linux workstation, the following might quickly give a working QMCPACK:</p>
<p>The safest quick build option is to specify the C and C++ compilers
through their MPI wrappers. Here we use Intel MPI and Intel compilers.
Move to the build directory, run CMake, and make</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">cd</span> <span class="n">build</span>
<span class="n">cmake</span> <span class="o">-</span><span class="n">DCMAKE_C_COMPILER</span><span class="o">=</span><span class="n">mpiicc</span> <span class="o">-</span><span class="n">DCMAKE_CXX_COMPILER</span><span class="o">=</span><span class="n">mpiicpc</span> <span class="o">..</span>
<span class="n">make</span> <span class="o">-</span><span class="n">j</span> <span class="mi">8</span>
</pre></div>
</div>
<p>You can increase the “8” to the number of cores on your system for
faster builds. Substitute mpicc and mpicxx or other wrapped compiler names to suit
your system. For example, with OpenMPI use</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">cd</span> <span class="n">build</span>
<span class="n">cmake</span> <span class="o">-</span><span class="n">DCMAKE_C_COMPILER</span><span class="o">=</span><span class="n">mpicc</span> <span class="o">-</span><span class="n">DCMAKE_CXX_COMPILER</span><span class="o">=</span><span class="n">mpicxx</span> <span class="o">..</span>
<span class="n">make</span> <span class="o">-</span><span class="n">j</span> <span class="mi">8</span>
</pre></div>
</div>
<p>If you are feeling particularly lucky, you can skip the compiler specification:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">cd</span> <span class="n">build</span>
<span class="n">cmake</span> <span class="o">..</span>
<span class="n">make</span> <span class="o">-</span><span class="n">j</span> <span class="mi">8</span>
</pre></div>
</div>
<p>The complexities of modern computer hardware and software systems are
such that you should check that the autoconfiguration system has made
good choices and picked optimized libraries and compiler settings
before doing significant production. That is, check the following details. We
give examples for a number of common systems in <span class="xref std std-ref">installexamples</span>.</p>
</div>
<div class="section" id="environment-variables">
<span id="envvar"></span><h3>Environment variables<a class="headerlink" href="#environment-variables" title="Permalink to this headline">¶</a></h3>
<p>A number of environment variables affect the build.  In particular
they can control the default paths for libraries, the default
compilers, etc.  The list of environment variables is given below:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">CXX</span>              <span class="n">C</span><span class="o">++</span> <span class="n">compiler</span>
<span class="n">CC</span>               <span class="n">C</span> <span class="n">Compiler</span>
<span class="n">MKL_ROOT</span>         <span class="n">Path</span> <span class="k">for</span> <span class="n">MKL</span>
<span class="n">HDF5_ROOT</span>        <span class="n">Path</span> <span class="k">for</span> <span class="n">HDF5</span>
<span class="n">BOOST_ROOT</span>       <span class="n">Path</span> <span class="k">for</span> <span class="n">Boost</span>
<span class="n">FFTW_HOME</span>        <span class="n">Path</span> <span class="k">for</span> <span class="n">FFTW</span>
</pre></div>
</div>
</div>
<div class="section" id="configuration-options">
<span id="cmakeoptions"></span><h3>Configuration Options<a class="headerlink" href="#configuration-options" title="Permalink to this headline">¶</a></h3>
<p>In addition to reading the environment variables, CMake provides a
number of optional variables that can be set to control the build and
configure steps.  When passed to CMake, these variables will take
precedent over the environment and default variables.  To set them,
add -D FLAG=VALUE to the configure line between the CMake command and
the path to the source directory.</p>
<ul>
<li><p>Key QMCPACK build options</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">QMC_CUDA</span>              <span class="n">Enable</span> <span class="n">CUDA</span> <span class="ow">and</span> <span class="n">GPU</span> <span class="n">acceleration</span> <span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">yes</span><span class="p">,</span> <span class="mi">0</span><span class="p">:</span><span class="n">no</span><span class="p">)</span>
<span class="n">QMC_COMPLEX</span>           <span class="n">Build</span> <span class="n">the</span> <span class="nb">complex</span> <span class="p">(</span><span class="n">general</span> <span class="n">twist</span><span class="o">/</span><span class="n">k</span><span class="o">-</span><span class="n">point</span><span class="p">)</span> <span class="n">version</span> <span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">yes</span><span class="p">,</span> <span class="mi">0</span><span class="p">:</span><span class="n">no</span><span class="p">)</span>
<span class="n">QMC_MIXED_PRECISION</span>   <span class="n">Build</span> <span class="n">the</span> <span class="n">mixed</span> <span class="n">precision</span> <span class="p">(</span><span class="n">mixing</span> <span class="n">double</span><span class="o">/</span><span class="nb">float</span><span class="p">)</span> <span class="n">version</span>
                      <span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">yes</span> <span class="p">(</span><span class="n">GPU</span> <span class="n">default</span><span class="p">),</span> <span class="mi">0</span><span class="p">:</span><span class="n">no</span> <span class="p">(</span><span class="n">CPU</span> <span class="n">default</span><span class="p">))</span><span class="o">.</span>
                      <span class="n">The</span> <span class="n">CPU</span> <span class="n">support</span> <span class="ow">is</span> <span class="n">experimental</span><span class="o">.</span>
                      <span class="n">Use</span> <span class="nb">float</span> <span class="ow">and</span> <span class="n">double</span> <span class="k">for</span> <span class="n">base</span> <span class="ow">and</span> <span class="n">full</span> <span class="n">precision</span><span class="o">.</span>
                      <span class="n">The</span> <span class="n">GPU</span> <span class="n">support</span> <span class="ow">is</span> <span class="n">quite</span> <span class="n">mature</span><span class="o">.</span>
                      <span class="n">Use</span> <span class="n">always</span> <span class="n">double</span> <span class="k">for</span> <span class="n">host</span> <span class="n">side</span> <span class="n">base</span> <span class="ow">and</span> <span class="n">full</span> <span class="n">precision</span>
                      <span class="ow">and</span> <span class="n">use</span> <span class="nb">float</span> <span class="ow">and</span> <span class="n">double</span> <span class="k">for</span> <span class="n">CUDA</span> <span class="n">base</span> <span class="ow">and</span> <span class="n">full</span> <span class="n">precision</span><span class="o">.</span>
<span class="n">ENABLE_SOA</span>            <span class="n">Enable</span> <span class="n">data</span> <span class="n">layout</span> <span class="ow">and</span> <span class="n">algorithm</span> <span class="n">optimizations</span> <span class="n">using</span>
                      <span class="n">Structure</span><span class="o">-</span><span class="n">of</span><span class="o">-</span><span class="n">Array</span> <span class="p">(</span><span class="n">SoA</span><span class="p">)</span> <span class="n">datatypes</span> <span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">yes</span> <span class="p">(</span><span class="n">default</span><span class="p">),</span> <span class="mi">0</span><span class="p">:</span><span class="n">no</span><span class="p">)</span><span class="o">.</span>
<span class="n">ENABLE_TIMERS</span>         <span class="n">Enable</span> <span class="n">fine</span><span class="o">-</span><span class="n">grained</span> <span class="n">timers</span> <span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">yes</span><span class="p">,</span> <span class="mi">0</span><span class="p">:</span><span class="n">no</span> <span class="p">(</span><span class="n">default</span><span class="p">))</span><span class="o">.</span>
                      <span class="n">Timers</span> <span class="n">are</span> <span class="n">off</span> <span class="n">by</span> <span class="n">default</span> <span class="n">to</span> <span class="n">avoid</span> <span class="n">potential</span> <span class="n">slowdown</span> <span class="ow">in</span> <span class="n">small</span>
                      <span class="n">systems</span><span class="o">.</span> <span class="n">For</span> <span class="n">large</span> <span class="n">systems</span> <span class="p">(</span><span class="mi">100</span><span class="o">+</span> <span class="n">electrons</span><span class="p">)</span> <span class="n">there</span> <span class="ow">is</span> <span class="n">no</span> <span class="n">risk</span><span class="o">.</span>
</pre></div>
</div>
</li>
<li><p>General build options</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">CMAKE_BUILD_TYPE</span>     <span class="n">A</span> <span class="n">variable</span> <span class="n">which</span> <span class="n">controls</span> <span class="n">the</span> <span class="nb">type</span> <span class="n">of</span> <span class="n">build</span>
                     <span class="p">(</span><span class="n">defaults</span> <span class="n">to</span> <span class="n">Release</span><span class="p">)</span><span class="o">.</span> <span class="n">Possible</span> <span class="n">values</span> <span class="n">are</span><span class="p">:</span>
                     <span class="kc">None</span> <span class="p">(</span><span class="n">Do</span> <span class="ow">not</span> <span class="nb">set</span> <span class="n">debug</span><span class="o">/</span><span class="n">optmize</span> <span class="n">flags</span><span class="p">,</span> <span class="n">use</span>
                     <span class="n">CMAKE_C_FLAGS</span> <span class="ow">or</span> <span class="n">CMAKE_CXX_FLAGS</span><span class="p">)</span>
                     <span class="n">Debug</span> <span class="p">(</span><span class="n">create</span> <span class="n">a</span> <span class="n">debug</span> <span class="n">build</span><span class="p">)</span>
                     <span class="n">Release</span> <span class="p">(</span><span class="n">create</span> <span class="n">a</span> <span class="n">release</span><span class="o">/</span><span class="n">optimized</span> <span class="n">build</span><span class="p">)</span>
                     <span class="n">RelWithDebInfo</span> <span class="p">(</span><span class="n">create</span> <span class="n">a</span> <span class="n">release</span><span class="o">/</span><span class="n">optimized</span> <span class="n">build</span> <span class="k">with</span> <span class="n">debug</span> <span class="n">info</span><span class="p">)</span>
                     <span class="n">MinSizeRel</span> <span class="p">(</span><span class="n">create</span> <span class="n">an</span> <span class="n">executable</span> <span class="n">optimized</span> <span class="k">for</span> <span class="n">size</span><span class="p">)</span>
<span class="n">CMAKE_C_COMPILER</span>     <span class="n">Set</span> <span class="n">the</span> <span class="n">C</span> <span class="n">compiler</span>
<span class="n">CMAKE_CXX_COMPILER</span>   <span class="n">Set</span> <span class="n">the</span> <span class="n">C</span><span class="o">++</span> <span class="n">compiler</span>
<span class="n">CMAKE_C_FLAGS</span>        <span class="n">Set</span> <span class="n">the</span> <span class="n">C</span> <span class="n">flags</span><span class="o">.</span>  <span class="n">Note</span><span class="p">:</span> <span class="n">to</span> <span class="n">prevent</span> <span class="n">default</span>
                     <span class="n">debug</span><span class="o">/</span><span class="n">release</span> <span class="n">flags</span> <span class="kn">from</span> <span class="nn">being</span> <span class="n">used</span><span class="p">,</span> <span class="nb">set</span> <span class="n">the</span> <span class="n">CMAKE_BUILD_TYPE</span><span class="o">=</span><span class="kc">None</span>
                     <span class="n">Also</span> <span class="n">supported</span><span class="p">:</span> <span class="n">CMAKE_C_FLAGS_DEBUG</span><span class="p">,</span>
                     <span class="n">CMAKE_C_FLAGS_RELEASE</span><span class="p">,</span> <span class="ow">and</span> <span class="n">CMAKE_C_FLAGS_RELWITHDEBINFO</span>
<span class="n">CMAKE_CXX_FLAGS</span>      <span class="n">Set</span> <span class="n">the</span> <span class="n">C</span><span class="o">++</span> <span class="n">flags</span><span class="o">.</span>  <span class="n">Note</span><span class="p">:</span> <span class="n">to</span> <span class="n">prevent</span> <span class="n">default</span>
                     <span class="n">debug</span><span class="o">/</span><span class="n">release</span> <span class="n">flags</span> <span class="kn">from</span> <span class="nn">being</span> <span class="n">used</span><span class="p">,</span> <span class="nb">set</span> <span class="n">the</span> <span class="n">CMAKE_BUILD_TYPE</span><span class="o">=</span><span class="kc">None</span>
                     <span class="n">Also</span> <span class="n">supported</span><span class="p">:</span> <span class="n">CMAKE_CXX_FLAGS_DEBUG</span><span class="p">,</span>
                     <span class="n">CMAKE_CXX_FLAGS_RELEASE</span><span class="p">,</span> <span class="ow">and</span> <span class="n">CMAKE_CXX_FLAGS_RELWITHDEBINFO</span>
<span class="n">CMAKE_INSTALL_PREFIX</span> <span class="n">Set</span> <span class="n">the</span> <span class="n">install</span> <span class="n">location</span> <span class="p">(</span><span class="k">if</span> <span class="n">using</span> <span class="n">the</span> <span class="n">optional</span> <span class="n">install</span> <span class="n">step</span><span class="p">)</span>
<span class="n">INSTALL_NEXUS</span>        <span class="n">Install</span> <span class="n">Nexus</span> <span class="n">alongside</span> <span class="n">QMCPACK</span> <span class="p">(</span><span class="k">if</span> <span class="n">using</span> <span class="n">the</span> <span class="n">optional</span> <span class="n">install</span> <span class="n">step</span><span class="p">)</span>
</pre></div>
</div>
</li>
<li><p>Additional QMCPACK build options</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">QE_BIN</span>                    <span class="n">Location</span> <span class="n">of</span> <span class="n">Quantum</span> <span class="n">Espresso</span> <span class="n">binaries</span> <span class="n">including</span> <span class="n">pw2qmcpack</span><span class="o">.</span><span class="n">x</span>
<span class="n">QMC_DATA</span>                  <span class="n">Specify</span> <span class="n">data</span> <span class="n">directory</span> <span class="k">for</span> <span class="n">QMCPACK</span> <span class="n">performance</span> <span class="ow">and</span> <span class="n">integration</span> <span class="n">tests</span>
<span class="n">QMC_INCLUDE</span>               <span class="n">Add</span> <span class="n">extra</span> <span class="n">include</span> <span class="n">paths</span>
<span class="n">QMC_EXTRA_LIBS</span>            <span class="n">Add</span> <span class="n">extra</span> <span class="n">link</span> <span class="n">libraries</span>
<span class="n">QMC_BUILD_STATIC</span>          <span class="n">Add</span> <span class="o">-</span><span class="n">static</span> <span class="n">flags</span> <span class="n">to</span> <span class="n">build</span>
<span class="n">QMC_SYMLINK_TEST_FILES</span>    <span class="n">Set</span> <span class="n">to</span> <span class="n">zero</span> <span class="n">to</span> <span class="n">require</span> <span class="n">test</span> <span class="n">files</span> <span class="n">to</span> <span class="n">be</span> <span class="n">copied</span><span class="o">.</span> <span class="n">Avoids</span> <span class="n">space</span>
                          <span class="n">saving</span> <span class="n">default</span> <span class="n">use</span> <span class="n">of</span> <span class="n">symbolic</span> <span class="n">links</span> <span class="k">for</span> <span class="n">test</span> <span class="n">files</span><span class="o">.</span> <span class="n">Useful</span>
                          <span class="k">if</span> <span class="n">the</span> <span class="n">build</span> <span class="ow">is</span> <span class="n">on</span> <span class="n">a</span> <span class="n">separate</span> <span class="n">filesystem</span> <span class="kn">from</span> <span class="nn">the</span> <span class="n">source</span><span class="p">,</span> <span class="k">as</span>
                          <span class="n">required</span> <span class="n">on</span> <span class="n">some</span> <span class="n">HPC</span> <span class="n">systems</span><span class="o">.</span>
<span class="n">QMC_VERBOSE_CONFIGURATION</span> <span class="n">Print</span> <span class="n">additional</span> <span class="n">information</span> <span class="n">during</span> <span class="n">cmake</span> <span class="n">configuration</span>
                          <span class="n">including</span> <span class="n">details</span> <span class="n">of</span> <span class="n">which</span> <span class="n">tests</span> <span class="n">are</span> <span class="n">enabled</span><span class="o">.</span>
</pre></div>
</div>
</li>
<li><p>Intel MKL related</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ENABLE_MKL</span>          <span class="n">Enable</span> <span class="n">Intel</span> <span class="n">MKL</span> <span class="n">libraries</span> <span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">yes</span> <span class="p">(</span><span class="n">default</span> <span class="k">for</span> <span class="n">intel</span> <span class="n">compiler</span><span class="p">),</span>
                                              <span class="mi">0</span><span class="p">:</span><span class="n">no</span> <span class="p">(</span><span class="n">default</span> <span class="n">otherwise</span><span class="p">))</span><span class="o">.</span>
<span class="n">MKL_ROOT</span>            <span class="n">Path</span> <span class="n">to</span> <span class="n">MKL</span> <span class="n">libraries</span> <span class="p">(</span><span class="n">only</span> <span class="n">necessary</span> <span class="k">for</span> <span class="n">non</span> <span class="n">intel</span> <span class="n">compilers</span>
                    <span class="ow">or</span> <span class="n">intel</span> <span class="n">without</span> <span class="n">standard</span> <span class="n">environment</span> <span class="n">variables</span><span class="o">.</span><span class="p">)</span>
                    <span class="n">One</span> <span class="n">of</span> <span class="n">the</span> <span class="n">above</span> <span class="n">environment</span> <span class="n">variables</span> <span class="n">can</span> <span class="n">be</span> <span class="n">used</span><span class="o">.</span>
</pre></div>
</div>
</li>
<li><p>libxml2 related</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">LIBXML2_INCLUDE_DIR</span>   <span class="n">Include</span> <span class="n">directory</span> <span class="k">for</span> <span class="n">libxml2</span>

<span class="n">LIBXML2_LIBRARY</span>       <span class="n">Libxml2</span> <span class="n">library</span>
</pre></div>
</div>
</li>
<li><p>HDF5 related</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">HDF5_PREFER_PARALLEL</span> <span class="mi">1</span><span class="p">(</span><span class="n">default</span> <span class="k">for</span> <span class="n">MPI</span> <span class="n">build</span><span class="p">)</span><span class="o">/</span><span class="mi">0</span><span class="p">,</span> <span class="n">enables</span><span class="o">/</span><span class="n">disable</span> <span class="n">parallel</span> <span class="n">HDF5</span> <span class="n">library</span> <span class="n">searching</span><span class="o">.</span>
<span class="n">ENABLE_PHDF5</span>         <span class="mi">1</span><span class="p">(</span><span class="n">default</span> <span class="k">for</span> <span class="n">parallel</span> <span class="n">HDF5</span> <span class="n">library</span><span class="p">)</span><span class="o">/</span><span class="mi">0</span><span class="p">,</span> <span class="n">enables</span><span class="o">/</span><span class="n">disable</span> <span class="n">parallel</span> <span class="n">collective</span> <span class="n">I</span><span class="o">/</span><span class="n">O</span><span class="o">.</span>
</pre></div>
</div>
</li>
<li><p>FFTW related</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">FFTW_INCLUDE_DIRS</span>   <span class="n">Specify</span> <span class="n">include</span> <span class="n">directories</span> <span class="k">for</span> <span class="n">FFTW</span>
<span class="n">FFTW_LIBRARY_DIRS</span>   <span class="n">Specify</span> <span class="n">library</span> <span class="n">directories</span> <span class="k">for</span> <span class="n">FFTW</span>
</pre></div>
</div>
</li>
<li><p>CTest related</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">MPIEXEC_EXECUTABLE</span>     <span class="n">Specify</span> <span class="n">the</span> <span class="n">mpi</span> <span class="n">wrapper</span><span class="p">,</span> <span class="n">e</span><span class="o">.</span><span class="n">g</span><span class="o">.</span> <span class="n">srun</span><span class="p">,</span> <span class="n">aprun</span><span class="p">,</span> <span class="n">mpirun</span><span class="p">,</span> <span class="n">etc</span><span class="o">.</span>
<span class="n">MPIEXEC_NUMPROC_FLAG</span>   <span class="n">Specify</span> <span class="n">the</span> <span class="n">number</span> <span class="n">of</span> <span class="n">mpi</span> <span class="n">processes</span> <span class="n">flag</span><span class="p">,</span>
                       <span class="n">e</span><span class="o">.</span><span class="n">g</span><span class="o">.</span> <span class="s2">&quot;-n&quot;</span><span class="p">,</span> <span class="s2">&quot;-np&quot;</span><span class="p">,</span> <span class="n">etc</span><span class="o">.</span>
<span class="n">MPIEXEC_PREFLAGS</span>       <span class="n">Flags</span> <span class="n">to</span> <span class="k">pass</span> <span class="n">to</span> <span class="n">MPIEXEC_EXECUTABLE</span> <span class="n">directly</span> <span class="n">before</span> <span class="n">the</span> <span class="n">executable</span> <span class="n">to</span> <span class="n">run</span><span class="o">.</span>
</pre></div>
</div>
</li>
<li><p>LLVM/Clang Developer Options</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">LLVM_SANITIZE_ADDRES</span>  <span class="n">link</span> <span class="k">with</span> <span class="n">the</span> <span class="n">Clang</span> <span class="n">address</span> <span class="n">sanitizer</span> <span class="n">library</span>
<span class="n">LLVM_SANITIZE_MEMORY</span>  <span class="n">link</span> <span class="k">with</span> <span class="n">the</span> <span class="n">Clang</span> <span class="n">memory</span> <span class="n">sanitizer</span> <span class="n">library</span>
</pre></div>
</div>
</li>
</ul>
<p><a class="reference external" href="https://clang.llvm.org/docs/AddressSanitizer.html">Clang address sanitizer library</a></p>
<p><a class="reference external" href="https://clang.llvm.org/docs/MemorySanitizer.html">Clang memory sanitizer library</a></p>
<p>See <span class="xref std std-ref">LLVM-Sanitizer-Libraries</span> for more information.</p>
</div>
<div class="section" id="installation-from-cmake">
<h3>Installation from CMake<a class="headerlink" href="#installation-from-cmake" title="Permalink to this headline">¶</a></h3>
<p>Installation is optional. The QMCPACK executable can be run from the <code class="docutils literal notranslate"><span class="pre">bin</span></code> directory in the build location.
If the install step is desired, run the <code class="docutils literal notranslate"><span class="pre">make</span> <span class="pre">install</span></code> command to install the QMCPACK executable, the converter,
and some additional executables.
Also installed is the <code class="docutils literal notranslate"><span class="pre">qmcpack.settings</span></code> file that records options used to compile QMCPACK.
Specify the <code class="docutils literal notranslate"><span class="pre">CMAKE_INSTALL_PREFIX</span></code> CMake variable during configuration to set the install location.</p>
</div>
<div class="section" id="role-of-qmc-data">
<h3>Role of QMC_DATA<a class="headerlink" href="#role-of-qmc-data" title="Permalink to this headline">¶</a></h3>
<p>QMCPACK includes a variety of optional performance and integration
tests that use research quality wavefunctions to obtain meaningful
performance and to more thoroughly test the code. The necessarily
large input files are stored in the location pointed to by QMC_DATA (e.g., scratch or long-lived project space on a supercomputer). These
files are not included in the source code distribution to minimize
size. The tests are activated if CMake detects the files when
configured. See tests/performance/NiO/README,
tests/solids/NiO_afqmc/README, tests/performance/C-graphite/README, and tests/performance/C-molecule/README
for details of the current tests and input files and to download them.</p>
<p>Currently the files must be downloaded via <a class="reference external" href="https://anl.box.com/s/yxz1ic4kxtdtgpva5hcmlom9ixfl3v3c">https://anl.box.com/s/yxz1ic4kxtdtgpva5hcmlom9ixfl3v3c</a>.</p>
<p>The layout of current complete set of files is given below. If a file is missing, the appropriate performance test is skipped.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">QMC_DATA</span><span class="o">/</span><span class="n">C</span><span class="o">-</span><span class="n">graphite</span><span class="o">/</span><span class="n">lda</span><span class="o">.</span><span class="n">pwscf</span><span class="o">.</span><span class="n">h5</span>
<span class="n">QMC_DATA</span><span class="o">/</span><span class="n">C</span><span class="o">-</span><span class="n">molecule</span><span class="o">/</span><span class="n">C12</span><span class="o">-</span><span class="n">e48</span><span class="o">-</span><span class="n">pp</span><span class="o">.</span><span class="n">h5</span>
<span class="n">QMC_DATA</span><span class="o">/</span><span class="n">C</span><span class="o">-</span><span class="n">molecule</span><span class="o">/</span><span class="n">C12</span><span class="o">-</span><span class="n">e72</span><span class="o">-</span><span class="n">ae</span><span class="o">.</span><span class="n">h5</span>
<span class="n">QMC_DATA</span><span class="o">/</span><span class="n">C</span><span class="o">-</span><span class="n">molecule</span><span class="o">/</span><span class="n">C18</span><span class="o">-</span><span class="n">e108</span><span class="o">-</span><span class="n">ae</span><span class="o">.</span><span class="n">h5</span>
<span class="n">QMC_DATA</span><span class="o">/</span><span class="n">C</span><span class="o">-</span><span class="n">molecule</span><span class="o">/</span><span class="n">C18</span><span class="o">-</span><span class="n">e72</span><span class="o">-</span><span class="n">pp</span><span class="o">.</span><span class="n">h5</span>
<span class="n">QMC_DATA</span><span class="o">/</span><span class="n">C</span><span class="o">-</span><span class="n">molecule</span><span class="o">/</span><span class="n">C24</span><span class="o">-</span><span class="n">e144</span><span class="o">-</span><span class="n">ae</span><span class="o">.</span><span class="n">h5</span>
<span class="n">QMC_DATA</span><span class="o">/</span><span class="n">C</span><span class="o">-</span><span class="n">molecule</span><span class="o">/</span><span class="n">C24</span><span class="o">-</span><span class="n">e96</span><span class="o">-</span><span class="n">pp</span><span class="o">.</span><span class="n">h5</span>
<span class="n">QMC_DATA</span><span class="o">/</span><span class="n">C</span><span class="o">-</span><span class="n">molecule</span><span class="o">/</span><span class="n">C30</span><span class="o">-</span><span class="n">e120</span><span class="o">-</span><span class="n">pp</span><span class="o">.</span><span class="n">h5</span>
<span class="n">QMC_DATA</span><span class="o">/</span><span class="n">C</span><span class="o">-</span><span class="n">molecule</span><span class="o">/</span><span class="n">C30</span><span class="o">-</span><span class="n">e180</span><span class="o">-</span><span class="n">ae</span><span class="o">.</span><span class="n">h5</span>
<span class="n">QMC_DATA</span><span class="o">/</span><span class="n">C</span><span class="o">-</span><span class="n">molecule</span><span class="o">/</span><span class="n">C60</span><span class="o">-</span><span class="n">e240</span><span class="o">-</span><span class="n">pp</span><span class="o">.</span><span class="n">h5</span>
<span class="n">QMC_DATA</span><span class="o">/</span><span class="n">NiO</span><span class="o">/</span><span class="n">NiO</span><span class="o">-</span><span class="n">fcc</span><span class="o">-</span><span class="n">supertwist111</span><span class="o">-</span><span class="n">supershift000</span><span class="o">-</span><span class="n">S1</span><span class="o">.</span><span class="n">h5</span>
<span class="n">QMC_DATA</span><span class="o">/</span><span class="n">NiO</span><span class="o">/</span><span class="n">NiO</span><span class="o">-</span><span class="n">fcc</span><span class="o">-</span><span class="n">supertwist111</span><span class="o">-</span><span class="n">supershift000</span><span class="o">-</span><span class="n">S2</span><span class="o">.</span><span class="n">h5</span>
<span class="n">QMC_DATA</span><span class="o">/</span><span class="n">NiO</span><span class="o">/</span><span class="n">NiO</span><span class="o">-</span><span class="n">fcc</span><span class="o">-</span><span class="n">supertwist111</span><span class="o">-</span><span class="n">supershift000</span><span class="o">-</span><span class="n">S4</span><span class="o">.</span><span class="n">h5</span>
<span class="n">QMC_DATA</span><span class="o">/</span><span class="n">NiO</span><span class="o">/</span><span class="n">NiO</span><span class="o">-</span><span class="n">fcc</span><span class="o">-</span><span class="n">supertwist111</span><span class="o">-</span><span class="n">supershift000</span><span class="o">-</span><span class="n">S8</span><span class="o">.</span><span class="n">h5</span>
<span class="n">QMC_DATA</span><span class="o">/</span><span class="n">NiO</span><span class="o">/</span><span class="n">NiO</span><span class="o">-</span><span class="n">fcc</span><span class="o">-</span><span class="n">supertwist111</span><span class="o">-</span><span class="n">supershift000</span><span class="o">-</span><span class="n">S16</span><span class="o">.</span><span class="n">h5</span>
<span class="n">QMC_DATA</span><span class="o">/</span><span class="n">NiO</span><span class="o">/</span><span class="n">NiO</span><span class="o">-</span><span class="n">fcc</span><span class="o">-</span><span class="n">supertwist111</span><span class="o">-</span><span class="n">supershift000</span><span class="o">-</span><span class="n">S32</span><span class="o">.</span><span class="n">h5</span>
<span class="n">QMC_DATA</span><span class="o">/</span><span class="n">NiO</span><span class="o">/</span><span class="n">NiO</span><span class="o">-</span><span class="n">fcc</span><span class="o">-</span><span class="n">supertwist111</span><span class="o">-</span><span class="n">supershift000</span><span class="o">-</span><span class="n">S64</span><span class="o">.</span><span class="n">h5</span>
<span class="n">QMC_DATA</span><span class="o">/</span><span class="n">NiO</span><span class="o">/</span><span class="n">NiO</span><span class="o">-</span><span class="n">fcc</span><span class="o">-</span><span class="n">supertwist111</span><span class="o">-</span><span class="n">supershift000</span><span class="o">-</span><span class="n">S128</span><span class="o">.</span><span class="n">h5</span>
<span class="n">QMC_DATA</span><span class="o">/</span><span class="n">NiO</span><span class="o">/</span><span class="n">NiO</span><span class="o">-</span><span class="n">fcc</span><span class="o">-</span><span class="n">supertwist111</span><span class="o">-</span><span class="n">supershift000</span><span class="o">-</span><span class="n">S256</span><span class="o">.</span><span class="n">h5</span>
<span class="n">QMC_DATA</span><span class="o">/</span><span class="n">NiO</span><span class="o">/</span><span class="n">NiO_afm_fcidump</span><span class="o">.</span><span class="n">h5</span>
<span class="n">QMC_DATA</span><span class="o">/</span><span class="n">NiO</span><span class="o">/</span><span class="n">NiO_afm_wfn</span><span class="o">.</span><span class="n">dat</span>
<span class="n">QMC_DATA</span><span class="o">/</span><span class="n">NiO</span><span class="o">/</span><span class="n">NiO_nm_choldump</span><span class="o">.</span><span class="n">h5</span>
</pre></div>
</div>
</div>
<div class="section" id="configure-and-build-using-cmake-and-make">
<h3>Configure and build using CMake and make<a class="headerlink" href="#configure-and-build-using-cmake-and-make" title="Permalink to this headline">¶</a></h3>
<p>To configure and build QMCPACK, move to build directory, run CMake, and make</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">cd</span> <span class="n">build</span>
<span class="n">cmake</span> <span class="o">..</span>
<span class="n">make</span> <span class="o">-</span><span class="n">j</span> <span class="mi">8</span>
</pre></div>
</div>
<p>As you will have gathered, CMake encourages “out of source” builds,
where all the files for a specific build configuration reside in their
own directory separate from the source files. This allows multiple
builds to be created from the same source files, which is very useful
when the file system is shared between different systems. You can also
build versions with different settings (e.g., QMC_COMPLEX) and
different compiler settings. The build directory does not have to be
called build—use something descriptive such as build_machinename or
build_complex. The “..” in the CMake line refers to the directory
containing CMakeLists.txt. Update the “..” for other build
directory locations.</p>
</div>
<div class="section" id="example-configure-and-build">
<h3>Example configure and build<a class="headerlink" href="#example-configure-and-build" title="Permalink to this headline">¶</a></h3>
<ul>
<li><p>Set the environments (the examples below assume bash, Intel compilers, and MKL library)</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">export</span> <span class="n">CXX</span><span class="o">=</span><span class="n">icpc</span>
<span class="n">export</span> <span class="n">CC</span><span class="o">=</span><span class="n">icc</span>
<span class="n">export</span> <span class="n">MKL_ROOT</span><span class="o">=/</span><span class="n">usr</span><span class="o">/</span><span class="n">local</span><span class="o">/</span><span class="n">intel</span><span class="o">/</span><span class="n">mkl</span><span class="o">/</span><span class="mf">10.0</span><span class="o">.</span><span class="mf">3.020</span>
<span class="n">export</span> <span class="n">HDF5_ROOT</span><span class="o">=/</span><span class="n">usr</span><span class="o">/</span><span class="n">local</span>
<span class="n">export</span> <span class="n">BOOST_ROOT</span><span class="o">=/</span><span class="n">usr</span><span class="o">/</span><span class="n">local</span><span class="o">/</span><span class="n">boost</span>
<span class="n">export</span> <span class="n">FFTW_HOME</span><span class="o">=/</span><span class="n">usr</span><span class="o">/</span><span class="n">local</span><span class="o">/</span><span class="n">fftw</span>
</pre></div>
</div>
</li>
<li><p>Move to build directory, run CMake, and make</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">cd</span> <span class="n">build</span>
<span class="n">cmake</span> <span class="o">-</span><span class="n">D</span> <span class="n">CMAKE_BUILD_TYPE</span><span class="o">=</span><span class="n">Release</span> <span class="o">..</span>
<span class="n">make</span> <span class="o">-</span><span class="n">j</span> <span class="mi">8</span>
</pre></div>
</div>
</li>
</ul>
</div>
<div class="section" id="build-scripts">
<h3>Build scripts<a class="headerlink" href="#build-scripts" title="Permalink to this headline">¶</a></h3>
<p>We recommended creating a helper script that contains the
configure line for CMake.  This is particularly useful when avoiding
environment variables, packages are installed in custom locations,
or the configure line is long or complex.  In this case it is also
recommended to add “rm -rf CMake*” before the configure line to remove
existing CMake configure files to ensure a fresh configure each time
the script is called. Deleting all the files in the build
directory is also acceptable. If you do so we recommend adding some sanity
checks in case the script is run from the wrong directory (e.g.,
checking for the existence of some QMCPACK files).</p>
<p>Some build script examples for different systems are given in the
config directory. For example, on Cray systems these scripts might
load the appropriate modules to set the appropriate programming
environment, specific library versions, etc.</p>
<p>An example script build.sh is given below. It is much more complex
than usually needed for comprehensiveness:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">export</span> <span class="n">CXX</span><span class="o">=</span><span class="n">mpic</span><span class="o">++</span>
<span class="n">export</span> <span class="n">CC</span><span class="o">=</span><span class="n">mpicc</span>
<span class="n">export</span> <span class="n">ACML_HOME</span><span class="o">=/</span><span class="n">opt</span><span class="o">/</span><span class="n">acml</span><span class="o">-</span><span class="mf">5.3</span><span class="o">.</span><span class="mi">1</span><span class="o">/</span><span class="n">gfortran64</span>
<span class="n">export</span> <span class="n">HDF5_ROOT</span><span class="o">=/</span><span class="n">opt</span><span class="o">/</span><span class="n">hdf5</span>
<span class="n">export</span> <span class="n">BOOST_ROOT</span><span class="o">=/</span><span class="n">opt</span><span class="o">/</span><span class="n">boost</span>

<span class="n">rm</span> <span class="o">-</span><span class="n">rf</span> <span class="n">CMake</span><span class="o">*</span>

<span class="n">cmake</span>                                                \
  <span class="o">-</span><span class="n">D</span> <span class="n">CMAKE_BUILD_TYPE</span><span class="o">=</span><span class="n">Debug</span>                         \
  <span class="o">-</span><span class="n">D</span> <span class="n">LIBXML2_INCLUDE_DIR</span><span class="o">=/</span><span class="n">usr</span><span class="o">/</span><span class="n">include</span><span class="o">/</span><span class="n">libxml2</span>      \
  <span class="o">-</span><span class="n">D</span> <span class="n">LIBXML2_LIBRARY</span><span class="o">=/</span><span class="n">usr</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">x86_64</span><span class="o">-</span><span class="n">linux</span><span class="o">-</span><span class="n">gnu</span><span class="o">/</span><span class="n">libxml2</span><span class="o">.</span><span class="n">so</span> \
  <span class="o">-</span><span class="n">D</span> <span class="n">FFTW_INCLUDE_DIRS</span><span class="o">=/</span><span class="n">usr</span><span class="o">/</span><span class="n">include</span>                 \
  <span class="o">-</span><span class="n">D</span> <span class="n">FFTW_LIBRARY_DIRS</span><span class="o">=/</span><span class="n">usr</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">x86_64</span><span class="o">-</span><span class="n">linux</span><span class="o">-</span><span class="n">gnu</span>    \
  <span class="o">-</span><span class="n">D</span> <span class="n">QMC_EXTRA_LIBS</span><span class="o">=</span><span class="s2">&quot;-ldl $</span><span class="si">{ACML_HOME}</span><span class="s2">/lib/libacml.a -lgfortran&quot;</span> \
  <span class="o">-</span><span class="n">D</span> <span class="n">QMC_DATA</span><span class="o">=/</span><span class="n">projects</span><span class="o">/</span><span class="n">QMCPACK</span><span class="o">/</span><span class="n">qmc</span><span class="o">-</span><span class="n">data</span>            \
  <span class="o">..</span>
</pre></div>
</div>
</div>
<div class="section" id="using-vendor-optimized-numerical-libraries-e-g-intel-mkl">
<h3>Using vendor-optimized numerical libraries (e.g., Intel MKL)<a class="headerlink" href="#using-vendor-optimized-numerical-libraries-e-g-intel-mkl" title="Permalink to this headline">¶</a></h3>
<p>Although QMC does not make extensive use of linear algebra, use of
vendor-optimized libraries is strongly recommended for highest
performance. BLAS routines are used in the Slater determinant update, the VMC wavefunction optimizer,
and to apply orbital coefficients in local basis calculations. Vectorized
math functions are also beneficial (e.g., for the phase factor
computation in solid-state calculations). CMake is generally successful
in finding these libraries, but specific combinations can require
additional hints, as described in the following:</p>
<div class="section" id="using-intel-mkl-with-non-intel-compilers">
<h4>Using Intel MKL with non-Intel compilers<a class="headerlink" href="#using-intel-mkl-with-non-intel-compilers" title="Permalink to this headline">¶</a></h4>
<p>To use Intel MKL with, e.g. an MPICH wrapped gcc:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>cmake \
  -DCMAKE_C_COMPILER=mpicc -DCMAKE_CXX_COMPILER=mpicxx \
  -DENABLE_MKL=1 -DMKL_ROOT=$MKLROOT/lib \
  ..
</pre></div>
</div>
<p>MKLROOT is the directory containing the MKL binary, examples, and lib
directories (etc.) and is often /opt/intel/mkl.</p>
</div>
<div class="section" id="serial-or-multithreaded-library">
<h4>Serial or multithreaded library<a class="headerlink" href="#serial-or-multithreaded-library" title="Permalink to this headline">¶</a></h4>
<p>Vendors might provide both serial and multithreaded versions of their libraries.
Using the right version is critical to QMCPACK performance.
QMCPACK makes calls from both inside and outside threaded regions.
When being called from outside an OpenMP parallel region, the multithreaded version is preferred for the possibility of using all the available cores.
When being called from every thread inside an OpenMP parallel region, the serial version is preferred for not oversubscribing the cores.
Fortunately, nowadays the multithreaded versions of many vendor libraries (MKL, ESSL) are OpenMP aware.
They use only one thread when being called inside an OpenMP parallel region.
This behavior meets exactly both QMCPACK needs and thus is preferred.
If the multithreaded version does not provide this feature of dynamically adjusting the number of threads,
the serial version is preferred. In addition, thread safety is required no matter which version is used.</p>
</div>
</div>
<div class="section" id="cross-compiling">
<h3>Cross compiling<a class="headerlink" href="#cross-compiling" title="Permalink to this headline">¶</a></h3>
<p>Cross compiling is often difficult but is required on supercomputers
with distinct host and compute processor generations or architectures.
QMCPACK tried to do its best with CMake to facilitate cross compiling.</p>
<ul class="simple">
<li><p>On a machine using a Cray programming environment, we rely on
compiler wrappers provided by Cray to correctly set architecture-specific
flags. The CMake configure log should indicate that a
Cray machine was detected.</p></li>
<li><p>If not on a Cray machine, by default we assume building for
the host architecture (e.g., -xHost is added for the Intel compiler
and -march=native is added for GNU/Clang compilers).</p></li>
<li><p>If -x/-ax or -march is specified by the user in CMAKE_C_FLAGS and CMAKE_CXX_FLAGS,
we respect the user’s intention and do not add any architecture-specific flags.</p></li>
</ul>
<p>The general strategy for cross compiling should therefore be to
manually set CMAKE_C_FLAGS and CMAKE_CXX_FLAGS for the target
architecture. Using <code class="docutils literal notranslate"><span class="pre">make</span> <span class="pre">VERBOSE=1</span></code> is a useful way to check the
final compilation options.  If on a Cray machine, selection of the
appropriate programming environment should be sufficient.</p>
</div>
</div>
<div class="section" id="installation-instructions-for-common-workstations-and-supercomputers">
<h2>Installation instructions for common workstations and supercomputers<a class="headerlink" href="#installation-instructions-for-common-workstations-and-supercomputers" title="Permalink to this headline">¶</a></h2>
<p>This section describes how to build QMCPACK on various common systems
including multiple Linux distributions, Apple OS X, and various
supercomputers. The examples should serve as good starting points for
building QMCPACK on similar machines. For example, the software
environment on modern Crays is very consistent. Note that updates to
operating systems and system software might require small modifications
to these recipes. See <a class="reference internal" href="#buildperformance"><span class="std std-ref">How to build the fastest executable version of QMCPACK</span></a> for key
points to check to obtain highest performance and
<a class="reference internal" href="#troubleshoot"><span class="std std-ref">Troubleshooting the installation</span></a> for troubleshooting hints.</p>
<div class="section" id="installing-on-ubuntu-linux-or-other-apt-get-based-distributions">
<h3>Installing on Ubuntu Linux or other apt-get–based distributions<a class="headerlink" href="#installing-on-ubuntu-linux-or-other-apt-get-based-distributions" title="Permalink to this headline">¶</a></h3>
<p>The following is designed to obtain a working QMCPACK build on, for example, a
student laptop, starting from a basic Linux installation with none of
the developer tools installed. Fortunately, all the required packages
are available in the default repositories making for a quick
installation. Note that for convenience we use a generic BLAS. For
production, a platform-optimized BLAS should be used.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">apt</span><span class="o">-</span><span class="n">get</span> <span class="n">cmake</span> <span class="n">g</span><span class="o">++</span> <span class="n">openmpi</span><span class="o">-</span><span class="nb">bin</span> <span class="n">libopenmpi</span><span class="o">-</span><span class="n">dev</span> <span class="n">libboost</span><span class="o">-</span><span class="n">dev</span>
<span class="n">apt</span><span class="o">-</span><span class="n">get</span> <span class="n">libatlas</span><span class="o">-</span><span class="n">base</span><span class="o">-</span><span class="n">dev</span> <span class="n">liblapack</span><span class="o">-</span><span class="n">dev</span> <span class="n">libhdf5</span><span class="o">-</span><span class="n">dev</span> <span class="n">libxml2</span><span class="o">-</span><span class="n">dev</span> <span class="n">fftw3</span><span class="o">-</span><span class="n">dev</span>
<span class="n">export</span> <span class="n">CXX</span><span class="o">=</span><span class="n">mpiCC</span>
<span class="n">cd</span> <span class="n">build</span>
<span class="n">cmake</span> <span class="o">..</span>
<span class="n">make</span> <span class="o">-</span><span class="n">j</span> <span class="mi">8</span>
<span class="n">ls</span> <span class="o">-</span><span class="n">l</span> <span class="nb">bin</span><span class="o">/</span><span class="n">qmcpack</span>
</pre></div>
</div>
<p>For qmca and other tools to function, we install some Python libraries:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sudo</span> <span class="n">apt</span><span class="o">-</span><span class="n">get</span> <span class="n">install</span> <span class="n">python</span><span class="o">-</span><span class="n">numpy</span> <span class="n">python</span><span class="o">-</span><span class="n">matplotlib</span>
</pre></div>
</div>
</div>
<div class="section" id="installing-on-centos-linux-or-other-yum-based-distributions">
<h3>Installing on CentOS Linux or other yum-based distributions<a class="headerlink" href="#installing-on-centos-linux-or-other-yum-based-distributions" title="Permalink to this headline">¶</a></h3>
<p>The following is designed to obtain a working QMCPACK build on, for example, a
student laptop, starting from a basic Linux installation with none of
the developer tools installed. CentOS 7 (Red Hat compatible) is using
gcc 4.8.2. The installation is complicated only by the need to install
another repository to obtain HDF5 packages that are not available by
default. Note that for convenience we use a generic BLAS. For
production, a platform-optimized BLAS should be used.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sudo</span> <span class="n">yum</span> <span class="n">install</span> <span class="n">make</span> <span class="n">cmake</span> <span class="n">gcc</span> <span class="n">gcc</span><span class="o">-</span><span class="n">c</span><span class="o">++</span> <span class="n">openmpi</span> <span class="n">openmpi</span><span class="o">-</span><span class="n">devel</span> <span class="n">fftw</span> <span class="n">fftw</span><span class="o">-</span><span class="n">devel</span> \
                  <span class="n">boost</span> <span class="n">boost</span><span class="o">-</span><span class="n">devel</span> <span class="n">libxml2</span> <span class="n">libxml2</span><span class="o">-</span><span class="n">devel</span>
<span class="n">sudo</span> <span class="n">yum</span> <span class="n">install</span> <span class="n">blas</span><span class="o">-</span><span class="n">devel</span> <span class="n">lapack</span><span class="o">-</span><span class="n">devel</span> <span class="n">atlas</span><span class="o">-</span><span class="n">devel</span>
<span class="n">module</span> <span class="n">load</span> <span class="n">mpi</span>
</pre></div>
</div>
<p>To set up repoforge as a source for the HDF5 package, go to
<a class="reference external" href="http://repoforge.org/use">http://repoforge.org/use</a>. Install the appropriate up-to-date
release package for your operating system. By default, CentOS Firefox will offer
to run the installer. The CentOS 6.5 settings were still usable for HDF5 on
CentOS 7 in 2016, but use CentOS 7 versions when they become
available.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sudo</span> <span class="n">yum</span> <span class="n">install</span> <span class="n">hdf5</span> <span class="n">hdf5</span><span class="o">-</span><span class="n">devel</span>
</pre></div>
</div>
<p>To build QMCPACK:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">module</span> <span class="n">load</span> <span class="n">mpi</span><span class="o">/</span><span class="n">openmpi</span><span class="o">-</span><span class="n">x86_64</span>
<span class="n">which</span> <span class="n">mpirun</span>
<span class="c1"># Sanity check; should print something like   /usr/lib64/openmpi/bin/mpirun</span>
<span class="n">export</span> <span class="n">CXX</span><span class="o">=</span><span class="n">mpiCC</span>
<span class="n">cd</span> <span class="n">build</span>
<span class="n">cmake</span> <span class="o">..</span>
<span class="n">make</span> <span class="o">-</span><span class="n">j</span> <span class="mi">8</span>
<span class="n">ls</span> <span class="o">-</span><span class="n">l</span> <span class="nb">bin</span><span class="o">/</span><span class="n">qmcpack</span>
</pre></div>
</div>
</div>
<div class="section" id="installing-on-mac-os-x-using-macports">
<h3>Installing on Mac OS X using Macports<a class="headerlink" href="#installing-on-mac-os-x-using-macports" title="Permalink to this headline">¶</a></h3>
<p>These instructions assume a fresh installation of macports
and use the gcc 6.1 compiler. Older versions are fine, but it is vital to ensure that
matching compilers and libraries are used for all
packages and to force use of what is installed in /opt/local.  Performance should be very reasonable.
Note that we use the Apple-provided Accelerate framework for
optimized BLAS.</p>
<p>Follow the Macports install instructions at <a class="reference external" href="https://www.macports.org/">https://www.macports.org/</a>.</p>
<ul class="simple">
<li><p>Install Xcode and the Xcode Command Line Tools.</p></li>
<li><p>Agree to Xcode license in Terminal: sudo xcodebuild -license.</p></li>
<li><p>Install MacPorts for your version of OS X.</p></li>
</ul>
<p>Install the required tools:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sudo</span> <span class="n">port</span> <span class="n">install</span> <span class="n">gcc6</span>
<span class="n">sudo</span> <span class="n">port</span> <span class="n">select</span> <span class="n">gcc</span> <span class="n">mp</span><span class="o">-</span><span class="n">gcc6</span>
<span class="n">sudo</span> <span class="n">port</span> <span class="n">install</span> <span class="n">openmpi</span><span class="o">-</span><span class="n">devel</span><span class="o">-</span><span class="n">gcc6</span>
<span class="n">sudo</span> <span class="n">port</span> <span class="n">select</span> <span class="o">--</span><span class="nb">set</span> <span class="n">mpi</span> <span class="n">openmpi</span><span class="o">-</span><span class="n">devel</span><span class="o">-</span><span class="n">gcc61</span><span class="o">-</span><span class="n">fortran</span>

<span class="n">sudo</span> <span class="n">port</span> <span class="n">install</span> <span class="n">fftw</span><span class="o">-</span><span class="mi">3</span> <span class="o">+</span><span class="n">gcc6</span>
<span class="n">sudo</span> <span class="n">port</span> <span class="n">install</span> <span class="n">libxml2</span>
<span class="n">sudo</span> <span class="n">port</span> <span class="n">install</span> <span class="n">cmake</span>
<span class="n">sudo</span> <span class="n">post</span> <span class="n">install</span> <span class="n">boost</span> <span class="o">+</span><span class="n">gcc6</span>
<span class="n">sudo</span> <span class="n">port</span> <span class="n">install</span> <span class="n">hdf5</span> <span class="o">+</span><span class="n">gcc6</span>

<span class="n">sudo</span> <span class="n">port</span> <span class="n">select</span> <span class="o">--</span><span class="nb">set</span> <span class="n">python</span> <span class="n">python27</span>
<span class="n">sudo</span> <span class="n">port</span> <span class="n">install</span> <span class="n">py27</span><span class="o">-</span><span class="n">numpy</span> <span class="o">+</span><span class="n">gcc6</span>
<span class="n">sudo</span> <span class="n">port</span> <span class="n">install</span> <span class="n">py27</span><span class="o">-</span><span class="n">matplotlib</span>  <span class="c1">#For graphical plots with qmca</span>
</pre></div>
</div>
<p>QMCPACK build:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">cd</span> <span class="n">build</span>
<span class="n">cmake</span> <span class="o">-</span><span class="n">DCMAKE_C_COMPILER</span><span class="o">=</span><span class="n">mpicc</span> <span class="o">-</span><span class="n">DCMAKE_CXX_COMPILER</span><span class="o">=</span><span class="n">mpiCXX</span> <span class="o">..</span>
<span class="n">make</span> <span class="o">-</span><span class="n">j</span> <span class="mi">6</span> <span class="c1"># Adjust for available core count</span>
<span class="n">ls</span> <span class="o">-</span><span class="n">l</span> <span class="nb">bin</span><span class="o">/</span><span class="n">qmcpack</span>
</pre></div>
</div>
<p>Cmake should pickup the versions of HDF5 and libxml (etc.) installed in
/opt/local by macports. If you have other copies of these libraries
installed and wish to force use of a specific version, use the
environment variables detailed in <a class="reference internal" href="#envvar"><span class="std std-ref">Environment variables</span></a>.</p>
<p>This recipe was verified on July 1, 2016, on a Mac running OS X 10.11.5
“El Capitain.”</p>
</div>
<div class="section" id="installing-on-mac-os-x-using-homebrew-brew">
<h3>Installing on Mac OS X using Homebrew (brew)<a class="headerlink" href="#installing-on-mac-os-x-using-homebrew-brew" title="Permalink to this headline">¶</a></h3>
<p>Homebrew is a package manager for OS X that provides a convenient
route to install all the QMCPACK dependencies. The
following recipe will install the latest available versions of each
package. This was successfully tested under OS X 10.12 “Sierra” in December 2017. Note that it is necessary to build the MPI software from
source to use the brew-provided gcc instead of Apple CLANG.</p>
<ol class="arabic simple">
<li><p>Install Homebrew from <a class="reference external" href="http://brew.sh/">http://brew.sh/</a>:</p></li>
</ol>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="nb">bin</span><span class="o">/</span><span class="n">ruby</span> <span class="o">-</span><span class="n">e</span> <span class="s2">&quot;$(curl -fsSL</span>
  <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">raw</span><span class="o">.</span><span class="n">githubusercontent</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">Homebrew</span><span class="o">/</span><span class="n">install</span><span class="o">/</span><span class="n">master</span><span class="o">/</span><span class="n">install</span><span class="p">)</span><span class="s2">&quot;</span>
</pre></div>
</div>
</div></blockquote>
<ol class="arabic simple" start="2">
<li><p>Install the prerequisites:</p></li>
</ol>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">brew</span> <span class="n">install</span> <span class="n">gcc</span> <span class="c1"># installs gcc 7.2.0 on 2017-12-19</span>
<span class="n">export</span> <span class="n">HOMEBREW_CXX</span><span class="o">=</span><span class="n">g</span><span class="o">++-</span><span class="mi">7</span>
<span class="n">export</span> <span class="n">HOMEBREW_CC</span><span class="o">=</span><span class="n">gcc</span><span class="o">-</span><span class="mi">7</span>
<span class="n">brew</span> <span class="n">install</span> <span class="n">mpich2</span> <span class="o">--</span><span class="n">build</span><span class="o">-</span><span class="n">from</span><span class="o">-</span><span class="n">source</span>
<span class="c1"># Build from source required to use homebrew compiled compilers as</span>
<span class="c1"># opposed to Apple CLANG. Check &quot;mpicc -v&quot; indicates Homebrew gcc</span>
<span class="n">brew</span> <span class="n">install</span> <span class="n">cmake</span>
<span class="n">brew</span> <span class="n">install</span> <span class="n">fftw</span>
<span class="n">brew</span> <span class="n">install</span> <span class="n">boost</span>
<span class="n">brew</span> <span class="n">install</span> <span class="n">homebrew</span><span class="o">/</span><span class="n">science</span><span class="o">/</span><span class="n">hdf5</span>
<span class="c1">#Note: Libxml2 is not required via brew since OS X already includes it.</span>
</pre></div>
</div>
</div></blockquote>
<ol class="arabic simple" start="3">
<li><p>Configure and build QMCPACK:</p></li>
</ol>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">cmake</span> <span class="o">-</span><span class="n">DCMAKE_C_COMPILER</span><span class="o">=/</span><span class="n">usr</span><span class="o">/</span><span class="n">local</span><span class="o">/</span><span class="nb">bin</span><span class="o">/</span><span class="n">mpicc</span> \
      <span class="o">-</span><span class="n">DCMAKE_CXX_COMPILER</span><span class="o">=/</span><span class="n">usr</span><span class="o">/</span><span class="n">local</span><span class="o">/</span><span class="nb">bin</span><span class="o">/</span><span class="n">mpicxx</span> <span class="o">..</span>
<span class="n">make</span> <span class="o">-</span><span class="n">j</span> <span class="mi">12</span>
</pre></div>
</div>
</div></blockquote>
<ol class="arabic simple" start="4">
<li><p>Run the short tests. When MPICH is used for the first time, OSX will request approval of the network connection for each executable.</p></li>
</ol>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ctest</span> <span class="o">-</span><span class="n">R</span> <span class="n">short</span> <span class="o">-</span><span class="n">LE</span> <span class="n">unstable</span>
</pre></div>
</div>
</div></blockquote>
</div>
<div class="section" id="installing-on-alcf-theta-cray-xc40">
<h3>Installing on ALCF Theta, Cray XC40<a class="headerlink" href="#installing-on-alcf-theta-cray-xc40" title="Permalink to this headline">¶</a></h3>
<p>Theta is a 9.65 petaflops system manufactured by Cray with 3,624 compute nodes.
Each node features a second-generation Intel Xeon Phi 7230 processor and 192 GB DDR4 RAM.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">export</span> <span class="n">CRAYPE_LINK_TYPE</span><span class="o">=</span><span class="n">dynamic</span>
<span class="c1"># Do not use cmake 3.9.1, it causes trouble with parallel HDF5.</span>
<span class="n">module</span> <span class="n">load</span> <span class="n">cmake</span><span class="o">/</span><span class="mf">3.11</span><span class="o">.</span><span class="mi">4</span>
<span class="n">module</span> <span class="n">unload</span> <span class="n">cray</span><span class="o">-</span><span class="n">libsci</span>
<span class="n">module</span> <span class="n">load</span> <span class="n">cray</span><span class="o">-</span><span class="n">hdf5</span><span class="o">-</span><span class="n">parallel</span>
<span class="n">module</span> <span class="n">load</span> <span class="n">gcc</span>   <span class="c1"># Make C++ 14 standard library available to the Intel compiler</span>
<span class="n">export</span> <span class="n">BOOST_ROOT</span><span class="o">=/</span><span class="n">soft</span><span class="o">/</span><span class="n">libraries</span><span class="o">/</span><span class="n">boost</span><span class="o">/</span><span class="mf">1.64</span><span class="o">.</span><span class="mi">0</span><span class="o">/</span><span class="n">intel</span>
<span class="n">cmake</span> <span class="o">..</span>
<span class="n">make</span> <span class="o">-</span><span class="n">j</span> <span class="mi">24</span>
<span class="n">ls</span> <span class="o">-</span><span class="n">l</span> <span class="nb">bin</span><span class="o">/</span><span class="n">qmcpack</span>
</pre></div>
</div>
</div>
<div class="section" id="installing-on-ornl-olcf-summit">
<h3>Installing on ORNL OLCF Summit<a class="headerlink" href="#installing-on-ornl-olcf-summit" title="Permalink to this headline">¶</a></h3>
<p>Summit is an IBM system at the ORNL OLCF built with IBM Power System AC922
nodes. They have two IBM Power 9 processors and six NVIDIA Volta V100
accelerators.</p>
<div class="section" id="building-qmcpack">
<h4>Building QMCPACK<a class="headerlink" href="#building-qmcpack" title="Permalink to this headline">¶</a></h4>
<p>Note that these build instructions are preliminary as the
software environment is subject to change. As of December 2018, the
IBM XL compiler does not support C++14, so we currently use the
gnu compiler.</p>
<p>For ease of reproducibility we provide build scripts for Summit.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">cd</span> <span class="n">qmcpack</span>
<span class="o">./</span><span class="n">config</span><span class="o">/</span><span class="n">build_olcf_summit</span><span class="o">.</span><span class="n">sh</span>
<span class="n">ls</span> <span class="nb">bin</span>
</pre></div>
</div>
</div>
<div class="section" id="building-quantum-espresso">
<h4>Building Quantum Espresso<a class="headerlink" href="#building-quantum-espresso" title="Permalink to this headline">¶</a></h4>
<p>We provide a build script for the v6.4.1 release of Quantum Espresso (QE).
The following can be used to build a CPU version of QE on Summit,
placing the script in the external_codes/quantum_espresso directory.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">cd</span> <span class="n">external_codes</span><span class="o">/</span><span class="n">quantum_espresso</span>
<span class="o">./</span><span class="n">build_qe_olcf_summit</span><span class="o">.</span><span class="n">sh</span>
</pre></div>
</div>
<p>Note that performance is
not yet optimized although vendor libraries are
used. Alternatively, the wavefunction files can be generated on
another system and the converted HDF5 files copied over.</p>
</div>
</div>
<div class="section" id="installing-on-nersc-cori-haswell-partition-cray-xc40">
<h3>Installing on NERSC Cori, Haswell Partition, Cray XC40<a class="headerlink" href="#installing-on-nersc-cori-haswell-partition-cray-xc40" title="Permalink to this headline">¶</a></h3>
<p>Cori is a Cray XC40 that includes 16-core Intel “Haswell” nodes
installed at NERSC. In the following example, the source code is
cloned in $HOME/qmc/git_QMCPACK and QMCPACK is built in the scratch
space.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>mkdir $HOME/qmc
mkdir $HOME/qmc/git_QMCPACK
cd $HOME/qmc_git_QMCPACK
git clone https://github.com/QMCPACK/qmcpack.git
cd qmcpack
git checkout v3.7.0 # Edit for desired version
export CRAYPE_LINK_TYPE=dynamic
module unload cray-libsci
module load boost/1.70.0
module load cray-hdf5-parallel
module load cmake/3.14.0
module load gcc/7.3.0 # Make C++ 14 standard library available to the Intel compiler
cd $SCRATCH
mkdir build_cori_hsw
cd build_cori_hsw
cmake -DQMC_SYMLINK_TEST_FILES=0 $HOME/qmc/git_QMCPACK/qmcpack/
nice make -j 8
ls -l bin/qmcpack
</pre></div>
</div>
<p>When the preceding was tested on May 16, 2019, the following module and
software versions were present:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">build_cori_hsw</span><span class="o">&gt;</span> <span class="n">module</span> <span class="nb">list</span>
<span class="n">Currently</span> <span class="n">Loaded</span> <span class="n">Modulefiles</span><span class="p">:</span>
<span class="mi">1</span><span class="p">)</span> <span class="n">modules</span><span class="o">/</span><span class="mf">3.2</span><span class="o">.</span><span class="mf">10.6</span>                                   <span class="mi">14</span><span class="p">)</span> <span class="n">alps</span><span class="o">/</span><span class="mf">6.6</span><span class="o">.</span><span class="mi">43</span><span class="o">-</span><span class="mf">6.0</span><span class="o">.</span><span class="mf">7.1_5</span><span class="o">.</span><span class="mi">45</span><span class="n">__ga796da32</span><span class="o">.</span><span class="n">ari</span>
<span class="mi">2</span><span class="p">)</span> <span class="n">nsg</span><span class="o">/</span><span class="mf">1.2</span><span class="o">.</span><span class="mi">0</span>                                          <span class="mi">15</span><span class="p">)</span> <span class="n">rca</span><span class="o">/</span><span class="mf">2.2</span><span class="o">.</span><span class="mi">18</span><span class="o">-</span><span class="mf">6.0</span><span class="o">.</span><span class="mf">7.1_5</span><span class="o">.</span><span class="mi">47</span><span class="n">__g2aa4f39</span><span class="o">.</span><span class="n">ari</span>
<span class="mi">3</span><span class="p">)</span> <span class="n">intel</span><span class="o">/</span><span class="mf">18.0</span><span class="o">.</span><span class="mf">1.163</span>                                   <span class="mi">16</span><span class="p">)</span> <span class="n">atp</span><span class="o">/</span><span class="mf">2.1</span><span class="o">.</span><span class="mi">3</span>
<span class="mi">4</span><span class="p">)</span> <span class="n">craype</span><span class="o">-</span><span class="n">network</span><span class="o">-</span><span class="n">aries</span>                               <span class="mi">17</span><span class="p">)</span> <span class="n">PrgEnv</span><span class="o">-</span><span class="n">intel</span><span class="o">/</span><span class="mf">6.0</span><span class="o">.</span><span class="mi">4</span>
<span class="mi">5</span><span class="p">)</span> <span class="n">craype</span><span class="o">/</span><span class="mf">2.5</span><span class="o">.</span><span class="mi">15</span>                                      <span class="mi">18</span><span class="p">)</span> <span class="n">craype</span><span class="o">-</span><span class="n">haswell</span>
<span class="mi">6</span><span class="p">)</span> <span class="n">udreg</span><span class="o">/</span><span class="mf">2.3</span><span class="o">.</span><span class="mi">2</span><span class="o">-</span><span class="mf">6.0</span><span class="o">.</span><span class="mf">7.1_5</span><span class="o">.</span><span class="mi">13</span><span class="n">__g5196236</span><span class="o">.</span><span class="n">ari</span>             <span class="mi">19</span><span class="p">)</span> <span class="n">cray</span><span class="o">-</span><span class="n">mpich</span><span class="o">/</span><span class="mf">7.7</span><span class="o">.</span><span class="mi">3</span>
<span class="mi">7</span><span class="p">)</span> <span class="n">ugni</span><span class="o">/</span><span class="mf">6.0</span><span class="o">.</span><span class="mf">14.0</span><span class="o">-</span><span class="mf">6.0</span><span class="o">.</span><span class="mf">7.1_3</span><span class="o">.</span><span class="mi">13</span><span class="n">__gea11d3d</span><span class="o">.</span><span class="n">ari</span>           <span class="mi">20</span><span class="p">)</span> <span class="n">gcc</span><span class="o">/</span><span class="mf">7.3</span><span class="o">.</span><span class="mi">0</span>
<span class="mi">8</span><span class="p">)</span> <span class="n">pmi</span><span class="o">/</span><span class="mf">5.0</span><span class="o">.</span><span class="mi">14</span>                                         <span class="mi">21</span><span class="p">)</span> <span class="n">altd</span><span class="o">/</span><span class="mf">2.0</span>
<span class="mi">9</span><span class="p">)</span> <span class="n">dmapp</span><span class="o">/</span><span class="mf">7.1</span><span class="o">.</span><span class="mi">1</span><span class="o">-</span><span class="mf">6.0</span><span class="o">.</span><span class="mf">7.1_5</span><span class="o">.</span><span class="mi">45</span><span class="n">__g5a674e0</span><span class="o">.</span><span class="n">ari</span>             <span class="mi">22</span><span class="p">)</span> <span class="n">darshan</span><span class="o">/</span><span class="mf">3.1</span><span class="o">.</span><span class="mi">4</span>
<span class="mi">10</span><span class="p">)</span> <span class="n">gni</span><span class="o">-</span><span class="n">headers</span><span class="o">/</span><span class="mf">5.0</span><span class="o">.</span><span class="mf">12.0</span><span class="o">-</span><span class="mf">6.0</span><span class="o">.</span><span class="mf">7.1_3</span><span class="o">.</span><span class="mi">11</span><span class="n">__g3b1768f</span><span class="o">.</span><span class="n">ari</span>   <span class="mi">23</span><span class="p">)</span> <span class="n">boost</span><span class="o">/</span><span class="mf">1.70</span><span class="o">.</span><span class="mi">0</span>
<span class="mi">11</span><span class="p">)</span> <span class="n">xpmem</span><span class="o">/</span><span class="mf">2.2</span><span class="o">.</span><span class="mi">15</span><span class="o">-</span><span class="mf">6.0</span><span class="o">.</span><span class="mf">7.1_5</span><span class="o">.</span><span class="mi">11</span><span class="n">__g7549d06</span><span class="o">.</span><span class="n">ari</span>           <span class="mi">24</span><span class="p">)</span> <span class="n">cray</span><span class="o">-</span><span class="n">hdf5</span><span class="o">-</span><span class="n">parallel</span><span class="o">/</span><span class="mf">1.10</span><span class="o">.</span><span class="mf">2.0</span>
<span class="mi">12</span><span class="p">)</span> <span class="n">job</span><span class="o">/</span><span class="mf">2.2</span><span class="o">.</span><span class="mi">3</span><span class="o">-</span><span class="mf">6.0</span><span class="o">.</span><span class="mf">7.1_5</span><span class="o">.</span><span class="mi">43</span><span class="n">__g6c4e934</span><span class="o">.</span><span class="n">ari</span>              <span class="mi">25</span><span class="p">)</span> <span class="n">cmake</span><span class="o">/</span><span class="mf">3.14</span><span class="o">.</span><span class="mi">0</span>
<span class="mi">13</span><span class="p">)</span> <span class="n">dvs</span><span class="o">/</span><span class="mf">2.7_2</span><span class="o">.</span><span class="mf">2.118</span><span class="o">-</span><span class="mf">6.0</span><span class="o">.</span><span class="mf">7.1_10</span><span class="o">.</span><span class="mi">1</span><span class="n">__g58b37a2</span>
</pre></div>
</div>
<p>The following slurm job file can be used to run the tests:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>#!/bin/bash
#SBATCH --qos=debug
#SBATCH --time=00:10:00
#SBATCH --nodes=1
#SBATCH --tasks-per-node=32
#SBATCH --constraint=haswell
echo --- Start `date`
echo --- Working directory: `pwd`
ctest -VV -R deterministic
echo --- End `date`
</pre></div>
</div>
</div>
<div class="section" id="installing-on-nersc-cori-xeon-phi-knl-partition-cray-xc40">
<h3>Installing on NERSC Cori, Xeon Phi KNL partition, Cray XC40<a class="headerlink" href="#installing-on-nersc-cori-xeon-phi-knl-partition-cray-xc40" title="Permalink to this headline">¶</a></h3>
<p>Cori is a Cray XC40 that includes Intel Xeon Phi Knight’s Landing (KNL) nodes. The following build recipe ensures that the code
generation is appropriate for the KNL nodes. The source is assumed to
be in $HOME/qmc/git_QMCPACK/qmcpack as per the Haswell example.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>export CRAYPE_LINK_TYPE=dynamic
module swap craype-haswell craype-mic-knl # Only difference between Haswell and KNL recipes
module unload cray-libsci
module load boost/1.70.0
module load cray-hdf5-parallel
module load cmake/3.14.0
module load gcc/7.3.0 # Make C++ 14 standard library available to the Intel compiler
cd $SCRATCH
mkdir build_cori_knl
cd build_cori_knl
cmake -DQMC_SYMLINK_TEST_FILES=0 $HOME/git_QMCPACK/qmcpack/
nice make -j 8
ls -l bin/qmcpack
</pre></div>
</div>
<p>When the preceding was tested on May 16, 2019, the following module and
software versions were present:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">build_cori_knl</span><span class="o">&gt;</span> <span class="n">module</span> <span class="nb">list</span>
  <span class="n">Currently</span> <span class="n">Loaded</span> <span class="n">Modulefiles</span><span class="p">:</span>
  <span class="mi">1</span><span class="p">)</span> <span class="n">modules</span><span class="o">/</span><span class="mf">3.2</span><span class="o">.</span><span class="mf">10.6</span>                                  <span class="mi">14</span><span class="p">)</span> <span class="n">alps</span><span class="o">/</span><span class="mf">6.6</span><span class="o">.</span><span class="mi">43</span><span class="o">-</span><span class="mf">6.0</span><span class="o">.</span><span class="mf">7.1_5</span><span class="o">.</span><span class="mi">45</span><span class="n">__ga796da32</span><span class="o">.</span><span class="n">ari</span>
  <span class="mi">2</span><span class="p">)</span> <span class="n">nsg</span><span class="o">/</span><span class="mf">1.2</span><span class="o">.</span><span class="mi">0</span>                                         <span class="mi">15</span><span class="p">)</span> <span class="n">rca</span><span class="o">/</span><span class="mf">2.2</span><span class="o">.</span><span class="mi">18</span><span class="o">-</span><span class="mf">6.0</span><span class="o">.</span><span class="mf">7.1_5</span><span class="o">.</span><span class="mi">47</span><span class="n">__g2aa4f39</span><span class="o">.</span><span class="n">ari</span>
  <span class="mi">3</span><span class="p">)</span> <span class="n">intel</span><span class="o">/</span><span class="mf">18.0</span><span class="o">.</span><span class="mf">1.163</span>                                  <span class="mi">16</span><span class="p">)</span> <span class="n">atp</span><span class="o">/</span><span class="mf">2.1</span><span class="o">.</span><span class="mi">3</span>
  <span class="mi">4</span><span class="p">)</span> <span class="n">craype</span><span class="o">-</span><span class="n">network</span><span class="o">-</span><span class="n">aries</span>                              <span class="mi">17</span><span class="p">)</span> <span class="n">PrgEnv</span><span class="o">-</span><span class="n">intel</span><span class="o">/</span><span class="mf">6.0</span><span class="o">.</span><span class="mi">4</span>
  <span class="mi">5</span><span class="p">)</span> <span class="n">craype</span><span class="o">/</span><span class="mf">2.5</span><span class="o">.</span><span class="mi">15</span>                                     <span class="mi">18</span><span class="p">)</span> <span class="n">craype</span><span class="o">-</span><span class="n">mic</span><span class="o">-</span><span class="n">knl</span>
  <span class="mi">6</span><span class="p">)</span> <span class="n">udreg</span><span class="o">/</span><span class="mf">2.3</span><span class="o">.</span><span class="mi">2</span><span class="o">-</span><span class="mf">6.0</span><span class="o">.</span><span class="mf">7.1_5</span><span class="o">.</span><span class="mi">13</span><span class="n">__g5196236</span><span class="o">.</span><span class="n">ari</span>            <span class="mi">19</span><span class="p">)</span> <span class="n">cray</span><span class="o">-</span><span class="n">mpich</span><span class="o">/</span><span class="mf">7.7</span><span class="o">.</span><span class="mi">3</span>
  <span class="mi">7</span><span class="p">)</span> <span class="n">ugni</span><span class="o">/</span><span class="mf">6.0</span><span class="o">.</span><span class="mf">14.0</span><span class="o">-</span><span class="mf">6.0</span><span class="o">.</span><span class="mf">7.1_3</span><span class="o">.</span><span class="mi">13</span><span class="n">__gea11d3d</span><span class="o">.</span><span class="n">ari</span>          <span class="mi">20</span><span class="p">)</span> <span class="n">gcc</span><span class="o">/</span><span class="mf">7.3</span><span class="o">.</span><span class="mi">0</span>
  <span class="mi">8</span><span class="p">)</span> <span class="n">pmi</span><span class="o">/</span><span class="mf">5.0</span><span class="o">.</span><span class="mi">14</span>                                        <span class="mi">21</span><span class="p">)</span> <span class="n">altd</span><span class="o">/</span><span class="mf">2.0</span>
  <span class="mi">9</span><span class="p">)</span> <span class="n">dmapp</span><span class="o">/</span><span class="mf">7.1</span><span class="o">.</span><span class="mi">1</span><span class="o">-</span><span class="mf">6.0</span><span class="o">.</span><span class="mf">7.1_5</span><span class="o">.</span><span class="mi">45</span><span class="n">__g5a674e0</span><span class="o">.</span><span class="n">ari</span>            <span class="mi">22</span><span class="p">)</span> <span class="n">darshan</span><span class="o">/</span><span class="mf">3.1</span><span class="o">.</span><span class="mi">4</span>
  <span class="mi">10</span><span class="p">)</span> <span class="n">gni</span><span class="o">-</span><span class="n">headers</span><span class="o">/</span><span class="mf">5.0</span><span class="o">.</span><span class="mf">12.0</span><span class="o">-</span><span class="mf">6.0</span><span class="o">.</span><span class="mf">7.1_3</span><span class="o">.</span><span class="mi">11</span><span class="n">__g3b1768f</span><span class="o">.</span><span class="n">ari</span>  <span class="mi">23</span><span class="p">)</span> <span class="n">boost</span><span class="o">/</span><span class="mf">1.70</span><span class="o">.</span><span class="mi">0</span>
  <span class="mi">11</span><span class="p">)</span> <span class="n">xpmem</span><span class="o">/</span><span class="mf">2.2</span><span class="o">.</span><span class="mi">15</span><span class="o">-</span><span class="mf">6.0</span><span class="o">.</span><span class="mf">7.1_5</span><span class="o">.</span><span class="mi">11</span><span class="n">__g7549d06</span><span class="o">.</span><span class="n">ari</span>          <span class="mi">24</span><span class="p">)</span> <span class="n">cray</span><span class="o">-</span><span class="n">hdf5</span><span class="o">-</span><span class="n">parallel</span><span class="o">/</span><span class="mf">1.10</span><span class="o">.</span><span class="mf">2.0</span>
  <span class="mi">12</span><span class="p">)</span> <span class="n">job</span><span class="o">/</span><span class="mf">2.2</span><span class="o">.</span><span class="mi">3</span><span class="o">-</span><span class="mf">6.0</span><span class="o">.</span><span class="mf">7.1_5</span><span class="o">.</span><span class="mi">43</span><span class="n">__g6c4e934</span><span class="o">.</span><span class="n">ari</span>             <span class="mi">25</span><span class="p">)</span> <span class="n">cmake</span><span class="o">/</span><span class="mf">3.14</span><span class="o">.</span><span class="mi">0</span>
  <span class="mi">13</span><span class="p">)</span> <span class="n">dvs</span><span class="o">/</span><span class="mf">2.7_2</span><span class="o">.</span><span class="mf">2.118</span><span class="o">-</span><span class="mf">6.0</span><span class="o">.</span><span class="mf">7.1_10</span><span class="o">.</span><span class="mi">1</span><span class="n">__g58b37a2</span>
</pre></div>
</div>
</div>
<div class="section" id="installing-on-systems-with-armv8-based-processors">
<h3>Installing on systems with ARMv8-based processors<a class="headerlink" href="#installing-on-systems-with-armv8-based-processors" title="Permalink to this headline">¶</a></h3>
<p>The following build recipe was verified using the <a href="#id2"><span class="problematic" id="id3">`</span></a>Arm Compiler for HPC’ on the ANL JLSE Comanche system with Cavium ThunderX2 processors on November 6, 2018.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># load armclang compiler</span>
<span class="n">module</span> <span class="n">load</span> <span class="n">Generic</span><span class="o">-</span><span class="n">AArch64</span><span class="o">/</span><span class="n">RHEL</span><span class="o">/</span><span class="mi">7</span><span class="o">/</span><span class="n">arm</span><span class="o">-</span><span class="n">hpc</span><span class="o">-</span><span class="n">compiler</span><span class="o">/</span><span class="mf">18.4</span>
<span class="c1"># load Arm performance libraries</span>
<span class="n">module</span> <span class="n">load</span> <span class="n">ThunderX2CN99</span><span class="o">/</span><span class="n">RHEL</span><span class="o">/</span><span class="mi">7</span><span class="o">/</span><span class="n">arm</span><span class="o">-</span><span class="n">hpc</span><span class="o">-</span><span class="n">compiler</span><span class="o">-</span><span class="mf">18.4</span><span class="o">/</span><span class="n">armpl</span><span class="o">/</span><span class="mf">18.4</span><span class="o">.</span><span class="mi">0</span>
<span class="c1"># define path to pre-installed packages</span>
<span class="n">export</span> <span class="n">HDF5_ROOT</span><span class="o">=&lt;/</span><span class="n">path</span><span class="o">/</span><span class="n">to</span><span class="o">/</span><span class="n">hdf5</span><span class="o">/</span><span class="n">install</span><span class="o">/&gt;</span>
<span class="n">export</span> <span class="n">BOOST_ROOT</span><span class="o">=&lt;/</span><span class="n">path</span><span class="o">/</span><span class="n">to</span><span class="o">/</span><span class="n">boost</span><span class="o">/</span><span class="n">install</span><span class="o">&gt;</span> <span class="c1"># header-only, no need to build</span>
</pre></div>
</div>
<p>Then using the following command:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">mkdir</span> <span class="n">build_armclang</span>
<span class="n">cd</span> <span class="n">build_armclang</span>
<span class="n">cmake</span> <span class="o">-</span><span class="n">DCMAKE_C_COMPILER</span><span class="o">=</span><span class="n">armclang</span> <span class="o">-</span><span class="n">DCMAKE_CXX_COMPILER</span><span class="o">=</span><span class="n">armclang</span><span class="o">++</span> <span class="o">-</span><span class="n">DQMC_MPI</span><span class="o">=</span><span class="mi">0</span> \
    <span class="o">-</span><span class="n">DLAPACK_LIBRARIES</span><span class="o">=</span><span class="s2">&quot;-L$ARMPL_DIR/lib -larmpl_mp&quot;</span> \
    <span class="o">-</span><span class="n">DFFTW_INCLUDE_DIR</span><span class="o">=</span><span class="s2">&quot;$ARMPL_DIR/include&quot;</span> \
    <span class="o">-</span><span class="n">DFFTW_LIBRARIES</span><span class="o">=</span><span class="s2">&quot;$ARMPL_DIR/lib/libarmpl_mp.a&quot;</span> \
    <span class="o">..</span>
<span class="n">make</span> <span class="o">-</span><span class="n">j</span> <span class="mi">56</span>
</pre></div>
</div>
<p>Note that armclang is recognized as an <a href="#id4"><span class="problematic" id="id5">`</span></a>unknown’ compiler by CMake v3.13* and below. In this case, we need to force it as clang to apply necessary flags. To do so, pass the following additionals option to CMake:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">-</span><span class="n">DCMAKE_C_COMPILER_ID</span><span class="o">=</span><span class="n">Clang</span> <span class="o">-</span><span class="n">DCMAKE_CXX_COMPILER_ID</span><span class="o">=</span><span class="n">Clang</span> \
<span class="o">-</span><span class="n">DCMAKE_CXX_COMPILER_VERSION</span><span class="o">=</span><span class="mf">5.0</span> <span class="o">-</span><span class="n">DCMAKE_CXX_STANDARD_COMPUTED_DEFAULT</span><span class="o">=</span><span class="mi">98</span> \
</pre></div>
</div>
</div>
<div class="section" id="installing-on-windows">
<h3>Installing on Windows<a class="headerlink" href="#installing-on-windows" title="Permalink to this headline">¶</a></h3>
<p>Install the Windows Subsystem for Linux and Bash on Windows.
Open a bash shell and follow the install directions for Ubuntu in <span class="xref std std-ref">buildubuntu</span>.</p>
</div>
</div>
<div class="section" id="installing-via-spack">
<h2>Installing via Spack<a class="headerlink" href="#installing-via-spack" title="Permalink to this headline">¶</a></h2>
<p>Spack is a package manager for scientific software.
One of the primary goals of Spack is to reduce the barrier for users to install scientific
software. Spack is intended to work on everything from laptop
computers to high-end supercomputers. More information about Spack can
be found at <a class="reference external" href="https://spack.readthedocs.io/en/latest">https://spack.readthedocs.io/en/latest</a>. The major
advantage of installation with Spack is that all dependencies are
automatically built, potentially including all the compilers and libraries, and
different versions of QMCPACK can easily coexist with each other.
The QMCPACK Spack package also knows how to automatically build
and patch QE. In principle, QMCPACK can be installed with
a single Spack command.</p>
<div class="section" id="known-limitations">
<h3>Known limitations<a class="headerlink" href="#known-limitations" title="Permalink to this headline">¶</a></h3>
<p>The QMCPACK Spack package inherits the limitations of the underlying
Spack infrastructure and its dependencies. The main limitation is that
installation can fail when building a dependency such as HDF5, MPICH,
etc. For <code class="docutils literal notranslate"><span class="pre">spack</span> <span class="pre">install</span> <span class="pre">qmcpack</span></code> to succeed, it is very
important to leverage preinstalled packages on your computer or
supercomputer. The other frequently encountered challenge is that the
compiler configuration is nonintuitive.  This is especially the case
with the Intel compiler. If you encounter any difficulties, we
recommend testing the Spack compiler configuration on a simpler
packages, e.g. HDF5.</p>
<p>Here are some additional limitations of the QMCPACK Spack package that
will be resolved in future releases:</p>
<ul class="simple">
<li><p>CUDA support in Spack still has some limitations.  It will
catch only some compiler-CUDA conflicts.</p></li>
<li><p>The Intel compiler must find a recent and compatible GCC
compiler in its path or one must be explicity set with the
<code class="docutils literal notranslate"><span class="pre">-gcc-name</span></code> and <code class="docutils literal notranslate"><span class="pre">-gxx-name</span></code> flags.</p></li>
</ul>
</div>
<div class="section" id="setting-up-the-spack-environment">
<h3>Setting up the Spack environment<a class="headerlink" href="#setting-up-the-spack-environment" title="Permalink to this headline">¶</a></h3>
<p>Begin by cloning Spack from GitHub and configuring your shell as described at
<a class="reference external" href="https://spack.readthedocs.io/en/latest/getting_started.html">https://spack.readthedocs.io/en/latest/getting_started.html</a>.</p>
<p>The goal of the next several steps is to set up the Spack environment
for building. First, we highly recommend limiting the number of build jobs to
a reasonable value for your machine. This can be
accomplished by modifying your <code class="docutils literal notranslate"><span class="pre">~/.spack/config.yaml</span></code> file as follows:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">config</span><span class="p">:</span>
  <span class="n">build_jobs</span><span class="p">:</span> <span class="mi">16</span>
</pre></div>
</div>
<p>Make sure any existing compilers are properly detected. For many
architectures, compilers are properly detected with no additional
effort.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">your</span><span class="o">-</span><span class="n">laptop</span><span class="o">&gt;</span> <span class="n">spack</span> <span class="n">compilers</span>
<span class="o">==&gt;</span> <span class="n">Available</span> <span class="n">compilers</span>
<span class="o">--</span> <span class="n">gcc</span> <span class="n">sierra</span><span class="o">-</span><span class="n">x86_64</span> <span class="o">--------------------------------------------</span>
<span class="n">gcc</span><span class="o">@</span><span class="mf">7.2</span><span class="o">.</span><span class="mi">0</span>  <span class="n">gcc</span><span class="o">@</span><span class="mf">6.4</span><span class="o">.</span><span class="mi">0</span>  <span class="n">gcc</span><span class="o">@</span><span class="mf">5.5</span><span class="o">.</span><span class="mi">0</span>  <span class="n">gcc</span><span class="o">@</span><span class="mf">4.9</span><span class="o">.</span><span class="mi">4</span>  <span class="n">gcc</span><span class="o">@</span><span class="mf">4.8</span><span class="o">.</span><span class="mi">5</span>  <span class="n">gcc</span><span class="o">@</span><span class="mf">4.7</span><span class="o">.</span><span class="mi">4</span>  <span class="n">gcc</span><span class="o">@</span><span class="mf">4.6</span><span class="o">.</span><span class="mi">4</span>
</pre></div>
</div>
<p>However, if your compiler is not automatically detected, it is straightforward
to add one:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">your</span><span class="o">-</span><span class="n">laptop</span><span class="o">&gt;</span> <span class="n">spack</span> <span class="n">compiler</span> <span class="n">add</span> <span class="o">&lt;</span><span class="n">path</span><span class="o">-</span><span class="n">to</span><span class="o">-</span><span class="n">compiler</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>The Intel compiler, and other commerical compilers like PGI, typically
require extra environment variables to work properly. If you have an
module environment set-up by your system administrators, it is
recommended that you set the module name in
<code class="docutils literal notranslate"><span class="pre">~/.spack/linux/compilers.yaml.</span></code> Here is an example for the
Intel compiler:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">-</span> <span class="n">compiler</span><span class="p">:</span>
  <span class="n">environment</span><span class="p">:{}</span>
  <span class="n">extra_rpaths</span><span class="p">:</span>  <span class="p">[]</span>
  <span class="n">flags</span><span class="p">:</span> <span class="p">{}</span>
  <span class="n">modules</span><span class="p">:</span>
  <span class="o">-</span> <span class="n">intel</span><span class="o">/</span><span class="mf">18.0</span><span class="o">.</span><span class="mi">3</span>
  <span class="n">operating_system</span><span class="p">:</span> <span class="n">ubuntu14</span><span class="o">.</span><span class="mi">04</span>
  <span class="n">paths</span><span class="p">:</span>
    <span class="n">cc</span><span class="p">:</span> <span class="o">/</span><span class="n">soft</span><span class="o">/</span><span class="n">com</span><span class="o">/</span><span class="n">packages</span><span class="o">/</span><span class="n">intel</span><span class="o">/</span><span class="mi">18</span><span class="o">/</span><span class="n">u3</span><span class="o">/</span><span class="n">compilers_and_libraries_2018</span><span class="o">.</span><span class="mf">3.222</span><span class="o">/</span><span class="n">linux</span><span class="o">/</span><span class="nb">bin</span><span class="o">/</span><span class="n">intel64</span><span class="o">/</span><span class="n">icc</span>
    <span class="n">cxx</span><span class="p">:</span> <span class="o">/</span><span class="n">soft</span><span class="o">/</span><span class="n">com</span><span class="o">/</span><span class="n">packages</span><span class="o">/</span><span class="n">intel</span><span class="o">/</span><span class="mi">18</span><span class="o">/</span><span class="n">u3</span><span class="o">/</span><span class="n">compilers_and_libraries_2018</span><span class="o">.</span><span class="mf">3.222</span><span class="o">/</span><span class="n">linux</span><span class="o">/</span><span class="nb">bin</span><span class="o">/</span><span class="n">intel64</span><span class="o">/</span><span class="n">icpc</span>
    <span class="n">f77</span><span class="p">:</span> <span class="o">/</span><span class="n">soft</span><span class="o">/</span><span class="n">com</span><span class="o">/</span><span class="n">packages</span><span class="o">/</span><span class="n">intel</span><span class="o">/</span><span class="mi">18</span><span class="o">/</span><span class="n">u3</span><span class="o">/</span><span class="n">compilers_and_libraries_2018</span><span class="o">.</span><span class="mf">3.222</span><span class="o">/</span><span class="n">linux</span><span class="o">/</span><span class="nb">bin</span><span class="o">/</span><span class="n">intel64</span><span class="o">/</span><span class="n">ifort</span>
    <span class="n">fc</span><span class="p">:</span> <span class="o">/</span><span class="n">soft</span><span class="o">/</span><span class="n">com</span><span class="o">/</span><span class="n">packages</span><span class="o">/</span><span class="n">intel</span><span class="o">/</span><span class="mi">18</span><span class="o">/</span><span class="n">u3</span><span class="o">/</span><span class="n">compilers_and_libraries_2018</span><span class="o">.</span><span class="mf">3.222</span><span class="o">/</span><span class="n">linux</span><span class="o">/</span><span class="nb">bin</span><span class="o">/</span><span class="n">intel64</span><span class="o">/</span><span class="n">ifort</span>
  <span class="n">spec</span><span class="p">:</span> <span class="n">intel</span><span class="o">@</span><span class="mf">18.0</span><span class="o">.</span><span class="mi">3</span>
  <span class="n">target</span><span class="p">:</span> <span class="n">x86_64</span>
</pre></div>
</div>
<p>If a module is not available, you will have to set-up the environment variables manually:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">-</span> <span class="n">compiler</span><span class="p">:</span>
  <span class="n">environment</span><span class="p">:</span>
    <span class="nb">set</span><span class="p">:</span>
      <span class="n">INTEL_LICENSE_FILE</span><span class="p">:</span> <span class="n">server</span><span class="nd">@national</span><span class="o">-</span><span class="n">lab</span><span class="o">.</span><span class="n">doe</span><span class="o">.</span><span class="n">gov</span>
  <span class="n">extra_rpaths</span><span class="p">:</span>
  <span class="p">[</span><span class="s1">&#39;/soft/com/packages/intel/18/u3/compilers_and_libraries_2018.3.222/linux/compiler/lib/intel64&#39;</span><span class="p">,</span>
  <span class="s1">&#39;/soft/apps/packages/gcc/gcc-6.2.0/lib64&#39;</span><span class="p">]</span>
  <span class="n">flags</span><span class="p">:</span>
    <span class="n">cflags</span><span class="p">:</span> <span class="o">-</span><span class="n">gcc</span><span class="o">-</span><span class="n">name</span><span class="o">=/</span><span class="n">soft</span><span class="o">/</span><span class="n">apps</span><span class="o">/</span><span class="n">packages</span><span class="o">/</span><span class="n">gcc</span><span class="o">/</span><span class="n">gcc</span><span class="o">-</span><span class="mf">6.2</span><span class="o">.</span><span class="mi">0</span><span class="o">/</span><span class="nb">bin</span><span class="o">/</span><span class="n">gcc</span>
    <span class="n">fflags</span><span class="p">:</span> <span class="o">-</span><span class="n">gcc</span><span class="o">-</span><span class="n">name</span><span class="o">=/</span><span class="n">soft</span><span class="o">/</span><span class="n">apps</span><span class="o">/</span><span class="n">packages</span><span class="o">/</span><span class="n">gcc</span><span class="o">/</span><span class="n">gcc</span><span class="o">-</span><span class="mf">6.2</span><span class="o">.</span><span class="mi">0</span><span class="o">/</span><span class="nb">bin</span><span class="o">/</span><span class="n">gcc</span>
    <span class="n">cxxflags</span><span class="p">:</span> <span class="o">-</span><span class="n">gxx</span><span class="o">-</span><span class="n">name</span><span class="o">=/</span><span class="n">soft</span><span class="o">/</span><span class="n">apps</span><span class="o">/</span><span class="n">packages</span><span class="o">/</span><span class="n">gcc</span><span class="o">/</span><span class="n">gcc</span><span class="o">-</span><span class="mf">6.2</span><span class="o">.</span><span class="mi">0</span><span class="o">/</span><span class="nb">bin</span><span class="o">/</span><span class="n">g</span><span class="o">++</span>
  <span class="n">modules</span><span class="p">:</span> <span class="p">[]</span>
  <span class="n">operating_system</span><span class="p">:</span> <span class="n">ubuntu14</span><span class="o">.</span><span class="mi">04</span>
  <span class="n">paths</span><span class="p">:</span>
    <span class="n">cc</span><span class="p">:</span> <span class="o">/</span><span class="n">soft</span><span class="o">/</span><span class="n">com</span><span class="o">/</span><span class="n">packages</span><span class="o">/</span><span class="n">intel</span><span class="o">/</span><span class="mi">18</span><span class="o">/</span><span class="n">u3</span><span class="o">/</span><span class="n">compilers_and_libraries_2018</span><span class="o">.</span><span class="mf">3.222</span><span class="o">/</span><span class="n">linux</span><span class="o">/</span><span class="nb">bin</span><span class="o">/</span><span class="n">intel64</span><span class="o">/</span><span class="n">icc</span>
    <span class="n">cxx</span><span class="p">:</span> <span class="o">/</span><span class="n">soft</span><span class="o">/</span><span class="n">com</span><span class="o">/</span><span class="n">packages</span><span class="o">/</span><span class="n">intel</span><span class="o">/</span><span class="mi">18</span><span class="o">/</span><span class="n">u3</span><span class="o">/</span><span class="n">compilers_and_libraries_2018</span><span class="o">.</span><span class="mf">3.222</span><span class="o">/</span><span class="n">linux</span><span class="o">/</span><span class="nb">bin</span><span class="o">/</span><span class="n">intel64</span><span class="o">/</span><span class="n">icpc</span>
    <span class="n">f77</span><span class="p">:</span> <span class="o">/</span><span class="n">soft</span><span class="o">/</span><span class="n">com</span><span class="o">/</span><span class="n">packages</span><span class="o">/</span><span class="n">intel</span><span class="o">/</span><span class="mi">18</span><span class="o">/</span><span class="n">u3</span><span class="o">/</span><span class="n">compilers_and_libraries_2018</span><span class="o">.</span><span class="mf">3.222</span><span class="o">/</span><span class="n">linux</span><span class="o">/</span><span class="nb">bin</span><span class="o">/</span><span class="n">intel64</span><span class="o">/</span><span class="n">ifort</span>
    <span class="n">fc</span><span class="p">:</span> <span class="o">/</span><span class="n">soft</span><span class="o">/</span><span class="n">com</span><span class="o">/</span><span class="n">packages</span><span class="o">/</span><span class="n">intel</span><span class="o">/</span><span class="mi">18</span><span class="o">/</span><span class="n">u3</span><span class="o">/</span><span class="n">compilers_and_libraries_2018</span><span class="o">.</span><span class="mf">3.222</span><span class="o">/</span><span class="n">linux</span><span class="o">/</span><span class="nb">bin</span><span class="o">/</span><span class="n">intel64</span><span class="o">/</span><span class="n">ifort</span>
  <span class="n">spec</span><span class="p">:</span> <span class="n">intel</span><span class="o">@</span><span class="mf">18.0</span><span class="o">.</span><span class="mi">3</span>
  <span class="n">target</span><span class="p">:</span> <span class="n">x86_64</span>
</pre></div>
</div>
<p>This last step is the most troublesome. Pre-installed packages are not
automatically detected. If vendor optimized libraries are already
installed, you will need to manually add them to your
<code class="docutils literal notranslate"><span class="pre">~/.spack/packages.yaml</span></code>. For example, this works on Mac OS X
for the Intel MKL package.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">your</span><span class="o">-</span><span class="n">laptop</span><span class="o">&gt;</span> <span class="n">cat</span> \<span class="o">~/.</span><span class="n">spack</span><span class="o">/</span><span class="n">packages</span><span class="o">.</span><span class="n">yaml</span>
<span class="n">packages</span><span class="p">:</span>
  <span class="n">intel</span><span class="o">-</span><span class="n">mkl</span><span class="p">:</span>
      <span class="n">paths</span><span class="p">:</span>
          <span class="n">intel</span><span class="o">-</span><span class="n">mkl</span><span class="o">@</span><span class="mf">2018.0</span><span class="o">.</span><span class="mi">128</span><span class="p">:</span> <span class="o">/</span><span class="n">opt</span><span class="o">/</span><span class="n">intel</span><span class="o">/</span><span class="n">compilers_and_libraries_2018</span><span class="o">.</span><span class="mf">0.104</span><span class="o">/</span><span class="n">mac</span><span class="o">/</span><span class="n">mkl</span>
      <span class="n">buildable</span><span class="p">:</span> <span class="kc">False</span>
</pre></div>
</div>
<p>Some trial-and-error might be involved to set the directories
correctly. If you do not include enough of the tree path, Spack will
not be able to register the package in its database. More information
about system packages can be found at
<a class="reference external" href="http://spack.readthedocs.io/en/latest/getting_started.html#system-packages">http://spack.readthedocs.io/en/latest/getting_started.html#system-packages</a>.</p>
<p>Beginning with QMCPACK v3.9.0, Python 3.x is required. However,
installing Python with a compiler besides GCC is tricky. We recommend
leveraging your local Python installation by adding an entry in
<code class="docutils literal notranslate"><span class="pre">~/.spack/packages.yaml</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">packages</span><span class="p">:</span>
  <span class="n">python</span><span class="p">:</span>
     <span class="n">modules</span><span class="p">:</span>
       <span class="n">python</span><span class="o">@</span><span class="mf">3.7</span><span class="o">.</span><span class="mi">4</span><span class="p">:</span> <span class="n">anaconda3</span><span class="o">/</span><span class="mf">2019.10</span>
</pre></div>
</div>
<p>Or if a module is not available</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">packages</span><span class="p">:</span>
  <span class="n">python</span><span class="p">:</span>
     <span class="n">paths</span><span class="p">:</span>
        <span class="n">python</span><span class="o">@</span><span class="mf">3.7</span><span class="o">.</span><span class="mi">4</span><span class="p">:</span> <span class="o">/</span><span class="n">nfs</span><span class="o">/</span><span class="n">gce</span><span class="o">/</span><span class="n">software</span><span class="o">/</span><span class="n">custom</span><span class="o">/</span><span class="n">linux</span><span class="o">-</span><span class="n">ubuntu18</span><span class="o">.</span><span class="mi">04</span><span class="o">-</span><span class="n">x86_64</span><span class="o">/</span><span class="n">anaconda3</span><span class="o">/</span><span class="mf">2019.10</span><span class="o">/</span><span class="nb">bin</span><span class="o">/</span><span class="n">python</span>
   <span class="n">buildable</span><span class="p">:</span> <span class="kc">False</span>
</pre></div>
</div>
</div>
<div class="section" id="id6">
<h3>Building QMCPACK<a class="headerlink" href="#id6" title="Permalink to this headline">¶</a></h3>
<p>The QMCPACK Spack package has a number of variants to support different compile time
options and different versions of the application. A full list can be displayed by typing:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">your</span> <span class="n">laptop</span><span class="o">&gt;</span> <span class="n">spack</span> <span class="n">info</span> <span class="n">qmcpack</span>
<span class="n">CMakePackage</span><span class="p">:</span>   <span class="n">qmcpack</span>

<span class="n">Description</span><span class="p">:</span>
  <span class="n">QMCPACK</span><span class="p">,</span> <span class="ow">is</span> <span class="n">a</span> <span class="n">modern</span> <span class="n">high</span><span class="o">-</span><span class="n">performance</span> <span class="nb">open</span><span class="o">-</span><span class="n">source</span> <span class="n">Quantum</span> <span class="n">Monte</span> <span class="n">Carlo</span>
  <span class="p">(</span><span class="n">QMC</span><span class="p">)</span> <span class="n">simulation</span> <span class="n">code</span><span class="o">.</span>

<span class="n">Homepage</span><span class="p">:</span> <span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">www</span><span class="o">.</span><span class="n">qmcpack</span><span class="o">.</span><span class="n">org</span><span class="o">/</span>

<span class="n">Tags</span><span class="p">:</span>
  <span class="n">ecp</span>  <span class="n">ecp</span><span class="o">-</span><span class="n">apps</span>

<span class="n">Preferred</span> <span class="n">version</span><span class="p">:</span>
  <span class="mf">3.9</span><span class="o">.</span><span class="mi">1</span>      <span class="p">[</span><span class="n">git</span><span class="p">]</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">github</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">QMCPACK</span><span class="o">/</span><span class="n">qmcpack</span><span class="o">.</span><span class="n">git</span> <span class="n">at</span> <span class="n">tag</span> <span class="n">v3</span><span class="o">.</span><span class="mf">9.1</span>

<span class="n">Safe</span> <span class="n">versions</span><span class="p">:</span>
  <span class="n">develop</span>  <span class="p">[</span><span class="n">git</span><span class="p">]</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">github</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">QMCPACK</span><span class="o">/</span><span class="n">qmcpack</span><span class="o">.</span><span class="n">git</span>
  <span class="mf">3.9</span><span class="o">.</span><span class="mi">1</span>      <span class="p">[</span><span class="n">git</span><span class="p">]</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">github</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">QMCPACK</span><span class="o">/</span><span class="n">qmcpack</span><span class="o">.</span><span class="n">git</span> <span class="n">at</span> <span class="n">tag</span> <span class="n">v3</span><span class="o">.</span><span class="mf">9.1</span>
  <span class="mf">3.9</span><span class="o">.</span><span class="mi">0</span>      <span class="p">[</span><span class="n">git</span><span class="p">]</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">github</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">QMCPACK</span><span class="o">/</span><span class="n">qmcpack</span><span class="o">.</span><span class="n">git</span> <span class="n">at</span> <span class="n">tag</span> <span class="n">v3</span><span class="o">.</span><span class="mf">9.0</span>
  <span class="mf">3.8</span><span class="o">.</span><span class="mi">0</span>      <span class="p">[</span><span class="n">git</span><span class="p">]</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">github</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">QMCPACK</span><span class="o">/</span><span class="n">qmcpack</span><span class="o">.</span><span class="n">git</span> <span class="n">at</span> <span class="n">tag</span> <span class="n">v3</span><span class="o">.</span><span class="mf">8.0</span>
  <span class="mf">3.7</span><span class="o">.</span><span class="mi">0</span>      <span class="p">[</span><span class="n">git</span><span class="p">]</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">github</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">QMCPACK</span><span class="o">/</span><span class="n">qmcpack</span><span class="o">.</span><span class="n">git</span> <span class="n">at</span> <span class="n">tag</span> <span class="n">v3</span><span class="o">.</span><span class="mf">7.0</span>
  <span class="mf">3.6</span><span class="o">.</span><span class="mi">0</span>      <span class="p">[</span><span class="n">git</span><span class="p">]</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">github</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">QMCPACK</span><span class="o">/</span><span class="n">qmcpack</span><span class="o">.</span><span class="n">git</span> <span class="n">at</span> <span class="n">tag</span> <span class="n">v3</span><span class="o">.</span><span class="mf">6.0</span>
  <span class="mf">3.5</span><span class="o">.</span><span class="mi">0</span>      <span class="p">[</span><span class="n">git</span><span class="p">]</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">github</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">QMCPACK</span><span class="o">/</span><span class="n">qmcpack</span><span class="o">.</span><span class="n">git</span> <span class="n">at</span> <span class="n">tag</span> <span class="n">v3</span><span class="o">.</span><span class="mf">5.0</span>
  <span class="mf">3.4</span><span class="o">.</span><span class="mi">0</span>      <span class="p">[</span><span class="n">git</span><span class="p">]</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">github</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">QMCPACK</span><span class="o">/</span><span class="n">qmcpack</span><span class="o">.</span><span class="n">git</span> <span class="n">at</span> <span class="n">tag</span> <span class="n">v3</span><span class="o">.</span><span class="mf">4.0</span>
  <span class="mf">3.3</span><span class="o">.</span><span class="mi">0</span>      <span class="p">[</span><span class="n">git</span><span class="p">]</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">github</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">QMCPACK</span><span class="o">/</span><span class="n">qmcpack</span><span class="o">.</span><span class="n">git</span> <span class="n">at</span> <span class="n">tag</span> <span class="n">v3</span><span class="o">.</span><span class="mf">3.0</span>
  <span class="mf">3.2</span><span class="o">.</span><span class="mi">0</span>      <span class="p">[</span><span class="n">git</span><span class="p">]</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">github</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">QMCPACK</span><span class="o">/</span><span class="n">qmcpack</span><span class="o">.</span><span class="n">git</span> <span class="n">at</span> <span class="n">tag</span> <span class="n">v3</span><span class="o">.</span><span class="mf">2.0</span>
  <span class="mf">3.1</span><span class="o">.</span><span class="mi">1</span>      <span class="p">[</span><span class="n">git</span><span class="p">]</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">github</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">QMCPACK</span><span class="o">/</span><span class="n">qmcpack</span><span class="o">.</span><span class="n">git</span> <span class="n">at</span> <span class="n">tag</span> <span class="n">v3</span><span class="o">.</span><span class="mf">1.1</span>
  <span class="mf">3.1</span><span class="o">.</span><span class="mi">0</span>      <span class="p">[</span><span class="n">git</span><span class="p">]</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">github</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">QMCPACK</span><span class="o">/</span><span class="n">qmcpack</span><span class="o">.</span><span class="n">git</span> <span class="n">at</span> <span class="n">tag</span> <span class="n">v3</span><span class="o">.</span><span class="mf">1.0</span>

<span class="n">Variants</span><span class="p">:</span>
  <span class="n">Name</span> <span class="p">[</span><span class="n">Default</span><span class="p">]</span>          <span class="n">Allowed</span> <span class="n">values</span>          <span class="n">Description</span>


  <span class="n">build_type</span> <span class="p">[</span><span class="n">Release</span><span class="p">]</span>    <span class="n">Debug</span><span class="p">,</span> <span class="n">Release</span><span class="p">,</span>         <span class="n">The</span> <span class="n">build</span> <span class="nb">type</span> <span class="n">to</span> <span class="n">build</span>
                          <span class="n">RelWithDebInfo</span>
  <span class="n">afqmc</span> <span class="p">[</span><span class="n">off</span><span class="p">]</span>             <span class="kc">True</span><span class="p">,</span> <span class="kc">False</span>             <span class="n">Install</span> <span class="k">with</span> <span class="n">AFQMC</span> <span class="n">support</span><span class="o">.</span>
                                                  <span class="n">NOTE</span> <span class="n">that</span> <span class="k">if</span> <span class="n">used</span> <span class="ow">in</span>
                                                  <span class="n">combination</span> <span class="k">with</span> <span class="n">CUDA</span><span class="p">,</span> <span class="n">only</span>
                                                  <span class="n">AFQMC</span> <span class="n">will</span> <span class="n">have</span> <span class="n">CUDA</span><span class="o">.</span>
  <span class="nb">complex</span> <span class="p">[</span><span class="n">off</span><span class="p">]</span>           <span class="kc">True</span><span class="p">,</span> <span class="kc">False</span>             <span class="n">Build</span> <span class="n">the</span> <span class="nb">complex</span> <span class="p">(</span><span class="n">general</span>
                                                  <span class="n">twist</span><span class="o">/</span><span class="n">k</span><span class="o">-</span><span class="n">point</span><span class="p">)</span> <span class="n">version</span>
  <span class="n">cuda</span> <span class="p">[</span><span class="n">off</span><span class="p">]</span>              <span class="kc">True</span><span class="p">,</span> <span class="kc">False</span>             <span class="n">Build</span> <span class="k">with</span> <span class="n">CUDA</span>
  <span class="n">cuda_arch</span> <span class="p">[</span><span class="n">none</span><span class="p">]</span>        <span class="n">none</span><span class="p">,</span> <span class="mi">53</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">62</span><span class="p">,</span>       <span class="n">CUDA</span> <span class="n">architecture</span>
                          <span class="mi">60</span><span class="p">,</span> <span class="mi">61</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">75</span><span class="p">,</span> <span class="mi">70</span><span class="p">,</span>
                          <span class="mi">72</span><span class="p">,</span> <span class="mi">32</span><span class="p">,</span> <span class="mi">52</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="mi">35</span>
  <span class="n">da</span> <span class="p">[</span><span class="n">off</span><span class="p">]</span>                <span class="kc">True</span><span class="p">,</span> <span class="kc">False</span>             <span class="n">Install</span> <span class="k">with</span> <span class="n">support</span> <span class="k">for</span> <span class="n">basic</span>
                                                  <span class="n">data</span> <span class="n">analysis</span> <span class="n">tools</span>
  <span class="n">gui</span> <span class="p">[</span><span class="n">off</span><span class="p">]</span>               <span class="kc">True</span><span class="p">,</span> <span class="kc">False</span>             <span class="n">Install</span> <span class="k">with</span> <span class="n">Matplotlib</span> <span class="p">(</span><span class="n">long</span>
                                                  <span class="n">installation</span> <span class="n">time</span><span class="p">)</span>
  <span class="n">mixed</span> <span class="p">[</span><span class="n">off</span><span class="p">]</span>             <span class="kc">True</span><span class="p">,</span> <span class="kc">False</span>             <span class="n">Build</span> <span class="n">the</span> <span class="n">mixed</span> <span class="n">precision</span>
                                                  <span class="p">(</span><span class="n">mixture</span> <span class="n">of</span> <span class="n">single</span> <span class="ow">and</span> <span class="n">double</span>
                                                  <span class="n">precision</span><span class="p">)</span> <span class="n">version</span> <span class="k">for</span> <span class="n">gpu</span> <span class="ow">and</span>
                                                  <span class="n">cpu</span>
  <span class="n">mpi</span> <span class="p">[</span><span class="n">on</span><span class="p">]</span>                <span class="kc">True</span><span class="p">,</span> <span class="kc">False</span>             <span class="n">Build</span> <span class="k">with</span> <span class="n">MPI</span> <span class="n">support</span>
  <span class="n">phdf5</span> <span class="p">[</span><span class="n">on</span><span class="p">]</span>              <span class="kc">True</span><span class="p">,</span> <span class="kc">False</span>             <span class="n">Build</span> <span class="k">with</span> <span class="n">parallel</span> <span class="n">collective</span>
                                                  <span class="n">I</span><span class="o">/</span><span class="n">O</span>
  <span class="n">ppconvert</span> <span class="p">[</span><span class="n">off</span><span class="p">]</span>         <span class="kc">True</span><span class="p">,</span> <span class="kc">False</span>             <span class="n">Install</span> <span class="k">with</span> <span class="n">pseudopotential</span>
                                                  <span class="n">converter</span><span class="o">.</span>
  <span class="n">qe</span> <span class="p">[</span><span class="n">on</span><span class="p">]</span>                 <span class="kc">True</span><span class="p">,</span> <span class="kc">False</span>             <span class="n">Install</span> <span class="k">with</span> <span class="n">patched</span> <span class="n">Quantum</span>
                                                  <span class="n">Espresso</span> <span class="mf">6.4</span><span class="o">.</span><span class="mi">0</span>
  <span class="n">soa</span> <span class="p">[</span><span class="n">on</span><span class="p">]</span>                <span class="kc">True</span><span class="p">,</span> <span class="kc">False</span>             <span class="n">Build</span> <span class="k">with</span> <span class="n">Structure</span><span class="o">-</span><span class="n">of</span><span class="o">-</span><span class="n">Array</span>
                                                  <span class="n">instead</span> <span class="n">of</span> <span class="n">Array</span><span class="o">-</span><span class="n">of</span><span class="o">-</span><span class="n">Structure</span>
                                                  <span class="n">code</span><span class="o">.</span> <span class="n">Only</span> <span class="k">for</span> <span class="n">CPU</span> <span class="n">codeand</span>
                                                  <span class="n">only</span> <span class="ow">in</span> <span class="n">mixed</span> <span class="n">precision</span>
  <span class="n">timers</span> <span class="p">[</span><span class="n">off</span><span class="p">]</span>            <span class="kc">True</span><span class="p">,</span> <span class="kc">False</span>             <span class="n">Build</span> <span class="k">with</span> <span class="n">support</span> <span class="k">for</span> <span class="n">timers</span>

<span class="n">Installation</span> <span class="n">Phases</span><span class="p">:</span>
  <span class="n">cmake</span>    <span class="n">build</span>    <span class="n">install</span>

<span class="n">Build</span> <span class="n">Dependencies</span><span class="p">:</span>
  <span class="n">blas</span>  <span class="n">boost</span>  <span class="n">cmake</span>  <span class="n">cuda</span>  <span class="n">fftw</span><span class="o">-</span><span class="n">api</span>  <span class="n">hdf5</span>  <span class="n">lapack</span>  <span class="n">libxml2</span>  <span class="n">mpi</span>  <span class="n">python</span>

<span class="n">Link</span> <span class="n">Dependencies</span><span class="p">:</span>
  <span class="n">blas</span>  <span class="n">boost</span>  <span class="n">cuda</span>  <span class="n">fftw</span><span class="o">-</span><span class="n">api</span>  <span class="n">hdf5</span>  <span class="n">lapack</span>  <span class="n">libxml2</span>  <span class="n">mpi</span>  <span class="n">python</span>

<span class="n">Run</span> <span class="n">Dependencies</span><span class="p">:</span>
  <span class="n">py</span><span class="o">-</span><span class="n">matplotlib</span>  <span class="n">py</span><span class="o">-</span><span class="n">numpy</span>  <span class="n">quantum</span><span class="o">-</span><span class="n">espresso</span>

<span class="n">Virtual</span> <span class="n">Packages</span><span class="p">:</span>
  <span class="kc">None</span>
</pre></div>
</div>
<p>For example, to install the complex-valued version of QMCPACK in mixed-precision use:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">your</span><span class="o">-</span><span class="n">laptop</span><span class="o">&gt;</span> <span class="n">spack</span> <span class="n">install</span> <span class="n">qmcpack</span><span class="o">+</span><span class="n">mixed</span><span class="o">+</span><span class="nb">complex</span><span class="o">%</span><span class="n">gcc</span><span class="o">@</span><span class="mf">7.2</span><span class="o">.</span><span class="mi">0</span> <span class="o">^</span><span class="n">intel</span><span class="o">-</span><span class="n">mkl</span>
</pre></div>
</div>
<p>where</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">%</span><span class="n">gcc</span><span class="o">@</span><span class="mf">7.2</span><span class="o">.</span><span class="mi">0</span>
</pre></div>
</div>
<p>specifies the compiler version to be used and</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">^</span><span class="n">intel</span><span class="o">-</span><span class="n">mkl</span>
</pre></div>
</div>
<p>specifies that the Intel MKL should be used as the BLAS and LAPACK
provider. The <code class="docutils literal notranslate"><span class="pre">^</span></code> symbol indicates the the package to the right of the
symbol should be used to fulfill the dependency needed by the installation.</p>
<p>It is also possible to run the QMCPACK regression tests as part of the
installation process, for example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">your</span><span class="o">-</span><span class="n">laptop</span><span class="o">&gt;</span> <span class="n">spack</span> <span class="n">install</span> <span class="o">--</span><span class="n">test</span><span class="o">=</span><span class="n">root</span> <span class="n">qmcpack</span><span class="o">+</span><span class="n">mixed</span><span class="o">+</span><span class="nb">complex</span><span class="o">%</span><span class="n">gcc</span><span class="o">@</span><span class="mf">7.2</span><span class="o">.</span><span class="mi">0</span> <span class="o">^</span><span class="n">intel</span><span class="o">-</span><span class="n">mkl</span>
</pre></div>
</div>
<p>will run the unit and short tests. The current behavior of the QMCPACK
Spack package is to complete the install as long as all the unit tests
pass. If the short tests fail, a warning is issued at the command prompt.</p>
<p>For CUDA, you will need to specify and extra <code class="docutils literal notranslate"><span class="pre">cuda_arch</span></code>
parameter otherwise, it will default to <code class="docutils literal notranslate"><span class="pre">cuda_arch=61</span></code>.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">your</span><span class="o">-</span><span class="n">laptop</span><span class="o">&gt;</span> <span class="n">spack</span> <span class="n">install</span> <span class="n">qmcpack</span><span class="o">+</span><span class="n">cuda</span><span class="o">%</span><span class="n">intel</span><span class="o">@</span><span class="mf">18.0</span><span class="o">.</span><span class="mi">3</span> <span class="n">cuda_arch</span><span class="o">=</span><span class="mi">61</span> <span class="o">^</span><span class="n">intel</span><span class="o">-</span><span class="n">mkl</span>
</pre></div>
</div>
<p>Due to limitations in the Spack CUDA package, if your compiler and
CUDA combination conflict, you will need to set a
specific verison of CUDA that is compatible with your compiler on the
command line. For example,</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">your</span><span class="o">-</span><span class="n">laptop</span><span class="o">&gt;</span> <span class="n">spack</span> <span class="n">install</span> <span class="n">qmcpack</span><span class="o">+</span><span class="n">cuda</span><span class="o">%</span><span class="n">intel</span><span class="o">@</span><span class="mf">18.0</span><span class="o">.</span><span class="mi">3</span> <span class="n">cuda_arch</span><span class="o">=</span><span class="mi">61</span> <span class="o">^</span><span class="n">cuda</span><span class="o">@</span><span class="mf">10.0</span><span class="o">.</span><span class="mi">130</span> <span class="o">^</span><span class="n">intel</span><span class="o">-</span><span class="n">mkl</span>
</pre></div>
</div>
</div>
<div class="section" id="loading-qmcpack-into-your-environment">
<h3>Loading QMCPACK into your environment<a class="headerlink" href="#loading-qmcpack-into-your-environment" title="Permalink to this headline">¶</a></h3>
<p>If you already have modules set-up in your enviroment, the Spack
modules will be detected automatically. Otherwise, Spack will not
automatically find the additional packages. A few additional steps are
needed.  Please see the main Spack documentation for additional details: <a class="reference external" href="https://spack.readthedocs.io/en/latest/module_file_support.html">https://spack.readthedocs.io/en/latest/module_file_support.html</a>.</p>
</div>
<div class="section" id="dependencies-that-need-to-be-compiled-with-gcc">
<h3>Dependencies that need to be compiled with GCC<a class="headerlink" href="#dependencies-that-need-to-be-compiled-with-gcc" title="Permalink to this headline">¶</a></h3>
<p>Failing to compile a QMCPACK dependency is the most common reason that
a Spack build fails. We recommend that you compile the following
dependencies with GCC:</p>
<p>For MPI, using MPICH as the provider, try:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">your</span><span class="o">-</span><span class="n">laptop</span><span class="o">&gt;</span> <span class="n">spack</span> <span class="n">install</span> <span class="n">qmcpack</span><span class="o">%</span><span class="n">intel</span><span class="o">@</span><span class="mf">18.0</span><span class="o">.</span><span class="mi">3</span> <span class="o">^</span><span class="n">boost</span><span class="o">%</span><span class="n">gcc</span> <span class="o">^</span><span class="n">pkgconf</span><span class="o">%</span><span class="n">gcc</span> <span class="o">^</span><span class="n">perl</span><span class="o">%</span><span class="n">gcc</span> <span class="o">^</span><span class="n">libpciaccess</span><span class="o">%</span><span class="n">gcc</span> <span class="o">^</span><span class="n">cmake</span><span class="o">%</span><span class="n">gcc</span> <span class="o">^</span><span class="n">findutils</span><span class="o">%</span><span class="n">gcc</span> <span class="o">^</span><span class="n">m4</span><span class="o">%</span><span class="n">gcc</span>
</pre></div>
</div>
<p>For serial,</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">your</span><span class="o">-</span><span class="n">laptop</span><span class="o">&gt;</span> <span class="n">spack</span> <span class="n">install</span> <span class="n">qmcpack</span><span class="o">~</span><span class="n">mpi</span><span class="o">%</span><span class="n">intel</span><span class="o">@</span><span class="mf">18.0</span><span class="o">.</span><span class="mi">3</span> <span class="o">^</span><span class="n">boost</span><span class="o">%</span><span class="n">gcc</span> <span class="o">^</span><span class="n">pkgconf</span><span class="o">%</span><span class="n">gcc</span> <span class="o">^</span><span class="n">perl</span><span class="o">%</span><span class="n">gcc</span> <span class="o">^</span><span class="n">cmake</span><span class="o">%</span><span class="n">gcc</span>
</pre></div>
</div>
</div>
<div class="section" id="installing-qmcpack-with-spack-on-linux">
<h3>Installing QMCPACK with Spack on Linux<a class="headerlink" href="#installing-qmcpack-with-spack-on-linux" title="Permalink to this headline">¶</a></h3>
<p>Spack works robustly on the standard flavors of Linux (Ubuntu, CentOS,
Ubuntu, etc.) using GCC, Clang, PGI, and Intel compilers.</p>
</div>
<div class="section" id="installing-qmcpack-with-spack-on-mac-os-x">
<h3>Installing QMCPACK with Spack on Mac OS X<a class="headerlink" href="#installing-qmcpack-with-spack-on-mac-os-x" title="Permalink to this headline">¶</a></h3>
<p>Spack works on Mac OS X but requires installation of a few packages
using Homebrew. You will need to install at minimum the GCC compilers,
CMake, and pkg-config. The Intel compiler for Mac on OS X is not well
supported by Spack packages and will most likely lead to a compile
time failure in one of QMCPACK’s dependencies.</p>
</div>
<div class="section" id="installing-qmcpack-with-spack-on-cray-supercomputers">
<h3>Installing QMCPACK with Spack on Cray Supercomputers<a class="headerlink" href="#installing-qmcpack-with-spack-on-cray-supercomputers" title="Permalink to this headline">¶</a></h3>
<p>Spack now works with the Cray environment. To leverage the installed
Cray environment, both a <code class="docutils literal notranslate"><span class="pre">compilers.yaml</span></code> and
<code class="docutils literal notranslate"><span class="pre">packages.yaml</span></code> file should be provided by the supercomputing
facility. Additionally, Spack packages compiled by the facility can be
reused by chaining Spack installations
<a class="reference external" href="https://spack.readthedocs.io/en/latest/chain.html">https://spack.readthedocs.io/en/latest/chain.html</a>.</p>
<p>Instructions for DOE supercomputing facilities that support Spack directly will be forthcoming.</p>
</div>
<div class="section" id="installing-quantum-espresso-with-spack">
<h3>Installing Quantum-Espresso with Spack<a class="headerlink" href="#installing-quantum-espresso-with-spack" title="Permalink to this headline">¶</a></h3>
<p>More information about the QE Spack package can be obtained directly
from Spack</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">spack</span> <span class="n">info</span> <span class="n">quantum</span><span class="o">-</span><span class="n">espresso</span>
</pre></div>
</div>
<p>There are many variants available for QE, most, but not all, are
compatible with QMCPACK patch. Here is a minimalistic example of the
Spack installation command that needs to be invoked:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">your</span><span class="o">-</span><span class="n">laptop</span><span class="o">&gt;</span> <span class="n">spack</span> <span class="n">install</span> <span class="n">quantum</span><span class="o">-</span><span class="n">espresso</span><span class="o">+</span><span class="n">qmcpack</span><span class="o">~</span><span class="n">patch</span><span class="o">@</span><span class="mf">6.4</span><span class="o">.</span><span class="mi">1</span><span class="o">%</span><span class="n">gcc</span> <span class="n">hdf5</span><span class="o">=</span><span class="n">parallel</span>
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">~</span></code> decorator means deactivate the <code class="docutils literal notranslate"><span class="pre">patch</span></code>
variant. This refers not to the QMCPACK patch, but to the upstream
patching that is present for some versions of QE. These upstream QE
patches fix specific critical autoconf/configure fixes. Unfortunately,
some of these QE upstream patches are incompatible with the QMCPACK
patch. Note that the Spack package will prevent you from installing
incompatible variants and will emit an error message explaining the
nature of the incompatibility.</p>
<p>A serial (no MPI) installation is also available, but the Spack installation command
is non-intuitive for Spack newcomers:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">your</span><span class="o">-</span><span class="n">laptop</span><span class="o">&gt;</span> <span class="n">spack</span> <span class="n">install</span> <span class="n">quantum</span><span class="o">-</span><span class="n">espresso</span><span class="o">+</span><span class="n">qmcpack</span><span class="o">~</span><span class="n">patch</span><span class="o">~</span><span class="n">mpi</span><span class="o">~</span><span class="n">scalapack</span><span class="o">@</span><span class="mf">6.4</span><span class="o">.</span><span class="mi">1</span><span class="o">%</span><span class="n">gcc</span> <span class="n">hdf5</span><span class="o">=</span><span class="n">serial</span>
</pre></div>
</div>
<p>QE Spack package is well tested with GCC and Intel compilers, but will not work
with the PGI compiler or in a cross-compile environment.</p>
</div>
<div class="section" id="reporting-bugs">
<h3>Reporting Bugs<a class="headerlink" href="#reporting-bugs" title="Permalink to this headline">¶</a></h3>
<p>Bugs with the QMCPACK Spack package should be filed at the main GitHub
Spack repo <a class="reference external" href="https://github.com/spack/spack/issues">https://github.com/spack/spack/issues</a>.</p>
<p>In the GitHub issue, include <code class="docutils literal notranslate"><span class="pre">&#64;naromero77</span></code> to get the attention
of our developer.</p>
</div>
</div>
<div class="section" id="testing-and-validation-of-qmcpack">
<span id="testing"></span><h2>Testing and validation of QMCPACK<a class="headerlink" href="#testing-and-validation-of-qmcpack" title="Permalink to this headline">¶</a></h2>
<p>We <strong>strongly encourage</strong> running the included tests each time
QMCPACK is built. A range of unit and integration tests ensure that
the code behaves as expected and that results are consistent with
known-good mean-field, quantum chemical, and historical QMC results.</p>
<p>The tests include the following:</p>
<ul class="simple">
<li><p>Unit tests: to check fundamental behavior. These should always pass.</p></li>
<li><p>Stochastic integration tests: to check computed results from
the Monte Carlo methods. These might fail statistically, but rarely
because of the use of three sigma level statistics. These tests are
further split into “short” tests, which have just sufficient
length to have valid statistics, and “long” tests, to check
behavior to higher statistical accuracy.</p></li>
<li><p>Converter tests: to check conversion of trial wavefunctions
from codes such as QE and GAMESS to QMCPACK’s
formats. These should always pass.</p></li>
<li><p>Workflow tests: in the case of QE, we test the
entire cycle of DFT calculation, trial wavefunction conversion, and
a subsequent VMC run.</p></li>
<li><p>Performance: to help performance monitoring. Only the timing of
these runs is relevant.</p></li>
</ul>
<p>The test types are differentiated by prefixes in their names, for example, <code class="docutils literal notranslate"><span class="pre">short-LiH_dimer_ae_vmc_hf_noj_16-1</span></code> indicates a short VMC test
for the LiH dime.</p>
<p>QMCPACK also includes tests for developmental features and features
that are unsupported on certain platforms. To indicate these, tests
that are unstable are labeled with the CTest label
“unstable.” For example, they are unreliable, unsupported, or known to fail
from partial implementation or bugs.</p>
<p>When installing QMCPACK you should run at least the unit tests:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ctest</span> <span class="o">-</span><span class="n">R</span> <span class="n">unit</span>
</pre></div>
</div>
<p>These tests take only a few seconds to run. All should pass. A
failure here could indicate a major problem with the installation.</p>
<p>A wider range of deterministic integration
tests are being developed. The goal is to test much more of QMCPACK than the unit tests
do and to do so in a manner that is reproducible
across platforms. All of these should eventually pass 100% reliably
and quickly. At present, some fail on some platforms and for certain
build types.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ctest</span> <span class="o">-</span><span class="n">R</span> <span class="n">deterministic</span> <span class="o">-</span><span class="n">LE</span> <span class="n">unstable</span>
</pre></div>
</div>
<p>If time allows, the “short” stochastic tests should also be run.
The short tests take a few minutes each on a 16-core machine—about 1 hour total depending on the platform. You can run these tests using the following command in the
build directory:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ctest</span> <span class="o">-</span><span class="n">R</span> <span class="n">short</span> <span class="o">-</span><span class="n">LE</span> <span class="n">unstable</span>  <span class="c1"># Run the tests with &quot;short&quot; in their name.</span>
                             <span class="c1"># Exclude any known unstable tests.</span>
</pre></div>
</div>
<p>The output should be similar to the following:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Test</span> <span class="n">project</span> <span class="n">build_gcc</span>
    <span class="n">Start</span>  <span class="mi">1</span><span class="p">:</span> <span class="n">short</span><span class="o">-</span><span class="n">LiH_dimer_ae</span><span class="o">-</span><span class="n">vmc_hf_noj</span><span class="o">-</span><span class="mi">16</span><span class="o">-</span><span class="mi">1</span>
<span class="mi">1</span><span class="o">/</span><span class="mi">44</span> <span class="n">Test</span>  <span class="c1">#1: short-LiH_dimer_ae-vmc_hf_noj-16-1 ..............  Passed   11.20 sec</span>
    <span class="n">Start</span>  <span class="mi">2</span><span class="p">:</span> <span class="n">short</span><span class="o">-</span><span class="n">LiH_dimer_ae</span><span class="o">-</span><span class="n">vmc_hf_noj</span><span class="o">-</span><span class="mi">16</span><span class="o">-</span><span class="mi">1</span><span class="o">-</span><span class="n">kinetic</span>
<span class="mi">2</span><span class="o">/</span><span class="mi">44</span> <span class="n">Test</span>  <span class="c1">#2: short-LiH_dimer_ae-vmc_hf_noj-16-1-kinetic ......  Passed    0.13 sec</span>
<span class="o">..</span>
<span class="mi">42</span><span class="o">/</span><span class="mi">44</span> <span class="n">Test</span> <span class="c1">#42: short-monoO_1x1x1_pp-vmc_sdj-1-16 ...............  Passed   10.02 sec</span>
    <span class="n">Start</span> <span class="mi">43</span><span class="p">:</span> <span class="n">short</span><span class="o">-</span><span class="n">monoO_1x1x1_pp</span><span class="o">-</span><span class="n">vmc_sdj</span><span class="o">-</span><span class="mi">1</span><span class="o">-</span><span class="mi">16</span><span class="o">-</span><span class="n">totenergy</span>
<span class="mi">43</span><span class="o">/</span><span class="mi">44</span> <span class="n">Test</span> <span class="c1">#43: short-monoO_1x1x1_pp-vmc_sdj-1-16-totenergy .....  Passed    0.08 sec</span>
    <span class="n">Start</span> <span class="mi">44</span><span class="p">:</span> <span class="n">short</span><span class="o">-</span><span class="n">monoO_1x1x1_pp</span><span class="o">-</span><span class="n">vmc_sdj</span><span class="o">-</span><span class="mi">1</span><span class="o">-</span><span class="mi">16</span><span class="o">-</span><span class="n">samples</span>
<span class="mi">44</span><span class="o">/</span><span class="mi">44</span> <span class="n">Test</span> <span class="c1">#44: short-monoO_1x1x1_pp-vmc_sdj-1-16-samples .......  Passed    0.08 sec</span>

<span class="mi">100</span><span class="o">%</span> <span class="n">tests</span> <span class="n">passed</span><span class="p">,</span> <span class="mi">0</span> <span class="n">tests</span> <span class="n">failed</span> <span class="n">out</span> <span class="n">of</span> <span class="mi">44</span>

<span class="n">Total</span> <span class="n">Test</span> <span class="n">time</span> <span class="p">(</span><span class="n">real</span><span class="p">)</span> <span class="o">=</span> <span class="mf">167.14</span> <span class="n">sec</span>
</pre></div>
</div>
<p>Note that the number of tests run varies between the
standard, complex, and GPU compilations. These tests should pass with three sigma reliability. That is, they should nearly always pass, and when rerunning a failed test it should usually pass. Overly frequent failures suggest a problem that should be addressed before any scientific production.</p>
<p>The  full set of tests consist of significantly longer versions of the short
tests, as well as tests of the conversion utilities. The runs require
several hours each for improved statistics and a much more
stringent test of the code. To run all the tests, simply run CTest in the build
directory:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ctest</span> <span class="o">-</span><span class="n">LE</span> <span class="n">unstable</span>           <span class="c1"># Run all the stable tests. This will take several hours.</span>
</pre></div>
</div>
<p>You can also run verbose tests, which direct the QMCPACK
output to the standard output:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ctest</span> <span class="o">-</span><span class="n">V</span> <span class="o">-</span><span class="n">R</span> <span class="n">short</span>   <span class="c1"># Verbose short tests</span>
</pre></div>
</div>
<p>The test system includes specific tests for the complex version of the code.</p>
<p>The input data files for the tests are located in the <code class="docutils literal notranslate"><span class="pre">tests</span></code> directory.
The system-level test directories are grouped into <code class="docutils literal notranslate"><span class="pre">heg</span></code>, <code class="docutils literal notranslate"><span class="pre">molecules</span></code>, and <code class="docutils literal notranslate"><span class="pre">solids</span></code>, with particular physical systems under each (for example <code class="docutils literal notranslate"><span class="pre">molecules/H4_ae</span></code> <a class="footnote-reference brackets" href="#f1" id="id7">1</a> ).
Under each physical system directory there might be tests for multiple QMC methods or parameter variations.
The numerical comparisons and test definitions are in the <code class="docutils literal notranslate"><span class="pre">CMakeLists.txt</span></code> file in each physical system directory.</p>
<p>If <em>all</em> the QMC tests fail it is likely
that the appropriate mpiexec (or mpirun, aprun, srun, jsrun) is not being
called or found. If the QMC runs appear to work but all the other
tests fail, it is possible that Python is not working on your system. We suggest checking some of the test console output in <code class="docutils literal notranslate"><span class="pre">build/Testing/Temporary/LastTest.log</span></code>
or the output files under <code class="docutils literal notranslate"><span class="pre">build/tests/</span></code>.</p>
<p>Note that because most of the tests are very small, consisting of only a few
electrons, the performance is not representative of larger
calculations. For example, although the calculations might fit in cache,
there will be essentially no vectorization because of the small electron
counts. <strong>These tests should therefore not be used for any benchmarking or
performance analysis</strong>. Example runs that can be used for testing performance are described in
<span class="xref std std-ref">perftests</span>.</p>
<div class="section" id="deterministic-and-unit-tests">
<h3>Deterministic and unit tests<a class="headerlink" href="#deterministic-and-unit-tests" title="Permalink to this headline">¶</a></h3>
<p>QMCPACK has a set of deterministic tests, predominantly unit tests.
All of these tests can be run with the following command (in the build directory):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ctest</span> <span class="o">-</span><span class="n">R</span> <span class="n">deterministic</span> <span class="o">-</span><span class="n">LE</span> <span class="n">unstable</span>
</pre></div>
</div>
<p>These tests should always pass. Failure could indicate a major problem
with the compiler, compiler settings, or a linked library that would
give incorrect results.</p>
<p>The output should look similar to the following:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Test</span> <span class="n">project</span> <span class="n">qmcpack</span><span class="o">/</span><span class="n">build</span>
    <span class="n">Start</span>  <span class="mi">1</span><span class="p">:</span> <span class="n">unit_test_numerics</span>
<span class="mi">1</span><span class="o">/</span><span class="mi">11</span> <span class="n">Test</span>  <span class="c1">#1: unit_test_numerics ...............   Passed    0.06 sec</span>
    <span class="n">Start</span>  <span class="mi">2</span><span class="p">:</span> <span class="n">unit_test_utilities</span>
<span class="mi">2</span><span class="o">/</span><span class="mi">11</span> <span class="n">Test</span>  <span class="c1">#2: unit_test_utilities ..............   Passed    0.02 sec</span>
    <span class="n">Start</span>  <span class="mi">3</span><span class="p">:</span> <span class="n">unit_test_einspline</span>
<span class="o">...</span>
<span class="mi">10</span><span class="o">/</span><span class="mi">11</span> <span class="n">Test</span> <span class="c1">#10: unit_test_hamiltonian ............   Passed    1.88 sec</span>
    <span class="n">Start</span> <span class="mi">11</span><span class="p">:</span> <span class="n">unit_test_drivers</span>
<span class="mi">11</span><span class="o">/</span><span class="mi">11</span> <span class="n">Test</span> <span class="c1">#11: unit_test_drivers ................   Passed    0.01 sec</span>

<span class="mi">100</span><span class="o">%</span> <span class="n">tests</span> <span class="n">passed</span><span class="p">,</span> <span class="mi">0</span> <span class="n">tests</span> <span class="n">failed</span> <span class="n">out</span> <span class="n">of</span> <span class="mi">11</span>

<span class="n">Label</span> <span class="n">Time</span> <span class="n">Summary</span><span class="p">:</span>
<span class="n">unit</span>    <span class="o">=</span>   <span class="mf">2.20</span> <span class="n">sec</span>

<span class="n">Total</span> <span class="n">Test</span> <span class="n">time</span> <span class="p">(</span><span class="n">real</span><span class="p">)</span> <span class="o">=</span>   <span class="mf">2.31</span> <span class="n">sec</span>
</pre></div>
</div>
<p>Individual unit test executables can be found in <code class="docutils literal notranslate"><span class="pre">build/tests/bin</span></code>.
The source for the unit tests is located in the <code class="docutils literal notranslate"><span class="pre">tests</span></code> directory under each directory in <code class="docutils literal notranslate"><span class="pre">src</span></code> (e.g. <code class="docutils literal notranslate"><span class="pre">src/QMCWavefunctions/tests</span></code>).</p>
<p>See <span class="xref std std-ref">unit_testing</span> for more details about unit tests.</p>
</div>
<div class="section" id="integration-tests-with-quantum-espresso">
<span id="integtestqe"></span><h3>Integration tests with Quantum Espresso<a class="headerlink" href="#integration-tests-with-quantum-espresso" title="Permalink to this headline">¶</a></h3>
<p>As described in <a class="reference internal" href="#buildqe"><span class="std std-ref">Installing and patching Quantum ESPRESSO</span></a>, it is possible to test entire
workflows of trial wavefunction generation, conversion, and eventual
QMC calculation. A patched QE must be installed so that the
pw2qmcpack converter is available.</p>
<p>By adding <code class="docutils literal notranslate"><span class="pre">-D</span> <span class="pre">QE_BIN=your_QE_binary_path</span></code> in the CMake command line when building your QMCPACK,
tests named with the “qe-” prefix will be included in the test set of your build.
You can test the whole <code class="docutils literal notranslate"><span class="pre">pw</span> <span class="pre">&gt;</span> <span class="pre">pw2qmcpack</span> <span class="pre">&gt;</span> <span class="pre">qmcpack</span></code> workflow by</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ctest</span> <span class="o">-</span><span class="n">R</span> <span class="n">qe</span>
</pre></div>
</div>
<p>This provides a very solid test of the entire QMC
toolchain for plane wave–generated wavefunctions.</p>
</div>
<div class="section" id="performance-tests">
<h3>Performance tests<a class="headerlink" href="#performance-tests" title="Permalink to this headline">¶</a></h3>
<p>Performance tests representative of real research runs are included in the
tests/performance directory. They can be used for benchmarking, comparing machine
performance, or assessing optimizations. This is in
contrast to the majority of the conventional integration tests in which the particle
counts are too small to be representative. Care is still needed to
remove initialization, I/O, and compute a representative performance
measure.</p>
<p>The CTest integration is sufficient to run the benchmarks and measure
relative performance from version to version of QMCPACK and to assess
proposed code changes. Performance tests are prefixed with
“performance.” To obtain the highest performance on a particular
platform, you must run the benchmarks in a standalone manner and tune
thread counts, placement, walker count (etc.). This is essential to
fairly compare different machines. Check with the
developers if you are unsure of what is a fair change.</p>
<p>For the largest problem sizes, the initialization of spline orbitals might
take a large portion of overall runtime. When QMCPACK is run at scale,
the initialization is fast because it is fully
parallelized. However, the performance tests usually run on a single node.
Consider running QMCPACK once with <code class="docutils literal notranslate"><span class="pre">save_coefs=&quot;yes&quot;</span></code> XML input tag
added to the line of ‘determinantset’ to save the converted spline
coefficients to the disk and load them for later runs in the same folder.
See <span class="xref std std-ref">spo_spline</span> for more information.</p>
<p>The delayed update algorithm in <span class="xref std std-ref">singledeterminant</span>
significantly changes the performance characteristics of QMCPACK.  A
parameter scan of the maximal number of delays specific to every
architecture and problem size is required to achieve the best
performance.</p>
<div class="section" id="nio-performance-tests">
<h4>NiO performance tests<a class="headerlink" href="#nio-performance-tests" title="Permalink to this headline">¶</a></h4>
<p>Follow the instructions in tests/performance/NiO/README to
enable and run the NiO tests.</p>
<p>The NiO tests are for bulk supercells of varying size. The QMC runs consist of short blocks of (1) VMC
without drift (2) VMC with drift term included, and (3) DMC with
constant population. The tests use spline wavefunctions that must be
downloaded as described in the README file because of their large size. You
will need to set <code class="docutils literal notranslate"><span class="pre">-DQMC_DATA=YOUR_DATA_FOLDER</span> <span class="pre">-DENABLE_TIMERS=1</span></code>
when running CMake as
described in the README file.</p>
<p>Two sets of wavefunction are tested: spline orbitals with one- and
two-body Jastrow functions and a more complex form with an additional
three-body Jastrow function. The Jastrows are the same for each run
and are not reoptimized, as might be done for research purposes.  Runs
in the hundreds of electrons up to low thousands of electrons are representative of
research runs performed in 2017. The largest runs target
future machines and require very large memory.</p>
<table class="docutils align-default" id="id8">
<caption><span class="caption-number">Table 1 </span><span class="caption-text">System sizes and names for NiO performance tests. GPU performance
  tests are named similarly but have different walker counts.</span><a class="headerlink" href="#id8" title="Permalink to this table">¶</a></caption>
<colgroup>
<col style="width: 39%" />
<col style="width: 21%" />
<col style="width: 8%" />
<col style="width: 14%" />
<col style="width: 18%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Performance test name</p></th>
<th class="head"><p>Historical name</p></th>
<th class="head"><p>Atoms</p></th>
<th class="head"><p>Electrons</p></th>
<th class="head"><p>Electrons/spin</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>performance-NiO-cpu-a32-e384</p></td>
<td><p>S8</p></td>
<td><p>32</p></td>
<td><p>384</p></td>
<td><p>192</p></td>
</tr>
<tr class="row-odd"><td><p>performance-NiO-cpu-a64-e768</p></td>
<td><p>S16</p></td>
<td><p>64</p></td>
<td><p>768</p></td>
<td><p>384</p></td>
</tr>
<tr class="row-even"><td><p>performance-NiO-cpu-a128-e1536</p></td>
<td><p>S32</p></td>
<td><p>128</p></td>
<td><p>1536</p></td>
<td><p>768</p></td>
</tr>
<tr class="row-odd"><td><p>performance-NiO-cpu-a256-e3072</p></td>
<td><p>S64</p></td>
<td><p>256</p></td>
<td><p>3072</p></td>
<td><p>1536</p></td>
</tr>
<tr class="row-even"><td><p>performance-NiO-cpu-a512-e6144</p></td>
<td><p>S128</p></td>
<td><p>512</p></td>
<td><p>6144</p></td>
<td><p>3072</p></td>
</tr>
<tr class="row-odd"><td><p>performance-NiO-cpu-a1024-e12288</p></td>
<td><p>S256</p></td>
<td><p>1024</p></td>
<td><p>12288</p></td>
<td><p>6144</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="troubleshooting-tests">
<h3>Troubleshooting tests<a class="headerlink" href="#troubleshooting-tests" title="Permalink to this headline">¶</a></h3>
<p>CTest reports briefly pass or fail of tests in printout and also collects all the standard outputs to help investigating how tests fail.
If the CTest execution is completed, look at <code class="docutils literal notranslate"><span class="pre">Testing/Temporary/LastTest.log</span></code>.
If you manually stop the testing (ctrl+c), look at <code class="docutils literal notranslate"><span class="pre">Testing/Temporary/LastTest.log.tmp</span></code>.
You can locate the failing tests by searching for the key word “Fail.”</p>
</div>
<div class="section" id="slow-testing-with-openmpi">
<h3>Slow testing with OpenMPI<a class="headerlink" href="#slow-testing-with-openmpi" title="Permalink to this headline">¶</a></h3>
<p>OpenMPI has a default binding policy that makes all the threads run on a single core during testing when there are two or fewer MPI ranks.
This significantly increases testing time. If you are authorized to change the default setting, you can just add “hwloc_base_binding_policy=none” in /etc/openmpi/openmpi-mca-params.conf.</p>
</div>
</div>
<div class="section" id="automated-testing-of-qmcpack">
<h2>Automated testing of QMCPACK<a class="headerlink" href="#automated-testing-of-qmcpack" title="Permalink to this headline">¶</a></h2>
<p>The QMCPACK developers run automatic tests of QMCPACK on several
different computer systems,  many on a continuous basis. See the reports at
<a class="reference external" href="https://cdash.qmcpack.org/CDash/index.php?project=QMCPACK">https://cdash.qmcpack.org/CDash/index.php?project=QMCPACK</a>.
The combinations that are currently tested can be seen on CDash and are also listed in
<a class="reference external" href="https://github.com/QMCPACK/qmcpack/blob/develop/README.md">https://github.com/QMCPACK/qmcpack/blob/develop/README.md</a>. They include GCC, Clang, Intel, and PGI compilers in combinations
with various library versions and different MPI implementations. NVIDIA GPUs are also tested.</p>
</div>
<div class="section" id="building-ppconvert-a-pseudopotential-format-converter">
<span id="buildppconvert"></span><h2>Building ppconvert, a pseudopotential format converter<a class="headerlink" href="#building-ppconvert-a-pseudopotential-format-converter" title="Permalink to this headline">¶</a></h2>
<p>QMCPACK includes a utility—ppconvert—to convert between different
pseudopotential formats. Examples include effective core potential
formats (in Gaussians), the UPF format used by QE, and
the XML format used by QMCPACK itself. The utility also enables the
atomic orbitals to be recomputed via a numerical density functional
calculation if they need to be reconstructed for use in an
electronic structure calculation.</p>
<div class="figure align-center" id="id9">
<a class="reference internal image-reference" href="_images/QMCPACK_CDash_CTest_Results_20160129.png"><img alt="_images/QMCPACK_CDash_CTest_Results_20160129.png" src="_images/QMCPACK_CDash_CTest_Results_20160129.png" style="width: 80%;" /></a>
<p class="caption"><span class="caption-number">Fig. 2 </span><span class="caption-text">Example test results for QMCPACK showing data for a
workstation (Intel, GCC, both CPU and GPU builds) and for two ORNL
supercomputers. In this example, four errors were found. This
dashboard is accessible at <a class="reference external" href="https://cdash.qmcpack.org">https://cdash.qmcpack.org</a></span><a class="headerlink" href="#id9" title="Permalink to this image">¶</a></p>
</div>
</div>
<div class="section" id="installing-and-patching-quantum-espresso">
<span id="buildqe"></span><h2>Installing and patching Quantum ESPRESSO<a class="headerlink" href="#installing-and-patching-quantum-espresso" title="Permalink to this headline">¶</a></h2>
<p>For trial wavefunctions obtained in a plane-wave basis, we mainly
support QE. Note that ABINIT and QBox were supported historically
and could be reactivated.</p>
<p>QE stores wavefunctions in a nonstandard internal
“save” format. To convert these to a conventional HDF5 format file
we have developed a converter—pw2qmcpack—which is an add-on to the
QE distribution.</p>
<p>To simplify the process of patching QE we have developed
a script that will automatically download and patch the source
code. The patches are specific to each version. For example, to download and
patch QE v6.3:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">cd</span> <span class="n">external_codes</span><span class="o">/</span><span class="n">quantum_espresso</span>
<span class="o">./</span><span class="n">download_and_patch_qe6</span><span class="o">.</span><span class="mf">3.</span><span class="n">sh</span>
</pre></div>
</div>
<p>After running the patch, you must configure QE with
the HDF5 capability enabled in either way:</p>
<ul class="simple">
<li><p>If your system already has HDF5 installed with Fortran, use the -{}-with-hdf5 configuration option.</p></li>
</ul>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">cd</span> <span class="n">qe</span><span class="o">-</span><span class="mf">6.3</span>
<span class="o">./</span><span class="n">configure</span> <span class="o">--</span><span class="k">with</span><span class="o">-</span><span class="n">hdf5</span><span class="o">=/</span><span class="n">opt</span><span class="o">/</span><span class="n">local</span>   <span class="c1"># Specify HDF5 base directory</span>
</pre></div>
</div>
<p><strong>Check</strong> the end of the configure output if HDF5 libraries are found properly.
If not, either install a complete library or use the other scheme. If using a parallel HDF5 library, be sure to use
the same MPI with QE as used to build the parallel HDF5 library.</p>
<p>Currently, HDF5 support in QE itself is preliminary. To enable use of pw2qmcpack
but use the old non-HDF5 I/O within QE, replace <code class="docutils literal notranslate"><span class="pre">-D__HDF5</span></code> with <code class="docutils literal notranslate"><span class="pre">{-D__HDF5_C}</span></code> in make.inc.</p>
</div></blockquote>
<ul class="simple">
<li><p>If your system has HDF5 with C only, manually edit make.inc by adding <code class="docutils literal notranslate"><span class="pre">-D__HDF5_C</span></code> and <code class="docutils literal notranslate"><span class="pre">-DH5_USE_16_API</span></code>
in <code class="docutils literal notranslate"><span class="pre">DFLAGS</span></code> and provide include and library path in <code class="docutils literal notranslate"><span class="pre">IFLAGS</span></code> and <code class="docutils literal notranslate"><span class="pre">HDF5_LIB</span></code>.</p></li>
</ul>
<p>The complete process is described in external_codes/quantum_espresso/README.</p>
<p>The tests involving pw.x and pw2qmcpack.x have been integrated into the test suite of QMCPACK.
By adding <code class="docutils literal notranslate"><span class="pre">-D</span> <span class="pre">QE_BIN=your_QE_binary_path</span></code> in the CMake command line when building your QMCPACK,
tests named with the “qe-” prefix will be included in the test set of your build.
You can test the whole <code class="docutils literal notranslate"><span class="pre">pw</span> <span class="pre">&gt;</span> <span class="pre">pw2qmcpack</span> <span class="pre">&gt;</span> <span class="pre">qmcpack</span> <span class="pre">workflow</span></code> by</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ctest</span> <span class="o">-</span><span class="n">R</span> <span class="n">qe</span>
</pre></div>
</div>
<p>See <a class="reference internal" href="#integtestqe"><span class="std std-ref">Integration tests with Quantum Espresso</span></a> and the testing section for more details.</p>
</div>
<div class="section" id="how-to-build-the-fastest-executable-version-of-qmcpack">
<span id="buildperformance"></span><h2>How to build the fastest executable version of QMCPACK<a class="headerlink" href="#how-to-build-the-fastest-executable-version-of-qmcpack" title="Permalink to this headline">¶</a></h2>
<p>To build the fastest version of QMCPACK we recommend the following:</p>
<ul class="simple">
<li><p>Use the latest C++ compilers available for your
system. Substantial gains have been made optimizing C++ in recent
years.</p></li>
<li><p>Use a vendor-optimized BLAS library such as Intel MKL and AMD ACML. Although
QMC does not make extensive use of linear algebra, it is used in the
VMC wavefunction optimizer to apply the orbital coefficients in local basis
calculations and in the Slater determinant update.</p></li>
<li><p>Use a vector math library such as Intel VML.  For periodic
calculations, the calculation of the structure factor and Ewald
potential benefit from vectorized evaluation of sin and
cos. Currently we only autodetect Intel VML, as provided with MKL,
but support for MASSV and AMD LibM is included via #defines. See,
for example, src/Numerics/e2iphi.h. For
large supercells, this optimization can gain 10% in performance.</p></li>
</ul>
<p>Note that greater speedups of QMC calculations can usually be obtained by
carefully choosing the required statistics for each
investigation. That is, do not compute smaller error bars than necessary.</p>
</div>
<div class="section" id="troubleshooting-the-installation">
<span id="troubleshoot"></span><h2>Troubleshooting the installation<a class="headerlink" href="#troubleshooting-the-installation" title="Permalink to this headline">¶</a></h2>
<p>Some tips to help troubleshoot installations of QMCPACK:</p>
<ul>
<li><p>First, build QMCPACK on a workstation you control or on any
system with a simple and up-to-date set of development
tools. You can compare the results of CMake and QMCPACK on this
system with any more difficult systems you encounter.</p></li>
<li><p>Use up-to-date development software, particularly a recent
CMake.</p></li>
<li><p>Verify that the compilers and libraries you expect are
being configured. It is common to have multiple versions
installed. The configure system will stop at the first version it
finds, which might not be the most recent. If this occurs, directly specify the appropriate
directories and files (<a class="reference internal" href="#cmakeoptions"><span class="std std-ref">Configuration Options</span></a>). For example,</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">cmake</span> <span class="o">-</span><span class="n">DCMAKE_C_COMPILER</span><span class="o">=/</span><span class="n">full</span><span class="o">/</span><span class="n">path</span><span class="o">/</span><span class="n">to</span><span class="o">/</span><span class="n">mpicc</span> <span class="o">-</span><span class="n">DCMAKE_CXX_COMPILER</span><span class="o">=/</span><span class="n">full</span><span class="o">/</span><span class="n">path</span><span class="o">/</span><span class="n">to</span><span class="o">/</span><span class="n">mpicxx</span> <span class="o">..</span>
</pre></div>
</div>
</li>
<li><p>To monitor the compiler and linker settings, use a verbose build, <code class="docutils literal notranslate"><span class="pre">make</span>
<span class="pre">VERBOSE=1</span></code>. If an individual source file fails to compile you
can experiment by hand using the output of the verbose build to
reconstruct the full compilation line.</p></li>
</ul>
<p>If you still have problems please post to the QMCPACK Google group with full
details, or contact a developer.</p>
<p class="rubric">Footnotes</p>
<dl class="footnote brackets">
<dt class="label" id="f1"><span class="brackets"><a class="fn-backref" href="#id7">1</a></span></dt>
<dd><p>The suffix “ae” is short for “all-electron,” and “pp” is short for “pseudopotential.”</p>
</dd>
</dl>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="simulationcell.html" class="btn btn-neutral float-right" title="Specifying the Simulation Cell" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="features.html" class="btn btn-neutral float-left" title="Features of QMCPACK" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2020, John Batson

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>