//////////////////////////////////////////////////////////////////////////////////////
// This file is distributed under the University of Illinois/NCSA Open Source License.
// See LICENSE file in top directory for details.
//
// Copyright (c) 2024 QMCPACK developers.
//
// File developed by: Peter Doak, doakpw@ornl.gov, Oak Ridge National Lab
//
// File created by: Peter Doak, doakpw@ornl.gov, Oak Ridge National Lab
//////////////////////////////////////////////////////////////////////////////////////

#include "catch.hpp"

#include "StructureFactorEstimator.h"
#include "ValidStructureFactorInput.h"
#include "Particle/tests/MinimalParticlePool.h"
#include "QMCWaveFunctions/tests/MinimalWaveFunctionPool.h"
#include "RandomForTest.h"
#include "GenerateRandomParticleSets.h"
#include "Utilities/ProjectData.h"
#include "Utilities/for_testing/NativeInitializerPrint.hpp"
#include <iostream>

namespace qmcplusplus
{

constexpr bool generate_test_data = false;

namespace testing
{
class StructureFactorAccess
{
  using Real = StructureFactorEstimator::Real;

public:
  const Vector<Real>& getSKElecElec(const StructureFactorEstimator& sfe) const { return sfe.getSKElecElec(); }
  const Vector<std::complex<Real>>& getRhoKElec(const StructureFactorEstimator& sfe) const { return sfe.getRhoKElec(); }
};
} // namespace testing

class StructureFactorTests
{
  using Real  = StructureFactorEstimator::Real;
  using Data  = Vector<Real>;
  using DataC = Vector<std::complex<Real>>;

public:
  static Data getSKElecElec();
  static DataC getRhoKElec();
};

TEST_CASE("StructureFactorEstimator::StructureFactorEstimator", "[estimators]")
{
  using Input = qmcplusplus::testing::ValidStructureFactorInput;
  Communicate* comm;
  comm = OHMMS::Controller;

  ParticleSetPool particle_pool{MinimalParticlePool::make_diamondC_1x1x1(comm)};

  ParticleSet pset_elec{*(particle_pool.getParticleSet("e"))};
  ParticleSet pset_ions{*(particle_pool.getParticleSet("ion"))};

  pset_elec.R =
      ParticleSet::ParticlePos{{1.451870349, 1.381521229, 1.165202269}, {1.244515371, 1.382273176, 1.21105285},
                               {0.000459944, 1.329603408, 1.265030556}, {0.748660329, 1.63420622, 1.393637791},
                               {0.033228526, 1.391869137, 0.654413566}, {1.114198787, 1.654334594, 0.231075822},
                               {1.657151589, 0.883870516, 1.201243939}, {0.97317591, 1.245644974, 0.284564732}};

  Libxml2Document doc;
  bool okay       = doc.parseFromString(Input::xml[Input::valid::SKALL]);
  xmlNodePtr node = doc.getRoot();
  UPtr<StructureFactorInput> sf_in;
  sf_in = std::make_unique<StructureFactorInput>(node);
  StructureFactorEstimator sfe(*sf_in, pset_ions, pset_elec);
}

TEST_CASE("StructureFactorEstimator::Accumulate", "[estimators]")
{
  using Input = qmcplusplus::testing::ValidStructureFactorInput;
  Communicate* comm;
  comm = OHMMS::Controller;

  Libxml2Document doc;
  bool okay       = doc.parseFromString(Input::xml[Input::valid::SKALL]);
  xmlNodePtr node = doc.getRoot();
  UPtr<StructureFactorInput> sf_in;
  sf_in = std::make_unique<StructureFactorInput>(node);

  ParticleSetPool particle_pool{MinimalParticlePool::make_diamondC_1x1x1(comm)};

  ParticleSet pset_elec{*(particle_pool.getParticleSet("e"))};
  ParticleSet pset_ions{*(particle_pool.getParticleSet("ion"))};

  StructureFactorEstimator sfe(*sf_in, pset_ions, pset_elec);

  std::vector<OperatorEstBase::MCPWalker> walkers;
  int nwalkers = 3;
  for (int iw = 0; iw < nwalkers; ++iw)
    walkers.emplace_back(8);

  std::vector<ParticleSet::ParticlePos> deterministic_rs = {
      {
          {0.5156778693, 0.9486072659, -1.174232483},
          {-0.3166678548, 1.376550555, 1.445290089},
          {1.960713625, 2.472656727, 1.051449418},
          {0.7458532453, 0.5551358461, 4.080774784},
          {-0.3515016139, -0.5192222595, 0.9941511154},
          {-0.8354426622, 0.7071638107, -0.3409843445},
          {0.4386044741, 1.237378716, 2.331874132},
          {2.125850677, 0.322106719, 0.5825730562},
      },
      {
          {-0.4633736908, 0.06318772584, -0.8580153584},
          {-1.1749264, -0.6276503801, 0.07458759099},
          {1.327618122, 2.085829258, 1.415749788},
          {0.9114726782, 0.1789183617, -0.08135545254},
          {-2.267908812, 0.8029287457, 0.9522812963},
          {1.50271523, -1.844935298, 0.2805620432},
          {3.168934584, 0.1348338127, 1.371092796},
          {0.8310229182, 1.070827127, 1.180167317},
      },
      {
          {-0.04847732186, -1.201739907, -1.700527787},
          {0.1589259505, -0.3096047044, -2.06662631},
          {2.2559762, 1.62913239, -0.8024448156},
          {2.5347929, 3.121092796, 1.609780669},
          {-0.2892376184, -0.1520225108, -2.727613688},
          {0.2477154732, 0.5039232969, 2.995702744},
          {3.679345131, 3.037770271, 2.808899403},
          {0.6418578625, 1.935944557, 1.515637875},
      },
  };
  std::vector<ParticleSet> psets =
      testing::generateRandomParticleSets(pset_elec, pset_ions, deterministic_rs, nwalkers, generate_test_data);

  auto ref_walkers = makeRefVector<OperatorEstBase::MCPWalker>(walkers);
  auto ref_psets   = makeRefVector<ParticleSet>(psets);

  ProjectData test_project("test", ProjectData::DriverVersion::BATCH);

  auto wavefunction_pool =
      MinimalWaveFunctionPool::make_diamondC_1x1x1(test_project.getRuntimeOptions(), comm, particle_pool);
  auto& spomap = wavefunction_pool.getWaveFunction("wavefunction")->getSPOMap();

  auto& trial_wavefunction = *(wavefunction_pool.getPrimary());
  std::vector<UPtr<TrialWaveFunction>> twfcs(nwalkers);
  for (int iw = 0; iw < nwalkers; ++iw)
    twfcs[iw] = trial_wavefunction.makeClone(psets[iw]);

  // These are just empty arguments to hang the accumulation test, StructureFactorEstimator never accesses into them.
  // In the application the estimator manager calls accumulate and all these vectors are really populated.
  std::vector<QMCHamiltonian> hams;
  auto ref_wfns = convertUPtrToRefVector(twfcs);
  auto ref_hams = makeRefVector<QMCHamiltonian>(hams);

  FakeRandom<OHMMS_PRECISION_FULL> rng;

  auto updateWalker = [](auto& walker, auto& pset_target, auto& trial_wavefunction) {
    pset_target.update(true);
    pset_target.donePbyP();
    trial_wavefunction.evaluateLog(pset_target);
    //pset_target.saveWalker(walker);
  };

  for (int iw = 0; iw < nwalkers; ++iw)
    updateWalker(walkers[iw], psets[iw], *(twfcs[iw]));

  using QMCT = OperatorEstBase::QMCT;
  std::vector<QMCT::RealType> rng_reals(nwalkers * QMCT::DIM * 2);
  testing::RandomForTest<QMCT::RealType> rft;
  rft.fillVecRng(rng_reals);
  auto it_rng_reals = rng_reals.begin();
  for (ParticleSet& pset : psets)
  {
    pset.R[0] = ParticleSet::PosType(*it_rng_reals++, *it_rng_reals++, *it_rng_reals++);
    pset.R[1] = ParticleSet::PosType(*it_rng_reals++, *it_rng_reals++, *it_rng_reals++);
  }
  for (int iw = 0; iw < nwalkers; ++iw)
    updateWalker(walkers[iw], psets[iw], *(twfcs[iw]));

  sfe.accumulate(ref_walkers, ref_psets, ref_wfns, ref_hams, rng);

  testing::StructureFactorAccess sfa;
  auto& sfk_e_e = sfa.getSKElecElec(sfe);
  auto& rhok_e  = sfa.getRhoKElec(sfe);

  if constexpr (generate_test_data)
  {
    std::cout << "sfk_e_e_exected = ";
    std::cout << NativePrint(sfk_e_e) << '\n';
    std::cout << "rhok_e_expected = ";
    std::cout << NativePrint(rhok_e) << '\n';
    FAIL_CHECK("Test always fails when generating new test reference data.");
  }
  auto sfk_e_e_expected = StructureFactorTests::getSKElecElec();
  auto rhok_e_expected  = StructureFactorTests::getRhoKElec();

  CHECK(sfk_e_e_expected == sfk_e_e);
  CHECK(rhok_e_expected == rhok_e);
}

typename StructureFactorTests::Data StructureFactorTests::getSKElecElec()
{
  Data sfk_e_e_exected = {
      19.73623085, 19.85599327, 13.72912788,  18.75673866, 18.75673866, 13.72912788,  19.85599327, 19.73623085,
      32.80349731, 43.77883148, 33.19361115,  33.19361115, 43.77883148, 32.80349731,  11.48587227, 46.64709091,
      13.93536186, 21.81977654, 16.97146797,  49.0378952,  49.0378952,  16.97146797,  21.81977654, 13.93536186,
      46.64709091, 11.48587227, 15.27185249,  15.26608276, 27.79554367, 34.7771225,   50.21757126, 48.46035004,
      13.67208576, 15.27589607, 24.97359276,  51.96620178, 10.82582951, 13.76047134,  13.76047134, 10.82582951,
      51.96620178, 24.97359276, 15.27589607,  13.67208576, 48.46035004, 50.21757126,  34.7771225,  27.79554367,
      15.26608276, 15.27185249, 16.81092834,  29.33479309, 5.10248518,  85.84146118,  85.84146118, 5.10248518,
      29.33479309, 16.81092834, 25.95727539,  34.5015831,  21.52643585, 21.52643585,  34.5015831,  25.95727539,
      35.05796432, 38.54359055, 38.54359055,  35.05796432, 19.39619255, 36.68960571,  16.29642677, 41.76596069,
      39.29201508, 40.27943802, 43.67494965,  17.53614426, 17.01120758, 14.28325844,  14.28325844, 17.01120758,
      17.53614426, 43.67494965, 40.27943802,  39.29201508, 41.76596069, 16.29642677,  36.68960571, 19.39619255,
      8.223339081, 16.57196808, 16.75862885,  39.18902969, 28.35930443, 14.97254658,  11.20259285, 12.45506668,
      23.81349754, 35.41851044, 6.74987793,   6.768158913, 6.768158913, 6.74987793,   35.41851044, 23.81349754,
      12.45506668, 11.20259285, 14.97254658,  28.35930443, 39.18902969, 16.75862885,  16.57196808, 8.223339081,
      28.73698616, 28.73698616, 23.82761765,  13.70425797, 37.05511093, 20.61174965,  29.07460403, 13.55575943,
      28.73127365, 50.90294647, 12.75067329,  37.09168243, 21.69445038, 21.69445038,  37.09168243, 12.75067329,
      50.90294647, 28.73127365, 13.55575943,  29.07460403, 20.61174965, 37.05511093,  13.70425797, 23.82761765,
      20.25505257, 20.82879829, 22.74308205,  11.197855,   11.80153656, 12.47373486,  41.87596893, 15.71939564,
      18.91372871, 12.80999374, 47.60126877,  23.973526,   23.973526,   47.60126877,  12.80999374, 18.91372871,
      15.71939564, 41.87596893, 12.47373486,  11.80153656, 11.197855,   22.74308205,  20.82879829, 20.25505257,
      13.79166222, 18.27315712, 32.10044861,  19.95432281, 19.95432281, 32.10044861,  18.27315712, 13.79166222,
      26.96515274, 32.77268982, 19.30791855,  26.16771889, 21.8395195,  12.22079182,  12.22079182, 21.8395195,
      26.16771889, 19.30791855, 32.77268982,  26.96515274, 38.00551605, 44.8817749,   23.56672287, 27.14280701,
      24.7010994,  26.94974136, 18.18262482,  41.78518295, 25.52963829, 12.35084438,  23.92583275, 29.39851189,
      22.78663635, 17.16172409, 14.08822727,  23.29167747, 43.20004654, 7.741707802,  30.1517334,  34.65544128,
      16.87238312, 20.67638779, 20.67638779,  16.87238312, 34.65544128, 30.1517334,   7.741707802, 43.20004654,
      23.29167747, 14.08822727, 17.16172409,  22.78663635, 29.39851189, 23.92583275,  12.35084438, 25.52963829,
      41.78518295, 18.18262482, 26.94974136,  24.7010994,  27.14280701, 23.56672287,  44.8817749,  38.00551605,
      27.08095169, 15.25416183, 15.25416183,  27.08095169, 34.61734009, 26.6135807,   32.98656464, 9.606899261,
      32.20135117, 34.74562454, 11.81522465,  10.8381052,  5.674238205, 17.69964981,  62.81964111, 62.81964111,
      17.69964981, 5.674238205, 10.8381052,   11.81522465, 34.74562454, 32.20135117,  9.606899261, 32.98656464,
      26.6135807,  34.61734009, 50.65113831,  52.74192429, 13.2403717,  50.32455826,  50.32455826, 13.2403717,
      52.74192429, 50.65113831, 21.19114685,  9.176017761, 9.176017761, 21.19114685,  32.93720245, 30.89264488,
      24.89771652, 20.27216721, 29.28691483,  15.03165436, 27.84318542, 34.68436432,  34.68436432, 27.84318542,
      15.03165436, 29.28691483, 20.27216721,  24.89771652, 30.89264488, 32.93720245,  20.73518944, 48.29927826,
      48.29927826, 20.73518944, 6.719681263,  17.64640999, 30.68091011, 15.46363926,  23.58017731, 20.0689621,
      39.86466217, 27.83972359, 12.83865738,  16.58363533, 13.44682693, 16.30245018,  16.30245018, 13.44682693,
      16.58363533, 12.83865738, 27.83972359,  39.86466217, 20.0689621,  23.58017731,  15.46363926, 30.68091011,
      17.64640999, 6.719681263, 27.12191391,  2.961663246, 25.25554848, 17.62779236,  22.62646866, 36.46771622,
      36.4128952,  11.50259686, 14.95877266,  21.88566017, 28.69185257, 36.83739471,  36.83739471, 28.69185257,
      21.88566017, 14.95877266, 11.50259686,  36.4128952,  36.46771622, 22.62646866,  17.62779236, 25.25554848,
      2.961663246, 27.12191391, 25.29393768,  17.32451248, 12.13477707, 25.57745552,  25.57745552, 12.13477707,
      17.32451248, 25.29393768, 44.1743927,   45.1587944,  6.422393799, 0.8557809591, 11.29298401, 22.29253197,
      10.27158737, 39.68115234, 15.76916122,  14.74081326, 14.74081326, 15.76916122,  39.68115234, 10.27158737,
      22.29253197, 11.29298401, 0.8557809591, 6.422393799, 45.1587944,  44.1743927,   1.574051857, 30.36156845,
      30.36156845, 1.574051857, 24.44804192,  52.11685562, 11.25370502, 53.2010498,   36.38677979, 28.00775719,
      9.189598083, 13.18849754, 9.053028107,  23.64361572, 15.13273144, 18.57131004,  18.57131004, 15.13273144,
      23.64361572, 9.053028107, 13.18849754,  9.189598083, 28.00775719, 36.38677979,  53.2010498,  11.25370502,
      52.11685562, 24.44804192, 21.03116989,  18.33800316, 10.88628197, 10.88628197,  18.33800316, 21.03116989,
      27.98948288, 5.415392876, 3.735046864,  20.55352974, 76.71188354, 13.2743988,   51.68177795, 25.157444,
      5.967044353, 5.967044353, 25.157444,    51.68177795, 13.2743988,  76.71188354,  20.55352974, 3.735046864,
      5.415392876, 27.98948288, 15.41703701,  25.33122826, 14.39577675, 21.77436638,  21.77436638, 14.39577675,
      25.33122826, 15.41703701, 41.75048828,  12.49152184, 21.53453445, 23.02672005,  16.51511192, 16.62403297,
      16.62403297, 16.51511192, 23.02672005,  21.53453445, 12.49152184, 41.75048828,  17.99378586, 30.66189003,
      68.10175323, 16.0703907,  9.457947731,  35.68981171, 32.52541351, 26.23055077,  29.48114586, 39.52045441,
      4.838356018, 15.79981232, 15.79981232,  4.838356018, 39.52045441, 29.48114586,  26.23055077, 32.52541351,
      35.68981171, 9.457947731, 16.0703907,   68.10175323, 30.66189003, 17.99378586,  28.65183258, 28.65183258,
      9.338945389, 9.338945389, 25.82771492,  28.39013672, 42.37106323, 9.863635063,  13.14507198, 40.67470932,
      25.00154877, 10.50583935, 58.73340607,  32.45139313, 16.11537361, 14.03599453,  14.03599453, 16.11537361,
      32.45139313, 58.73340607, 10.50583935,  25.00154877, 40.67470932, 13.14507198,  9.863635063, 42.37106323,
      28.39013672, 25.82771492, 42.10860062,  63.0782547,  22.24442673, 20.55533981,  17.3488884,  23.1890316,
      7.247262955, 32.478405,   12.28081322,  39.57626724, 33.63458633, 34.85544968,  19.60511589, 29.59932709,
      29.59932709, 19.60511589, 34.85544968,  33.63458633, 39.57626724, 12.28081322,  32.478405,   7.247262955,
      23.1890316,  17.3488884,  20.55533981,  22.24442673, 63.0782547,  42.10860062,  28.83471489, 22.21047592,
      15.70080471, 29.11550522, 20.83918762,  2.932832956, 22.05906677, 14.52700615,  18.47239876, 21.71303177,
      21.71303177, 18.47239876, 14.52700615,  22.05906677, 2.932832956, 20.83918762,  29.11550522, 15.70080471,
      22.21047592, 28.83471489, 23.53705215,  11.36185551, 13.28255463, 13.28255463,  11.36185551, 23.53705215,
      18.28559875, 18.28559875, 28.40058899,  7.612323761, 22.1194706,  23.1740818,   34.46437836, 29.62889481,
      24.87004089, 17.90001106, 12.30208588,  12.30208588, 17.90001106, 24.87004089,  29.62889481, 34.46437836,
      23.1740818,  22.1194706,  7.612323761,  28.40058899, 19.00841522, 19.00841522,  12.9498558,  12.9498558,
      19.66072083, 5.124233723, 34.6622963,   32.34340286, 10.49704742, 14.63159561,  36.05694199, 17.36983871,
      44.99233627, 24.41031647, 23.16533279,  19.12620926, 35.04272842, 35.04272842,  19.12620926, 23.16533279,
      24.41031647, 44.99233627, 17.36983871,  36.05694199, 14.63159561, 10.49704742,  32.34340286, 34.6622963,
      5.124233723, 19.66072083, 48.9961853,   10.08076382, 4.880791664, 11.80772018,  23.24902534, 14.52608204,
      25.83365059, 10.32247543, 27.85143471,  22.59643936, 17.09150505, 17.09150505,  22.59643936, 27.85143471,
      10.32247543, 25.83365059, 14.52608204,  23.24902534, 11.80772018, 4.880791664,  10.08076382, 48.9961853,
  };
  return sfk_e_e_exected;
}

typename StructureFactorTests::DataC StructureFactorTests::getRhoKElec()
{
  DataC rhok_e_expected = {
      {8.71710968, -4.546697617},     {-1.922936916, 2.888134718},    {3.683834553, 1.587894678},
      {0.08274590969, -2.9855299},    {0.08274590969, 2.9855299},     {3.683834553, -1.587894678},
      {-1.922936916, -2.888134718},   {8.71710968, 4.546697617},      {5.925450325, -3.780387878},
      {3.495111465, -7.33366251},     {8.456186295, -9.878379822},    {8.456186295, 9.878379822},
      {3.495111465, 7.33366251},      {5.925450325, 3.780387878},     {1.293812513, 2.550879002},
      {0.9947829247, -1.667260885},   {-3.32370615, -4.325564384},    {3.32420516, -2.692898273},
      {-0.5864133239, -0.4921188354}, {4.742272377, 6.527976036},     {4.742272377, -6.527976036},
      {-0.5864133239, 0.4921188354},  {3.32420516, 2.692898273},      {-3.32370615, 4.325564384},
      {0.9947829247, 1.667260885},    {1.293812513, -2.550879002},    {-5.700958729, -8.084672928},
      {0.1101314425, -5.768994808},   {-6.726584435, -11.35791016},   {0.2212747335, -2.771863937},
      {-5.652677536, -15.22936058},   {11.32489491, 0.2840920985},    {3.681020975, -1.348021507},
      {8.953266144, 0.2829014659},    {3.232520342, 1.962494969},     {-1.18957901, 5.086456299},
      {-0.1311748028, -4.871684551},  {-8.142663956, -4.272470474},   {-8.142663956, 4.272470474},
      {-0.1311748028, 4.871684551},   {-1.18957901, -5.086456299},    {3.232520342, -1.962494969},
      {8.953266144, -0.2829014659},   {3.681020975, 1.348021507},     {11.32489491, -0.2840920985},
      {-5.652677536, 15.22936058},    {0.2212747335, 2.771863937},    {-6.726584435, 11.35791016},
      {0.1101314425, 5.768994808},    {-5.700958729, 8.084672928},    {10.43575668, 6.53019619},
      {5.795556068, 2.78207016},      {-6.113267899, -0.2030392885},  {-6.086822987, -8.499317169},
      {-6.086822987, 8.499317169},    {-6.113267899, 0.2030392885},   {5.795556068, -2.78207016},
      {10.43575668, -6.53019619},     {-4.801735878, -6.616987228},   {-5.774668694, -10.96525192},
      {5.316614628, -4.684461594},    {5.316614628, 4.684461594},     {-5.774668694, 10.96525192},
      {-4.801735878, 6.616987228},    {-9.40567112, -2.540453911},    {-7.583086967, -2.324322939},
      {-7.583086967, 2.324322939},    {-9.40567112, 2.540453911},     {-5.093160629, -4.126936913},
      {-7.604147911, -2.108922243},   {8.655655861, -8.052873611},    {11.76809883, -2.126418114},
      {2.244450092, -4.155418873},    {-4.406193256, -0.8882490396},  {7.692566395, 2.791618824},
      {11.47925091, 0.8016405702},    {6.823512077, -6.03425312},     {9.898491859, -2.840027809},
      {9.898491859, 2.840027809},     {6.823512077, 6.03425312},      {11.47925091, -0.8016405702},
      {7.692566395, -2.791618824},    {-4.406193256, 0.8882490396},   {2.244450092, 4.155418873},
      {11.76809883, 2.126418114},     {8.655655861, 8.052873611},     {-7.604147911, 2.108922243},
      {-5.093160629, 4.126936913},    {-2.87187624, -7.559978008},    {-7.102768898, -9.985420227},
      {-2.812223434, 0.6576720476},   {1.349279881, -6.264540672},    {5.319188118, -0.1384968758},
      {4.215346813, -8.821123123},    {-2.747925282, -4.244094849},   {-7.488515854, 0.1429691315},
      {5.310036659, 1.297901869},     {1.036117911, -0.2355027199},   {14.69547272, -7.05914402},
      {2.653057814, -4.491735458},    {2.653057814, 4.491735458},     {14.69547272, 7.05914402},
      {1.036117911, 0.2355027199},    {5.310036659, -1.297901869},    {-7.488515854, -0.1429691315},
      {-2.747925282, 4.244094849},    {4.215346813, 8.821123123},     {5.319188118, 0.1384968758},
      {1.349279881, 6.264540672},     {-2.812223434, -0.6576720476},  {-7.102768898, 9.985420227},
      {-2.87187624, 7.559978008},     {2.356003761, -2.862271309},    {2.356003761, 2.862271309},
      {-2.363417864, 2.569367409},    {-2.248744488, -5.109074593},   {17.48342514, -4.97355938},
      {5.618811131, -10.55295563},    {2.239295483, 0.3416103125},    {-0.2212430239, -4.464571953},
      {-2.904228687, 8.329310417},    {1.709150076, -2.501589298},    {-7.698933601, 4.440327168},
      {-1.292080879, 4.754459381},    {-0.3222714663, -5.873790264},  {-0.3222714663, 5.873790264},
      {-1.292080879, -4.754459381},   {-7.698933601, -4.440327168},   {1.709150076, 2.501589298},
      {-2.904228687, -8.329310417},   {-0.2212430239, 4.464571953},   {2.239295483, -0.3416103125},
      {5.618811131, 10.55295563},     {17.48342514, 4.97355938},      {-2.248744488, 5.109074593},
      {-2.363417864, -2.569367409},   {-4.939735413, -5.351401806},   {1.830592275, -3.316003799},
      {-7.168056488, 2.093708515},    {3.260816097, 1.833023667},     {13.40994263, -1.961353064},
      {7.738707542, -1.397968173},    {-1.647323608, 4.647089005},    {-10.57173729, 1.734428048},
      {-5.389299393, -7.666906357},   {-6.404142857, 2.542213917},    {3.615185022, 4.523777962},
      {0.4198628664, 5.071886539},    {0.4198628664, -5.071886539},   {3.615185022, -4.523777962},
      {-6.404142857, -2.542213917},   {-5.389299393, 7.666906357},    {-10.57173729, -1.734428048},
      {-1.647323608, -4.647089005},   {7.738707542, 1.397968173},     {13.40994263, 1.961353064},
      {3.260816097, -1.833023667},    {-7.168056488, -2.093708515},   {1.830592275, 3.316003799},
      {-4.939735413, 5.351401806},    {3.294924498, 4.57557106},      {-1.220366955, -6.349961281},
      {-3.499528408, -9.322668076},   {0.813821435, -1.265983105},    {0.813821435, 1.265983105},
      {-3.499528408, 9.322668076},    {-1.220366955, 6.349961281},    {3.294924498, -4.57557106},
      {-8.7155056, 2.827648878},      {-7.703950882, -5.550394535},   {-4.83059454, -9.249353409},
      {2.573172092, 2.606091022},     {2.530131578, -2.544525385},    {6.254175663, 7.70658493},
      {6.254175663, -7.70658493},     {2.530131578, 2.544525385},     {2.573172092, -2.606091022},
      {-4.83059454, 9.249353409},     {-7.703950882, 5.550394535},    {-8.7155056, -2.827648878},
      {-7.839790344, 1.769085646},    {4.839025497, -9.870304108},    {3.570502281, 3.187149048},
      {-0.04761236906, 10.53871632},  {1.702306747, -2.233577251},    {5.47282362, 4.489488602},
      {-3.270079851, -3.580967426},   {7.736566067, -4.634237289},    {-7.92897892, -1.031474829},
      {-0.1574441195, 7.209131718},   {14.6263876, 1.093638182},      {-0.4952100515, 6.376775742},
      {-1.919678688, -10.78917885},   {3.336119652, 7.531472206},     {8.277803421, 6.791946411},
      {1.98579514, 11.70149899},      {1.650889397, 4.836851597},     {-9.040493011, 2.985294819},
      {4.065285206, -12.95230293},    {-0.06000053883, 3.80441761},   {-1.191102505, -7.012737274},
      {9.627044678, 3.818733215},     {9.627044678, -3.818733215},    {-1.191102505, 7.012737274},
      {-0.06000053883, -3.80441761},  {4.065285206, 12.95230293},     {-9.040493011, -2.985294819},
      {1.650889397, -4.836851597},    {1.98579514, -11.70149899},     {8.277803421, -6.791946411},
      {3.336119652, -7.531472206},    {-1.919678688, 10.78917885},    {-0.4952100515, -6.376775742},
      {14.6263876, -1.093638182},     {-0.1574441195, -7.209131718},  {-7.92897892, 1.031474829},
      {7.736566067, 4.634237289},     {-3.270079851, 3.580967426},    {5.47282362, -4.489488602},
      {1.702306747, 2.233577251},     {-0.04761236906, -10.53871632}, {3.570502281, -3.187149048},
      {4.839025497, 9.870304108},     {-7.839790344, -1.769085646},   {-9.201574326, -13.4949379},
      {-0.2794930339, 7.727714539},   {-0.2794930339, -7.727714539},  {-9.201574326, 13.4949379},
      {-2.911529541, 5.704262733},    {-5.773739815, -1.985926986},   {-7.630257607, -4.414196968},
      {-13.6026001, 2.209714651},     {10.39690781, 5.922379971},     {-4.384187698, -2.772921562},
      {-6.503312111, -8.846293449},   {-2.053160667, -7.729005337},   {1.642603636, 7.368412018},
      {-3.235371828, -8.331659317},   {-0.4351923466, -0.696374774},  {-0.4351923466, 0.696374774},
      {-3.235371828, 8.331659317},    {1.642603636, -7.368412018},    {-2.053160667, 7.729005337},
      {-6.503312111, 8.846293449},    {-4.384187698, 2.772921562},    {10.39690781, -5.922379971},
      {-13.6026001, -2.209714651},    {-7.630257607, 4.414196968},    {-5.773739815, 1.985926986},
      {-2.911529541, -5.704262733},   {-7.512525082, 8.190120697},    {-3.774884224, -6.603587151},
      {3.879692078, -2.788218737},    {-11.22305489, 3.250986576},    {-11.22305489, -3.250986576},
      {3.879692078, 2.788218737},     {-3.774884224, 6.603587151},    {-7.512525082, -8.190120697},
      {2.334325075, 0.6757254004},    {-7.021186829, -3.251885891},   {-7.021186829, 3.251885891},
      {2.334325075, -0.6757254004},   {2.793100834, -3.069241047},    {-1.920218706, 6.941579342},
      {-0.5105069876, -5.864494801},  {-3.139320135, 4.444633961},    {-1.758072019, 4.634013176},
      {1.584219813, 13.92621994},     {10.15742111, 4.375022888},     {-4.61026001, 4.919458866},
      {-4.61026001, -4.919458866},    {10.15742111, -4.375022888},    {1.584219813, -13.92621994},
      {-1.758072019, -4.634013176},   {-3.139320135, -4.444633961},   {-0.5105069876, 5.864494801},
      {-1.920218706, -6.941579342},   {2.793100834, 3.069241047},     {-2.664238691, 0.07429349422},
      {-0.5081300735, -0.8151782751}, {-0.5081300735, 0.8151782751},  {-2.664238691, -0.07429349422},
      {-3.402713537, -2.890094519},   {-0.5786087513, 4.927651882},   {-2.426986694, -4.517370224},
      {-3.6040802, 5.193357944},      {3.478384733, -11.26986694},    {-1.755678892, -0.1891139746},
      {-0.7612656951, 1.449137926},   {-2.331244946, -0.9898056984},  {-11.96396637, -8.52230072},
      {2.210885048, -7.956524849},    {-4.536129475, 7.525655746},    {4.614331245, 6.411622047},
      {4.614331245, -6.411622047},    {-4.536129475, -7.525655746},   {2.210885048, 7.956524849},
      {-11.96396637, 8.52230072},     {-2.331244946, 0.9898056984},   {-0.7612656951, -1.449137926},
      {-1.755678892, 0.1891139746},   {3.478384733, 11.26986694},     {-3.6040802, -5.193357944},
      {-2.426986694, 4.517370224},    {-0.5786087513, -4.927651882},  {-3.402713537, 2.890094519},
      {-5.191473484, -2.849163055},   {-0.663464427, -5.111888885},   {1.12310195, -2.136029243},
      {3.705461979, -1.644176602},    {1.346970558, 4.375124454},     {1.778060317, 8.757004738},
      {-0.1555395126, -1.815398812},  {2.633982897, 0.892973423},     {2.678255081, 6.068552017},
      {-0.5212801099, 2.269085884},   {-0.4010076523, -0.3544235229}, {-3.34279418, -5.890102386},
      {-3.34279418, 5.890102386},     {-0.4010076523, 0.3544235229},  {-0.5212801099, -2.269085884},
      {2.678255081, -6.068552017},    {2.633982897, -0.892973423},    {-0.1555395126, 1.815398812},
      {1.778060317, -8.757004738},    {1.346970558, -4.375124454},    {3.705461979, 1.644176602},
      {1.12310195, 2.136029243},      {-0.663464427, 5.111888885},    {-5.191473484, 2.849163055},
      {4.136557579, 16.34789848},     {-3.968876839, -4.891018867},   {8.641466141, 0.3708292246},
      {-5.391967773, 3.798137188},    {-5.391967773, -3.798137188},   {8.641466141, -0.3708292246},
      {-3.968876839, 4.891018867},    {4.136557579, -16.34789848},    {-7.872437477, 4.337753296},
      {1.139393449, 0.5955389738},    {-4.332407475, 1.391280413},    {-6.661267281, 1.066924691},
      {-2.060071707, 11.90766335},    {-0.6115577221, 1.789911509},   {0.543214798, 3.455523968},
      {-3.220860958, -4.430136681},   {-1.274977803, 8.146348},       {-0.04239326715, 6.392484665},
      {-0.04239326715, -6.392484665}, {-1.274977803, -8.146348},      {-3.220860958, 4.430136681},
      {0.543214798, -3.455523968},    {-0.6115577221, -1.789911509},  {-2.060071707, -11.90766335},
      {-6.661267281, -1.066924691},   {-4.332407475, -1.391280413},   {1.139393449, -0.5955389738},
      {-7.872437477, -4.337753296},   {-5.868373871, -2.080583334},   {3.205960751, -8.414811134},
      {3.205960751, 8.414811134},     {-5.868373871, 2.080583334},    {0.3016886711, 2.535874367},
      {6.803632259, 4.496690273},     {-10.25583458, -2.179238796},   {3.787923336, -10.00564194},
      {-6.207402229, -6.479542732},   {3.69013381, -6.883469582},     {3.864925385, -3.932904243},
      {6.377850533, -2.156614542},    {-7.195007801, -7.864494324},   {-3.614258289, 3.451548576},
      {4.398411274, -4.772294998},    {2.120894909, -9.76187706},     {2.120894909, 9.76187706},
      {4.398411274, 4.772294998},     {-3.614258289, -3.451548576},   {-7.195007801, 7.864494324},
      {6.377850533, 2.156614542},     {3.864925385, 3.932904243},     {3.69013381, 6.883469582},
      {-6.207402229, 6.479542732},    {3.787923336, 10.00564194},     {-10.25583458, 2.179238796},
      {6.803632259, -4.496690273},    {0.3016886711, -2.535874367},   {-2.14943099, 2.792579174},
      {-3.017076015, 2.977154016},    {-3.10426569, 6.199737549},     {-3.10426569, -6.199737549},
      {-3.017076015, -2.977154016},   {-2.14943099, -2.792579174},    {6.161175251, 9.371200562},
      {6.703355789, -1.188367128},    {-0.9553173184, -7.164465427},  {2.489067316, 4.85033989},
      {-7.979998112, 2.947873592},    {2.814046383, -2.665548563},    {-2.999369144, 3.691152096},
      {6.6844244, -3.31745863},       {-2.465224743, 3.124488354},    {-2.465224743, -3.124488354},
      {6.6844244, 3.31745863},        {-2.999369144, -3.691152096},   {2.814046383, 2.665548563},
      {-7.979998112, -2.947873592},   {2.489067316, -4.85033989},     {-0.9553173184, 7.164465427},
      {6.703355789, 1.188367128},     {6.161175251, -9.371200562},    {-2.470119476, 5.226902008},
      {-2.021661282, -1.45525825},    {-4.929785728, 6.317669392},    {-0.6250338554, 6.334229469},
      {-0.6250338554, -6.334229469},  {-4.929785728, -6.317669392},   {-2.021661282, 1.45525825},
      {-2.470119476, -5.226902008},   {-2.59787631, 0.5687449574},    {0.7522132397, 0.8433344364},
      {-2.144709826, -9.003145218},   {-7.990592957, 5.051809788},    {5.391149521, -1.972573519},
      {1.444218874, -0.8582467437},   {1.444218874, 0.8582467437},    {5.391149521, 1.972573519},
      {-7.990592957, -5.051809788},   {-2.144709826, 9.003145218},    {0.7522132397, -0.8433344364},
      {-2.59787631, -0.5687449574},   {1.624803066, -6.169080257},    {-4.815154076, -6.220931053},
      {7.25798893, 2.185595036},      {-5.693672657, -0.7283151746},  {10.52756882, 4.967222691},
      {-11.30184746, -2.424499035},   {1.294578671, -1.047330022},    {3.586127281, -1.685513735},
      {0.5972062349, -3.687850475},   {-3.765072823, 8.039365768},    {-7.617611885, 11.9473238},
      {-4.370289326, 5.973483562},    {-4.370289326, -5.973483562},   {-7.617611885, -11.9473238},
      {-3.765072823, -8.039365768},   {0.5972062349, 3.687850475},    {3.586127281, 1.685513735},
      {1.294578671, 1.047330022},     {-11.30184746, 2.424499035},    {10.52756882, -4.967222691},
      {-5.693672657, 0.7283151746},   {7.25798893, -2.185595036},     {-4.815154076, 6.220931053},
      {1.624803066, 6.169080257},     {5.984591484, -1.579845905},    {5.984591484, 1.579845905},
      {-2.950917721, 6.393006325},    {-2.950917721, -6.393006325},   {-2.406265497, 3.512854099},
      {-6.905929565, -3.097289801},   {-1.781444192, -4.096608162},   {-4.904432297, -0.3164815903},
      {0.3287994266, -0.9647036791},  {4.294670105, 1.848518848},     {0.7801537514, 5.737058163},
      {-3.860655785, 3.325350523},    {-0.4820600748, -6.224105835},  {-2.213942051, -6.346621513},
      {-2.078785658, 2.409151077},    {-3.256606579, 6.007224083},    {-3.256606579, -6.007224083},
      {-2.078785658, -2.409151077},   {-2.213942051, 6.346621513},    {-0.4820600748, 6.224105835},
      {-3.860655785, -3.325350523},   {0.7801537514, -5.737058163},   {4.294670105, -1.848518848},
      {0.3287994266, 0.9647036791},   {-4.904432297, 0.3164815903},   {-1.781444192, 4.096608162},
      {-6.905929565, 3.097289801},    {-2.406265497, -3.512854099},   {-3.478102684, 1.023663759},
      {-5.396936417, -3.33212328},    {0.4382824302, 5.134030342},    {8.69639492, 9.952037811},
      {0.9321068525, -6.382178783},   {-2.940763235, 8.52350235},     {1.793621659, -2.952024937},
      {0.2209047675, 4.453215599},    {-2.090683699, 3.563836813},    {1.452917576, -1.211249709},
      {-5.050708771, 1.688289165},    {6.086797237, -3.249409199},    {11.60981178, 1.229768515},
      {7.713471413, 9.650679588},     {7.713471413, -9.650679588},    {11.60981178, -1.229768515},
      {6.086797237, 3.249409199},     {-5.050708771, -1.688289165},   {1.452917576, 1.211249709},
      {-2.090683699, -3.563836813},   {0.2209047675, -4.453215599},   {1.793621659, 2.952024937},
      {-2.940763235, -8.52350235},    {0.9321068525, 6.382178783},    {8.69639492, -9.952037811},
      {0.4382824302, -5.134030342},   {-5.396936417, 3.33212328},     {-3.478102684, -1.023663759},
      {-0.6031847596, 5.21430254},    {0.762039423, 6.510918617},     {-0.9319431186, -1.447879553},
      {11.32525063, -5.989095688},    {12.52264118, -4.082176685},    {-2.944167376, 4.094477654},
      {-2.552528381, 8.635591507},    {-0.6427571177, 3.982498646},   {-1.737802744, -0.9459688663},
      {-4.661380768, 5.720423698},    {-4.661380768, -5.720423698},   {-1.737802744, 0.9459688663},
      {-0.6427571177, -3.982498646},  {-2.552528381, -8.635591507},   {-2.944167376, -4.094477654},
      {12.52264118, 4.082176685},     {11.32525063, 5.989095688},     {-0.9319431186, 1.447879553},
      {0.762039423, -6.510918617},    {-0.6031847596, -5.21430254},   {-5.057085991, -8.563818932},
      {-1.454874754, 7.559200764},    {1.474900842, -1.612879038},    {1.474900842, 1.612879038},
      {-1.454874754, -7.559200764},   {-5.057085991, 8.563818932},    {-0.3846122622, -3.122711182},
      {-0.3846122622, 3.122711182},   {-3.815939903, -0.05181062222}, {-11.56450462, -9.964096069},
      {-8.32462883, 5.983042717},     {4.169249535, -8.07144928},     {-2.935938835, 2.884704828},
      {6.552947998, 11.73053932},     {2.862522602, 2.58791399},      {0.2655903697, -5.665795326},
      {1.762565374, 1.093242407},     {1.762565374, -1.093242407},    {0.2655903697, 5.665795326},
      {2.862522602, -2.58791399},     {6.552947998, -11.73053932},    {-2.935938835, -2.884704828},
      {4.169249535, 8.07144928},      {-8.32462883, -5.983042717},    {-11.56450462, 9.964096069},
      {-3.815939903, 0.05181062222},  {-1.647386074, -1.237983704},   {-1.647386074, 1.237983704},
      {0.3037085533, -6.764062881},   {0.3037085533, 6.764062881},    {-1.593097448, 7.406896591},
      {7.083545685, -2.279180527},    {1.766290188, 5.846293449},     {3.154982567, -9.518131256},
      {4.86631012, -0.9601616859},    {3.732284307, -10.53539753},    {0.2383503914, -7.824460506},
      {7.507283211, -5.759765148},    {7.411321163, -1.490231872},    {-5.159056664, 7.824353218},
      {0.03900694847, -5.096890926},  {8.155467033, -2.976303101},    {-2.111409664, 5.895214081},
      {-2.111409664, -5.895214081},   {8.155467033, 2.976303101},     {0.03900694847, 5.096890926},
      {-5.159056664, -7.824353218},   {7.411321163, 1.490231872},     {7.507283211, 5.759765148},
      {0.2383503914, 7.824460506},    {3.732284307, 10.53539753},     {4.86631012, 0.9601616859},
      {3.154982567, 9.518131256},     {1.766290188, -5.846293449},    {7.083545685, 2.279180527},
      {-1.593097448, -7.406896591},   {-3.814876318, 3.170872211},    {-0.8635575175, -2.547828674},
      {-9.147024155, -8.007073402},   {2.572521925, -7.508256912},    {-2.931224346, 2.410528898},
      {-2.80186224, 6.080150127},     {7.180770397, -5.549987793},    {-6.942130089, 4.509467125},
      {6.726749897, 0.2640405297},    {9.604988098, -0.2451888323},   {-4.905525208, -4.798740387},
      {-4.905525208, 4.798740387},    {9.604988098, 0.2451888323},    {6.726749897, -0.2640405297},
      {-6.942130089, -4.509467125},   {7.180770397, 5.549987793},     {-2.80186224, -6.080150127},
      {-2.931224346, -2.410528898},   {2.572521925, 7.508256912},     {-9.147024155, 8.007073402},
      {-0.8635575175, 2.547828674},   {-3.814876318, -3.170872211},
  };

  return rhok_e_expected;
}

} // namespace qmcplusplus
