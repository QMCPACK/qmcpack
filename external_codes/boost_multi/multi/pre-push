#!/bin/bash 
# -*-indent-tabs-mode:t;c-basic-offset:4;tab-width:4;autowrap:nil;-*-
(mkdir -p .build.g++-std17     && cd .build.g++-std17      && CXX=g++                                                        cmake ..                                                              -DCMAKE_CXX_STANDARD=17 -DCMAKE_CXX_CPPCHECK="cppcheck;--enable=all;--inline-suppr;--suppressions-list=${PWD}/../.cppcheck-suppressions;--language=c++;--std=c++17;--error-exitcode=666;-UEXCLUDE_CPPCHECK" && make -j $(($(nproc) - 2)) VERBOSE=1 &&                                               ctest         -j 12 --output-on-failure) || exit 666
(mkdir -p .build.clang++-std17 && cd .build.clang++-std17  && CXX=clang++                                                    cmake .. -DCMAKE_BUILD_TYPE=Debug                                     -DCMAKE_CXX_STANDARD=17 -DCMAKE_CXX_CLANG_TIDY="clang-tidy"                                                                                                                              && make -j $(($(nproc) - 2)) VERBOSE=1 &&                                               ctest         -j 12 --output-on-failure) || exit 666
(mkdir -p .build.nvccu         && cd .build.nvccu          && CUDACXX=nvcc CMAKE_CUDA_HOST_COMPILER=g++-9                    cmake .. -DCMAKE_BUILD_TYPE=Release -DCMAKE_CUDA_FLAGS="-ccbin=g++-9" -DCMAKE_CXX_STANDARD=17 -DENABLE_CUDA=1                                                                                                                                                  && make -j $(($(nproc) - 2)) VERBOSE=1 &&                                               ctest -T Test -j 12 --output-on-failure) || exit 666
(mkdir -p .build.icpc          && cd .build.icpc           && CXX=/opt/intel/oneapi/compiler/latest/linux/bin/intel64/icpc   cmake .. -DCMAKE_BUILD_TYPE=Release                                   -DCMAKE_CXX_STANDARD=17                                                                                                                                                                  && make -j $(($(nproc) - 2)) VERBOSE=1 &&                                               ctest -T Test -j 12 --output-on-failure) || exit 666
(mkdir -p .build.clang++.asan  && cd .build.clang++.asan   && CXX=clang++ CXXFLAGS="-fsanitize=undefined -fsanitize=address" cmake .. -DCMAKE_BUILD_TYPE=Debug                                                                                                                                                                                                                              && make -j $(($(nproc) - 2)) VERBOSE=1 && ASAN_OPTIONS="halt_on_error=1 detect_leaks=1" ctest         -j 12 --output-on-failure) || exit 666
exit

(mkdir -p .build.g++              && cd .build.g++            && CXX=g++      `#CXXFLAGS="-fsanitize=address"`                      cmake .. -DCMAKE_BUILD_TYPE=Debug                                                                                                                             && make -j $(($(nproc) - 2)) VERBOSE=1 &&                                               ctest -T Test     -j 10 --output-on-failure) || exit 666
(mkdir -p .build.clang++.pre-push && cd .build.clang++.pre-push && CXX=clang++  `#CXXFLAGS="-fsanitize=undefined -fsanitize=address"` cmake .. -DCMAKE_BUILD_TYPE=Debug   -DCMAKE_CXX_CLANG_TIDY="clang-tidy;--dump-config;-checks=*,-readability-magic-numbers,-modernize-use-nodiscard,-altera-struct-pack-align,-cert-err58-cpp,-cppcoreguidelines-avoid-non-const-global-variables,-cppcoreguidelines-macro-usage,-cppcoreguidelines-pro-bounds-array-to-pointer-decay,-cppcoreguidelines-pro-type-vararg,-cppcoreguidelines-avoid-magic-numbers,-fuchsia-default-arguments-calls,-fuchsia-trailing-return,-fuchsia-statically-constructed-objects,-fuchsia-overloaded-operator,-hicpp-vararg,-hicpp-no-array-decay,-llvm-header-guard,-llvmlibc-restrict-system-libc-headers,-llvmlibc-implementation-in-namespace,-llvmlibc-callee-namespace,-fuchsia-default-arguments-calls" `#-DCMAKE_CXX_CPPLINT="cpplint;--filter=-whitespace/tab,-whitespace/parens,-whitespace/operators,-readability/alt_tokens,-build/include_order,-whitespace/line_length,-whitespace/semicolon,-legal/copyright,-whitespace/comments,-readability/nolint"` && make -j $(($(nproc) - 2)) && ASAN_OPTIONS="halt_on_error=1 detect_leaks=1" ctest -T Test     -j 12 --output-on-failure) || exit 666
(mkdir -p .build.nvccu-std17  && cd .build.nvccu-std17  && CUDACXX=nvcc                    cmake .. -DCMAKE_CUDA_FLAGS="-ccbin=g++-9" -DCMAKE_CXX_STANDARD=17 -DENABLE_CUDA=1 && make -j 10 && ctest -j 10 --output-on-failure) || exit
(mkdir -p .build.g++.debug    && cd .build.g++.debug    && CXX=g++                         cmake .. -DCMAKE_BUILD_TYPE=Debug     && make -j 12 && ctest -j 12 --output-on-failure) || exit
(mkdir -p .build.nvccu        && cd .build.nvccu        && CUDACXX=nvcc                    cmake .. -DCMAKE_CUDA_FLAGS="-ccbin=g++-9"                         -DENABLE_CUDA=1 && make -j 10 && ctest -j 10 --output-on-failure) || exit
(mkdir -p .build.g++.codecov  && cd .build.g++.codecov  && CXX=g++    CXXFLAGS="-coverage" cmake .. -DCMAKE_BUILD_TYPE=Debug -DCMAKE_EXE_LINKER_FLAGS="-coverage -lgcov"   && make -j 12 && ctest -j 12 --output-on-failure -T Test -T Coverage) || exit
(mkdir -p .build.g++.memchk   && cd .build.g++.memchk   && CXX=g++                         cmake ..                              && make -j 12 && ctest -T memcheck -j 12 --output-on-failure) || exit
(mkdir -p .build.g++-11       && cd .build.g++-11       && CXX=g++-11                      cmake ..                              && make -j 12 && ctest -j 12 --output-on-failure) || exit
(mkdir -p .build.g++-10       && cd .build.g++-10       && CXX=g++-10                      cmake ..                              && make -j 12 && ctest -j 12 --output-on-failure) || exit
(mkdir -p .build.g++-9        && cd .build.g++-9        && CXX=g++-9                       cmake ..                              && make -j 12 && ctest -j 12 --output-on-failure) || exit
(mkdir -p .build.g++-8        && cd .build.g++-8        && CXX=g++-8                       cmake ..                              && make -j 12 && ctest -j 12 --output-on-failure) || exit
(mkdir -p .build.g++-7        && cd .build.g++-7        && CXX=g++-7                       cmake ..                              && make -j 12 && ctest -j 12 --output-on-failure) || exit
(mkdir -p .build.clang++-12   && cd .build.clang++-12   && CXX=clang++-12                  cmake ..                              && make -j 12 && ctest -j 12 --output-on-failure) || exit
(mkdir -p .build.clang++-11   && cd .build.clang++-11   && CXX=clang++-11                  cmake ..                              && make -j 12 && ctest -j 12 --output-on-failure) || exit
(mkdir -p .build.clang++-9    && cd .build.clang++-9    && CXX=clang++-9                   cmake ..                              && make -j 12 && ctest -j 12 --output-on-failure) || exit
(mkdir -p .build.g++.asan     && cd .build.g++.asan     && CXX=g++     CXXFLAGS="-fsanitize=address"                      cmake .. -D CMAKE_BUILD_TYPE=Debug && make -j 12 && ctest -j 12 --output-on-failure) || exit
#(mkdir -p .build.clang++.msan && cd .build.clang++.msan && CXX=clang++ CXXFLAGS="-fsanitize=memory -fsanitize-memory-track-origins=2 -fno-omit-frame-pointer -g -O0 " MSAN_OPTIONS=symbolize=1 cmake .. -DCMAKE_BUILD_TYPE=Debug && make -j 12 && MSAN_OPTIONS=symbolize=1 MSAN_SYMBOLIZER_PATH=/usr/bin/llvm-symbolizer ctest -j 1 --output-on-failure) || exit
(mkdir -p .build.nvcc         && cd .build.nvcc         && CXX=nvcc                        cmake ..                              && make -j 10 && ctest -j 10 --output-on-failure) || exit
(mkdir -p .build.g++cppcheck  && cd .build.g++cppcheck  && CXX=g++                         cmake .. -DCMAKE_CXX_CPPCHECK="cppcheck;--max-ctu-depth=3;--enable=all;--inline-suppr;--suppress=*:*thrust/complex*;--suppress=missingInclude;--suppress=syntaxError;--suppress=unmatchedSuppression;--suppress=preprocessorErrorDirective;--language=c++;--std=c++14;--error-exitcode=666" && make -j 12 && ctest -j 12 --output-on-failure) || exit
(mkdir -p .build.clang++.tidy && cd .build.clang++.tidy && CXX=clang++                     cmake .. -DCMAKE_CXX_CLANG_TIDY="clang-tidy"     && make -j 10 && ctest -j 12 --output-on-failure) || exit
(mkdir -p .build.clang++.iwyu && cd .build.clang++.iwyu && CXX=clang++                     cmake .. -DCMAKE_CXX_INCLUDE_WHAT_YOU_USE="iwyu" && make -j 10 && ctest -j 12 --output-on-failure) || exit
(find . -name '*.hpp' -exec cppcheck --enable=all --inline-suppr --suppress=unmatchedSuppression:{} --suppress=syntaxError --suppress=missingInclude --suppress=missingIncludeSystem --suppress=preprocessorErrorDirective --suppress=syntaxError --suppress=unusedFunction --suppress=arithOperationsOnVoidPointer --suppress=sizeofDereferencedVoidPointer -D__align__ -DCUDARTAPI --language=c++ --std=c++17 --error-exitcode=666 --suppress=unmatchedSuppression {} \;) || exit
(mkdir -p .build.g++cpplint   && cd .build.g++cpplint   && CXX=g++                         cmake .. -DCMAKE_CXX_CPPLINT="cpplint;--filter=-whitespace/tab,-whitespace/parens,-whitespace/operators,-readability/alt_tokens,-build/include_order,-whitespace/line_length,-whitespace/semicolon,-legal/copyright,-whitespace/comments,-readability/nolint" && make -j 12 && ctest -j 12 --output-on-failure) || exit
